<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 5 Dynamic programming | Reinforcement Learning for Business (RL)</title>
  <meta name="description" content="Course notes for ‘Reinforcement Learning for Business’" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 5 Dynamic programming | Reinforcement Learning for Business (RL)" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bss-osca.github.io/rl//img/logo.png" />
  <meta property="og:description" content="Course notes for ‘Reinforcement Learning for Business’" />
  <meta name="github-repo" content="bss-osca/rl" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 5 Dynamic programming | Reinforcement Learning for Business (RL)" />
  
  <meta name="twitter:description" content="Course notes for ‘Reinforcement Learning for Business’" />
  <meta name="twitter:image" content="https://bss-osca.github.io/rl//img/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2022-09-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="mod-mdp-2.html"/>
<link rel="next" href="mod-mc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<html>
<head>

<script id="code-folding-options" type="application/json">
  {"initial-state": "hide"}
</script>
   
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});

// code folding
document.addEventListener("DOMContentLoaded", function() {
  const languages = ['r', 'python', 'bash', 'sql', 'cpp', 'stan', 'julia', 'foldable'];
  const options = JSON.parse(document.getElementById("code-folding-options").text);
  const show = options["initial-state"] !== "hide";
  Array.from(document.querySelectorAll("pre.sourceCode")).map(function(pre) {
    const classList = pre.classList;
    if (languages.some(x => classList.contains(x))) {
      const div = pre.parentElement;
      const state = show || classList.contains("fold-show") && !classList.contains("fold-hide") ? " open" : "";
      div.outerHTML = `<details${state}><summary></summary>${div.outerHTML}</details>`;
    }
  });
});
</script>

<script src="https://hypothes.is/embed.js" async></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About the course notes</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-outcomes"><i class="fa fa-check"></i>Learning outcomes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#purpose-of-the-course"><i class="fa fa-check"></i>Purpose of the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-goals-of-the-course"><i class="fa fa-check"></i>Learning goals of the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reinforcement-learning-textbook"><i class="fa fa-check"></i>Reinforcement learning textbook</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-organization"><i class="fa fa-check"></i>Course organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#programming-software"><i class="fa fa-check"></i>Programming software</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i>Acknowledgements and license</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sec-intro-ex"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sec-intro-ex-annotate"><i class="fa fa-check"></i>Exercise - How to annotate</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sec-intro-ex-templates"><i class="fa fa-check"></i>Exercise - Templates</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Introduction to RL</b></span></li>
<li class="chapter" data-level="1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html"><i class="fa fa-check"></i><b>1</b> An introduction to RL</a>
<ul>
<li class="chapter" data-level="1.1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#mod-rl-intro-lo"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#textbook-readings"><i class="fa fa-check"></i><b>1.2</b> Textbook readings</a></li>
<li class="chapter" data-level="1.3" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#what-is-reinforcement-learning"><i class="fa fa-check"></i><b>1.3</b> What is reinforcement learning</a></li>
<li class="chapter" data-level="1.4" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-and-business-analytics"><i class="fa fa-check"></i><b>1.4</b> RL and Business Analytics</a></li>
<li class="chapter" data-level="1.5" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-in-different-research-deciplines"><i class="fa fa-check"></i><b>1.5</b> RL in different research deciplines</a></li>
<li class="chapter" data-level="1.6" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-and-machine-learning"><i class="fa fa-check"></i><b>1.6</b> RL and machine learning</a></li>
<li class="chapter" data-level="1.7" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#the-rl-data-stream"><i class="fa fa-check"></i><b>1.7</b> The RL data-stream</a></li>
<li class="chapter" data-level="1.8" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#states-actions-rewards-and-policies"><i class="fa fa-check"></i><b>1.8</b> States, actions, rewards and policies</a></li>
<li class="chapter" data-level="1.9" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#exploitation-vs-exploration"><i class="fa fa-check"></i><b>1.9</b> Exploitation vs Exploration</a></li>
<li class="chapter" data-level="1.10" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-in-action-tic-tac-toe"><i class="fa fa-check"></i><b>1.10</b> RL in action (Tic-Tac-Toe)</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#players-and-learning-to-play"><i class="fa fa-check"></i><b>1.10.1</b> Players and learning to play</a></li>
<li class="chapter" data-level="1.10.2" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#gameplay"><i class="fa fa-check"></i><b>1.10.2</b> Gameplay</a></li>
<li class="chapter" data-level="1.10.3" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-intro-tic-learn"><i class="fa fa-check"></i><b>1.10.3</b> Learning by a sequence of games</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#summary"><i class="fa fa-check"></i><b>1.11</b> Summary</a></li>
<li class="chapter" data-level="1.12" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#sec-rl-intro-ex"><i class="fa fa-check"></i><b>1.12</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.12.1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-self"><i class="fa fa-check"></i><b>1.12.1</b> Exercise - Self-Play</a></li>
<li class="chapter" data-level="1.12.2" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-sym"><i class="fa fa-check"></i><b>1.12.2</b> Exercise - Symmetries</a></li>
<li class="chapter" data-level="1.12.3" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-greedy"><i class="fa fa-check"></i><b>1.12.3</b> Exercise - Greedy Play</a></li>
<li class="chapter" data-level="1.12.4" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-exploit"><i class="fa fa-check"></i><b>1.12.4</b> Exercise - Learning from Exploration</a></li>
<li class="chapter" data-level="1.12.5" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-other"><i class="fa fa-check"></i><b>1.12.5</b> Exercise - Other Improvements</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Tabular methods</b></span></li>
<li class="chapter" data-level="2" data-path="mod-bandit.html"><a href="mod-bandit.html"><i class="fa fa-check"></i><b>2</b> Multi-armed bandits</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mod-bandit.html"><a href="mod-bandit.html#learning-outcomes-1"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="mod-bandit.html"><a href="mod-bandit.html#textbook-readings-1"><i class="fa fa-check"></i><b>2.2</b> Textbook readings</a></li>
<li class="chapter" data-level="2.3" data-path="mod-bandit.html"><a href="mod-bandit.html#the-k-armed-bandit-problem"><i class="fa fa-check"></i><b>2.3</b> The k-armed bandit problem</a></li>
<li class="chapter" data-level="2.4" data-path="mod-bandit.html"><a href="mod-bandit.html#estimating-the-value-of-an-action"><i class="fa fa-check"></i><b>2.4</b> Estimating the value of an action</a></li>
<li class="chapter" data-level="2.5" data-path="mod-bandit.html"><a href="mod-bandit.html#sec-bandit-step-size"><i class="fa fa-check"></i><b>2.5</b> The role of the step-size</a></li>
<li class="chapter" data-level="2.6" data-path="mod-bandit.html"><a href="mod-bandit.html#optimistic-initial-values"><i class="fa fa-check"></i><b>2.6</b> Optimistic initial values</a></li>
<li class="chapter" data-level="2.7" data-path="mod-bandit.html"><a href="mod-bandit.html#upper-confidence-bound-action-selection"><i class="fa fa-check"></i><b>2.7</b> Upper-Confidence Bound Action Selection</a></li>
<li class="chapter" data-level="2.8" data-path="mod-bandit.html"><a href="mod-bandit.html#summary-1"><i class="fa fa-check"></i><b>2.8</b> Summary</a></li>
<li class="chapter" data-level="2.9" data-path="mod-bandit.html"><a href="mod-bandit.html#sec-bandit-ex"><i class="fa fa-check"></i><b>2.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="mod-bandit.html"><a href="mod-bandit.html#ex-bandit-adv"><i class="fa fa-check"></i><b>2.9.1</b> Exercise - Advertising</a></li>
<li class="chapter" data-level="2.9.2" data-path="mod-bandit.html"><a href="mod-bandit.html#ex-bandit-coin"><i class="fa fa-check"></i><b>2.9.2</b> Exercise - A coin game</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html"><i class="fa fa-check"></i><b>3</b> Markov decision processes (MDPs)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#learning-outcomes-2"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#textbook-readings-2"><i class="fa fa-check"></i><b>3.2</b> Textbook readings</a></li>
<li class="chapter" data-level="3.3" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#an-mdp-as-a-model-for-the-agent-environment"><i class="fa fa-check"></i><b>3.3</b> An MDP as a model for the agent-environment</a></li>
<li class="chapter" data-level="3.4" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#rewards-and-the-objective-function-goal"><i class="fa fa-check"></i><b>3.4</b> Rewards and the objective function (goal)</a></li>
<li class="chapter" data-level="3.5" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#summary-2"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
<li class="chapter" data-level="3.6" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#sec-mdp-1-ex"><i class="fa fa-check"></i><b>3.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-seq"><i class="fa fa-check"></i><b>3.6.1</b> Exercise - Sequential decision problems</a></li>
<li class="chapter" data-level="3.6.2" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-exp-return"><i class="fa fa-check"></i><b>3.6.2</b> Exercise - Expected return</a></li>
<li class="chapter" data-level="3.6.3" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-gambler"><i class="fa fa-check"></i><b>3.6.3</b> Exercise - Gambler’s problem</a></li>
<li class="chapter" data-level="3.6.4" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-storage"><i class="fa fa-check"></i><b>3.6.4</b> Exercise - Factory storage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html"><i class="fa fa-check"></i><b>4</b> Policies and value functions for MDPs</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#learning-outcomes-3"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#textbook-readings-3"><i class="fa fa-check"></i><b>4.2</b> Textbook readings</a></li>
<li class="chapter" data-level="4.3" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#policies-and-value-functions"><i class="fa fa-check"></i><b>4.3</b> Policies and value functions</a></li>
<li class="chapter" data-level="4.4" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#sec-mdp-opt"><i class="fa fa-check"></i><b>4.4</b> Optimal policies and value functions</a></li>
<li class="chapter" data-level="4.5" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#optimality-vs-approximation"><i class="fa fa-check"></i><b>4.5</b> Optimality vs approximation</a></li>
<li class="chapter" data-level="4.6" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#semi-mdps-non-fixed-time-length"><i class="fa fa-check"></i><b>4.6</b> Semi-MDPs (non-fixed time length)</a></li>
<li class="chapter" data-level="4.7" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#summary-3"><i class="fa fa-check"></i><b>4.7</b> Summary</a></li>
<li class="chapter" data-level="4.8" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#sec-mdp-2-ex"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#ex-mdp-2-policy"><i class="fa fa-check"></i><b>4.8.1</b> Exercise - Optimal policy</a></li>
<li class="chapter" data-level="4.8.2" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#ex-mdp-2-car"><i class="fa fa-check"></i><b>4.8.2</b> Exercise - Car rental</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-dp.html"><a href="mod-dp.html"><i class="fa fa-check"></i><b>5</b> Dynamic programming</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mod-dp.html"><a href="mod-dp.html#learning-outcomes-4"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="mod-dp.html"><a href="mod-dp.html#textbook-readings-4"><i class="fa fa-check"></i><b>5.2</b> Textbook readings</a></li>
<li class="chapter" data-level="5.3" data-path="mod-dp.html"><a href="mod-dp.html#sec-dp-pe"><i class="fa fa-check"></i><b>5.3</b> Policy evaluation</a></li>
<li class="chapter" data-level="5.4" data-path="mod-dp.html"><a href="mod-dp.html#policy-improvement"><i class="fa fa-check"></i><b>5.4</b> Policy Improvement</a></li>
<li class="chapter" data-level="5.5" data-path="mod-dp.html"><a href="mod-dp.html#policy-iteration"><i class="fa fa-check"></i><b>5.5</b> Policy Iteration</a></li>
<li class="chapter" data-level="5.6" data-path="mod-dp.html"><a href="mod-dp.html#value-iteration"><i class="fa fa-check"></i><b>5.6</b> Value Iteration</a></li>
<li class="chapter" data-level="5.7" data-path="mod-dp.html"><a href="mod-dp.html#generalized-policy-iteration"><i class="fa fa-check"></i><b>5.7</b> Generalized policy iteration</a></li>
<li class="chapter" data-level="5.8" data-path="mod-dp.html"><a href="mod-dp.html#example---factory-storage"><i class="fa fa-check"></i><b>5.8</b> Example - Factory Storage</a></li>
<li class="chapter" data-level="5.9" data-path="mod-dp.html"><a href="mod-dp.html#summary-4"><i class="fa fa-check"></i><b>5.9</b> Summary</a></li>
<li class="chapter" data-level="5.10" data-path="mod-dp.html"><a href="mod-dp.html#exercises"><i class="fa fa-check"></i><b>5.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="mod-dp.html"><a href="mod-dp.html#ex-dp-gambler"><i class="fa fa-check"></i><b>5.10.1</b> Exercise - Gambler’s problem</a></li>
<li class="chapter" data-level="5.10.2" data-path="mod-dp.html"><a href="mod-dp.html#ex-dp-maintain"><i class="fa fa-check"></i><b>5.10.2</b> Exercise - Maintenance problem</a></li>
<li class="chapter" data-level="5.10.3" data-path="mod-dp.html"><a href="mod-dp.html#ex-dp-rental"><i class="fa fa-check"></i><b>5.10.3</b> Exercise - Car rental</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-mc.html"><a href="mod-mc.html"><i class="fa fa-check"></i><b>6</b> Monte Carlo methods for prediction and control</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mod-mc.html"><a href="mod-mc.html#learning-outcomes-5"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="mod-mc.html"><a href="mod-mc.html#textbook-readings-5"><i class="fa fa-check"></i><b>6.2</b> Textbook readings</a></li>
<li class="chapter" data-level="6.3" data-path="mod-mc.html"><a href="mod-mc.html#mc-prediction-evaluation"><i class="fa fa-check"></i><b>6.3</b> MC prediction (evaluation)</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="mod-mc.html"><a href="mod-mc.html#mc-prediction-of-action-values"><i class="fa fa-check"></i><b>6.3.1</b> MC prediction of action-values</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mod-mc.html"><a href="mod-mc.html#mc-control-improvement"><i class="fa fa-check"></i><b>6.4</b> MC control (improvement)</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="mod-mc.html"><a href="mod-mc.html#gpi-with-exploring-starts"><i class="fa fa-check"></i><b>6.4.1</b> GPI with exploring starts</a></li>
<li class="chapter" data-level="6.4.2" data-path="mod-mc.html"><a href="mod-mc.html#gpi-using-epsilon-soft-policies"><i class="fa fa-check"></i><b>6.4.2</b> GPI using <span class="math inline">\(\epsilon\)</span>-soft policies</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mod-mc.html"><a href="mod-mc.html#sec-mc-off-policy"><i class="fa fa-check"></i><b>6.5</b> Off-policy MC prediction</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="mod-mc.html"><a href="mod-mc.html#weighted-importance-sampling"><i class="fa fa-check"></i><b>6.5.1</b> Weighted importance sampling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="mod-mc.html"><a href="mod-mc.html#off-policy-control-improvement"><i class="fa fa-check"></i><b>6.6</b> Off-policy control (improvement)</a></li>
<li class="chapter" data-level="6.7" data-path="mod-mc.html"><a href="mod-mc.html#summary-5"><i class="fa fa-check"></i><b>6.7</b> Summary</a></li>
<li class="chapter" data-level="6.8" data-path="mod-mc.html"><a href="mod-mc.html#exercises-1"><i class="fa fa-check"></i><b>6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mod-td-pred.html"><a href="mod-td-pred.html"><i class="fa fa-check"></i><b>7</b> Temporal difference methods for prediction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mod-td-pred.html"><a href="mod-td-pred.html#learning-outcomes-6"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="7.2" data-path="mod-td-pred.html"><a href="mod-td-pred.html#textbook-readings-6"><i class="fa fa-check"></i><b>7.2</b> Textbook readings</a></li>
<li class="chapter" data-level="7.3" data-path="mod-td-pred.html"><a href="mod-td-pred.html#what-is-td-learning"><i class="fa fa-check"></i><b>7.3</b> What is TD learning?</a></li>
<li class="chapter" data-level="7.4" data-path="mod-td-pred.html"><a href="mod-td-pred.html#td-prediction"><i class="fa fa-check"></i><b>7.4</b> TD prediction</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mod-td-pred.html"><a href="mod-td-pred.html#td-prediction-for-action-values"><i class="fa fa-check"></i><b>7.4.1</b> TD prediction for action-values</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mod-td-pred.html"><a href="mod-td-pred.html#benefits-of-td-methods"><i class="fa fa-check"></i><b>7.5</b> Benefits of TD methods</a></li>
<li class="chapter" data-level="7.6" data-path="mod-td-pred.html"><a href="mod-td-pred.html#exercises-2"><i class="fa fa-check"></i><b>7.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="mod-td-pred.html"><a href="mod-td-pred.html#ex-td-pred-random"><i class="fa fa-check"></i><b>7.6.1</b> Exercise - A randow walk</a></li>
<li class="chapter" data-level="7.6.2" data-path="mod-td-pred.html"><a href="mod-td-pred.html#ex-td-pred-off-policy"><i class="fa fa-check"></i><b>7.6.2</b> Exercise - Off-policy TD</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-td-control.html"><a href="mod-td-control.html"><i class="fa fa-check"></i><b>8</b> Temporal difference methods for control</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-td-control.html"><a href="mod-td-control.html#learning-outcomes-7"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="8.2" data-path="mod-td-control.html"><a href="mod-td-control.html#textbook-readings-7"><i class="fa fa-check"></i><b>8.2</b> Textbook readings</a></li>
<li class="chapter" data-level="8.3" data-path="mod-td-control.html"><a href="mod-td-control.html#sarsa---on-policy-gpi-using-td"><i class="fa fa-check"></i><b>8.3</b> SARSA - On-policy GPI using TD</a></li>
<li class="chapter" data-level="8.4" data-path="mod-td-control.html"><a href="mod-td-control.html#q-learning---off-policy-gpi-using-td"><i class="fa fa-check"></i><b>8.4</b> Q-learning - Off-policy GPI using TD</a></li>
<li class="chapter" data-level="8.5" data-path="mod-td-control.html"><a href="mod-td-control.html#expected-sarsa---gpi-using-td"><i class="fa fa-check"></i><b>8.5</b> Expected SARSA - GPI using TD</a></li>
<li class="chapter" data-level="8.6" data-path="mod-td-control.html"><a href="mod-td-control.html#summary-6"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
<li class="chapter" data-level="8.7" data-path="mod-td-control.html"><a href="mod-td-control.html#exercises-3"><i class="fa fa-check"></i><b>8.7</b> Exercises</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="mod-r-setup.html"><a href="mod-r-setup.html"><i class="fa fa-check"></i><b>A</b> Setting up R</a></li>
<li class="chapter" data-level="B" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>B</b> Working in groups</a></li>
<li class="chapter" data-level="C" data-path="coding-convention.html"><a href="coding-convention.html"><i class="fa fa-check"></i><b>C</b> Coding/naming convention</a>
<ul>
<li class="chapter" data-level="C.1" data-path="coding-convention.html"><a href="coding-convention.html#commenting-your-code"><i class="fa fa-check"></i><b>C.1</b> Commenting your code</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>D</b> Annotate the course notes</a></li>
<li class="chapter" data-level="E" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>E</b> Getting help</a></li>
<li class="chapter" data-level="F" data-path="mod-lg-course.html"><a href="mod-lg-course.html"><i class="fa fa-check"></i><b>F</b> Learning goals</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reinforcement Learning for Business (RL)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-dp" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Module 5</span> Dynamic programming<a href="mod-dp.html#mod-dp" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The term <em>Dynamic Programming</em> (<em>DP</em>) refers to a collection of algorithms that can be used to compute optimal policies of a model with full information about the dynamics, e.g. a Markov Decision Process (MDP). A DP model must satisfy the <em>principle of optimality</em>. That is, an optimal policy must consist for optimal sub-polices or alternatively the optimal value function in a state can be calculated using optimal value functions in future states. This is indeed what is described with the Bellman optimality equations.</p>
<p>DP do both <em>policy evaluation</em> (prediction) and <em>control</em>. Policy evaluation give us the value function <span class="math inline">\(v_\pi\)</span> given a policy <span class="math inline">\(\pi\)</span>. Control refer to finding the best policy or optimizing the value function. This can be done using the Bellman optimality equations.</p>
<p>Two main problems arise with DP. First, often we do not have full information about the MDP model, e.g. the rewards or transition probabilities are unknown. Second, we need to calculate the value function in all states using the rewards, actions, and transition probabilities. Hence, using DP may be computationally expensive if we have a large number of states and actions.</p>
<p>Note the term programming in DP have nothing to do with a computer program but comes from that the mathematical model is called a “program”.</p>
<div id="learning-outcomes-4" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Learning outcomes<a href="mod-dp.html#learning-outcomes-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By the end of this module, you are expected to:</p>
<ul>
<li>Describe the distinction between policy evaluation and control.</li>
<li>Identify when DP can be applied, as well as its limitations.</li>
<li>Explain and apply iterative policy evaluation for estimating state-values given a policy.</li>
<li>Interpret the policy improvement theorem.</li>
<li>Explain and apply policy iteration for finding an optimal policy.</li>
<li>Explain and apply value iteration for finding an optimal policy.</li>
<li>Describe the ideas behind generalized policy iteration.</li>
<li>Interpret the distinction between synchronous and asynchronous dynamic programming methods.</li>
</ul>
<p>The learning outcomes relate to the <a href="mod-lg-course.html#mod-lg-course">overall learning goals</a> number 2, 4, 6, 7, 8, 10 and 12 of the course.</p>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="textbook-readings-4" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Textbook readings<a href="mod-dp.html#textbook-readings-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For this week, you will need to read Chapter 4-4.7 in <span class="citation">Sutton and Barto (<a href="#ref-Sutton18" role="doc-biblioref">2018</a>)</span>. Read it before continuing this module. A summary of the book notation can be seen <a href="https://bss-osca.github.io/rl/sutton-notation.pdf">here</a>.</p>
<div>
Slides for this module can be seen
<a href="https://bss-osca.github.io/rl/slides/05_dp-slides.html" target="_blank">here.</a>
You do not have to look at them before the lecture!
</div>
</div>
<div id="sec-dp-pe" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Policy evaluation<a href="mod-dp.html#sec-dp-pe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The state-value function can be represented using the Bellman equation <a href="mod-mdp-2.html#eq:bell-state">(4.2)</a>:
<span class="math display" id="eq:bm-pol-eval">\[
v_\pi(s) = \sum_{a \in \mathcal{A}}\pi(a | s)\left( r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) v_\pi(s&#39;)\right).            
\tag{5.1}
\]</span></p>
<p>If the dynamics are known perfectly, this becomes a system of <span class="math inline">\(|\mathcal{S}|\)</span> simultaneous linear equations in <span class="math inline">\(|\mathcal{S}|\)</span> unknowns <span class="math inline">\(v_\pi(s), s \in \mathcal{S}\)</span>. This linear system can be solved using e.g. some software. However, inverting the matrix can be computationally expensive for a large state space. Instead we consider an iterative method and a sequence of value function approximations <span class="math inline">\(v_0, v_1, v_2, \ldots\)</span>, with initial approximation <span class="math inline">\(v_0\)</span> chosen arbitrarily e.g. <span class="math inline">\(v_0(s) = 0 \: \forall s\)</span> (ensuring terminal state = 0). We can use <em>a sweep</em> with the Bellman equation to update the values:</p>
<p><span class="math display">\[\begin{equation}
v_{k+1}(s) = \sum_{a \in \mathcal{A}}\pi(a | s)\left( r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) v_k(s&#39;)\right) 
\end{equation}\]</span></p>
<p>We call this update an <em>expected update</em> because it is based on the expectation over all possible next states, rather than a sample of reward from the next state. This update will converge to <span class="math inline">\(v_\pi\)</span> after a number of sweeps of the state-space. Since we do not want an infinite number of sweeps we introduce a threshold <span class="math inline">\(\theta\)</span> (see Figure <a href="mod-dp.html#fig:policy-eval-alg">5.1</a>). Note the algorithm uses two arrays to maintain the state-value (<span class="math inline">\(v\)</span> and <span class="math inline">\(V\)</span>). Alternatively, a single array could be used that update values in place, i.e. <span class="math inline">\(V\)</span> is used in place of <span class="math inline">\(v\)</span>. Hence, state-values are updated faster.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:policy-eval-alg"></span>
<img src="img/policy-evalution.png" alt="Iterative policy evaluation [@Sutton18]."  />
<p class="caption">
Figure 5.1: Iterative policy evaluation <span class="citation">(<a href="#ref-Sutton18" role="doc-biblioref">Sutton and Barto 2018</a>)</span>.
</p>
</div>
</div>
<div id="policy-improvement" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Policy Improvement<a href="mod-dp.html#policy-improvement" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From the Bellman optimality equation <a href="mod-mdp-2.html#eq:bell-opt-state">(4.4)</a> we have</p>
<p><span class="math display" id="eq:pi-det">\[
\begin{align}
\pi_*(s) &amp;= \arg\max_{a \in \mathcal{A}} q_*(s, a) \\
         &amp;= \arg\max_{a \in \mathcal{A}} \left(r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) v_*(s&#39;)\right).
\end{align}
\tag{5.2}
\]</span>
That is, a deterministic optimal policy can be found by choosing <em>greedy</em> the best action given the optimal value function. If we apply this greed action selection to the value function for a policy <span class="math inline">\(\pi\)</span> and pick the action with most <span class="math inline">\(q\)</span>:
<span class="math display" id="eq:pi-mark-det">\[
\begin{align}
\pi&#39;(s) &amp;= \arg\max_{a \in \mathcal{A}} q_\pi(s, a) \\
         &amp;= \arg\max_{a \in \mathcal{A}} \left(r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) v_\pi(s&#39;)\right),
\end{align}
\tag{5.3}
\]</span>
then
<span class="math display">\[
q_\pi(s, \pi&#39;(s)) \geq q_\pi(s, \pi(s)) = v_\pi(s) \quad \forall s \in \mathcal{S}.
\]</span>
Note if <span class="math inline">\(\pi&#39;(s) = \pi(s), \forall s\in\mathcal{S}\)</span> then the Bellman optimality equation <a href="mod-mdp-2.html#eq:bell-opt-state">(4.4)</a> holds and <span class="math inline">\(\pi\)</span> must be optimal; Otherwise,
<span class="math display">\[
\begin{align}
  v_\pi(s) &amp;\leq q_\pi(s, \pi&#39;(s)) = \mathbb{E}_{\pi&#39;}[R_{t+1} + \gamma v_\pi(S_{t+1}) | S_t = s] \\
&amp;\leq \mathbb{E}_{\pi&#39;}[R_{t+1} + \gamma q_\pi(S_{t+1}, \pi&#39;(S_{t+1})) | S_t = s] \\
&amp;\leq \mathbb{E}_{\pi&#39;}[R_{t+1} + \gamma (R_{t+2} + \gamma^2 v_\pi(S_{t+2})) | S_t = s] \\
&amp;\leq \mathbb{E}_{\pi&#39;}[R_{t+1} + \gamma R_{t+2} + \gamma^2 q_\pi(S_{t+2}, \pi&#39;(S_{t+2})) | S_t = s] \\
&amp;\leq \mathbb{E}_{\pi&#39;}[R_{t+1} + \gamma R_{t+2} + \gamma^2 R_{t+3} + ...)) | S_t = s] \\
&amp;= v_{\pi&#39;}(s),
\end{align}
\]</span>
That is, policy <span class="math inline">\(\pi&#39;\)</span> is strictly better than policy <span class="math inline">\(\pi\)</span> since there is at least one state <span class="math inline">\(s\)</span> for which <span class="math inline">\(v_{\pi&#39;}(s) &gt; v_\pi(s)\)</span>. We can formalize the above deductions in a theorem.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-1" class="theorem"><strong>Theorem 5.1  (Policy improvement theorem) </strong></span>Let <span class="math inline">\(\pi\)</span>, <span class="math inline">\(\pi&#39;\)</span> be any pair of deterministic policies, such that
<span class="math display">\[\begin{equation}
    q_\pi(s, \pi&#39;(s)) \geq v_\pi(s) \quad \forall s \in \mathcal{S}.
\end{equation}\]</span>
That is, <span class="math inline">\(\pi&#39;\)</span> is as least as good as <span class="math inline">\(\pi\)</span>.</p>
</div>
</div>
<div id="policy-iteration" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Policy Iteration<a href="mod-dp.html#policy-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Given the policy improvement theorem we can now improve policies iteratively until we find an optimal policy:</p>
<ol style="list-style-type: decimal">
<li>Pick an arbitrary initial policy <span class="math inline">\(\pi\)</span>.</li>
<li>Given a policy <span class="math inline">\(\pi\)</span>, estimate <span class="math inline">\(v_\pi(s)\)</span> via the policy evaluation algorithm.</li>
<li>Generate a new, improved policy <span class="math inline">\(\pi&#39; \geq \pi\)</span> by <em>greedily</em> picking <span class="math inline">\(\pi&#39; = \text{greedy}(v_\pi)\)</span> using Eq. <a href="mod-dp.html#eq:pi-mark-det">(5.3)</a>. If <span class="math inline">\(\pi&#39;=\pi\)</span> then stop (<span class="math inline">\(\pi_*\)</span> has been found); otherwise go to Step 2.</li>
</ol>
<p>The algorithm is given in Figure <a href="mod-dp.html#fig:policy-ite-alg">5.2</a>. The sequence of calculations will be:
<span class="math display">\[\pi_0 \xrightarrow[]{E} v_{\pi_0} \xrightarrow[]{I} \pi_1 \xrightarrow[]{E} v_{\pi_1} \xrightarrow[]{I} \pi_2 \xrightarrow[]{E} v_{\pi_2}  \ldots \xrightarrow[]{I} \pi_* \xrightarrow[]{E} v_{*}\]</span>
The number of steps of policy iteration needed to find the optimal policy are often low.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:policy-ite-alg"></span>
<img src="img/policy-iteration.png" alt="Policy iteration [@Sutton18]." width="70%" />
<p class="caption">
Figure 5.2: Policy iteration <span class="citation">(<a href="#ref-Sutton18" role="doc-biblioref">Sutton and Barto 2018</a>)</span>.
</p>
</div>
</div>
<div id="value-iteration" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Value Iteration<a href="mod-dp.html#value-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Policy iteration requires full policy evaluation at each iteration step. This could be an computationally expensive process which requires may sweeps of the state space. In <em>value iteration</em>, the policy evaluation is stopped after one sweep of the state space. Value iteration is achieved by turning the Bellman optimality equation into an update rule:
<span class="math display">\[
v_{k+1}(s) = \max_a \left(r(s,a) + \gamma\sum_{s&#39;} p(s&#39;|s, a)v_k(s&#39;)\right)
\]</span>
Value iteration effectively combines, in each of its sweeps, one sweep of policy evaluation and one sweep of policy improvement, since it performs a greedy update while also evaluating the current policy. Also, it is important to understand that the value-iteration algorithm does not require a policy to work. No actions have to be chosen. Rather, the state-values are updated and after the last step of value-iteration the optimal policy <span class="math inline">\(\pi_*\)</span> is found:</p>
<span class="math display">\[
\pi_*(s) = \arg\max_{a \in \mathcal{A}} \left(r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) v_*(s&#39;)\right),
\]</span>
The algorithm is given in Figure <a href="mod-dp.html#fig:value-ite-alg">5.3</a>. Since we do not want an infinite number of iterations we introduce a threshold <span class="math inline">\(\theta\)</span>. The sequence of calculations will be (where G denotes greedy action selection):
<span class="math display">\[v_{0} \xrightarrow[]{EI} v_{1} \xrightarrow[]{EI} v_{2}  \ldots \xrightarrow[]{EI} v_{*} \xrightarrow[]{G} \pi_{*}\]</span>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:value-ite-alg"></span>
<img src="img/value-iteration.png" alt="Value iteration [@Sutton18]." width="70%" />
<p class="caption">
Figure 5.3: Value iteration <span class="citation">(<a href="#ref-Sutton18" role="doc-biblioref">Sutton and Barto 2018</a>)</span>.
</p>
</div>
</div>
<div id="generalized-policy-iteration" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> Generalized policy iteration<a href="mod-dp.html#generalized-policy-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generalised Policy Iteration (GPI) is the process of letting policy evaluation and policy improvement interact, independent of granularity. For instance, improvement/evaluation can be performed by doing complete sweeps of the state space (policy iteration), or improve the state-value using a single sweep of the state space (value iteration). GPI can also do <em>asynchronous</em> updates of the state-value where states are updated individually, in any order. This can
significantly improve computation. Examples on asynchronous DP are</p>
<ul>
<li><p><em>In-place DP</em> mentioned in Section <a href="mod-dp.html#sec-dp-pe">5.3</a> where instead of keeping a copy of the old and new value function in each value-iteration update, you can just update the value functions in-place. Hence asynchronous updates in other parts of the state-space will directly be affected resulting in faster updates.</p></li>
<li><p><em>Prioritized sweeping</em> where we keep track of how “effective” or “significant” updates to our state-values are. States where the updates are more significant are likely further away from converging to the optimal value. As such, we would like to update them first. For this, we would compute the <em>Bellman error</em>:
<span class="math display">\[|v_{k+1}(s) - v_k(s)|,\]</span>
and keep these values in a priority queue. You can then efficiently pop the top of it to always get the state you should update next.</p></li>
<li><p><em>Prioritize local updates</em> where you update nearby states given the current state, e.g. if your robot is in a particular region of the grid, it is much more important to update nearby states than faraway ones.</p></li>
</ul>
<p>GPI works and will convergence to the optimal policy and optimal value function if the states are visited (in theory) an infinite number of times. That is, you must explore the whole state space for GPI to work.</p>
</div>
<div id="example---factory-storage" class="section level2 hasAnchor" number="5.8">
<h2><span class="header-section-number">5.8</span> Example - Factory Storage<a href="mod-dp.html#example---factory-storage" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let us consider Exercise <a href="mod-mdp-1.html#ex-mdp-1-storage">3.6.4</a> where a factory has a storage tank with a capacity of 4 <span class="math inline">\(\mathrm{m}^{3}\)</span> for temporarily storing waste produced by the factory. Each week the factory produces <span class="math inline">\(0,1\)</span>, 2 or 3 <span class="math inline">\(\mathrm{m}^{3}\)</span> waste with respective probabilities
<span class="math display">\[p_{0}=\displaystyle \frac{1}{8},\ p_{1}=\displaystyle \frac{1}{2},\ p_{2}=\displaystyle \frac{1}{4} \text{ and } p_{3}=\displaystyle \frac{1}{8}.\]</span>
If the amount of waste produced in one week exceeds the remaining capacity of the tank, the excess is specially removed at a cost of $30 per cubic metre. At the end of each week there is a regular opportunity to remove all waste from the storage tank at a fixed cost of $25 and a variable cost of $5 per cubic metre.</p>
<p>The problem can be modelled as a finite MDP where a state denote the amount of waste in the tank at the end of week <span class="math inline">\(n\)</span> just before the regular removal opportunity <span class="math display">\[\mathcal{S} = \{ 0,1,2,3,4 \}.\]</span>
The action space is <span class="math display">\[\mathcal{A}(s) = \{ empty, keep \}.\]</span>
The expected cost of a given state and action is the cost of empting the container and the expected cost of a special removal during the next week. Hence the expected reward is <span class="math display">\[r(s, e) = -(25 + 5s)\]</span>
and <span class="math display">\[r(s,k) = -30\sum_{i&gt;4-s} (s+i-4)p_i.\]</span>
Finally, the transition probabilities are:
<span class="math display">\[
\begin{align} 
   p(s&#39;|s,k) &amp;= p_{s&#39;-s}\text{ if } s\leq s&#39; \leq 3, \\
   p(4|s,k)  &amp;= \sum_{i\geq 4-s} p_i, \\
   p(s&#39;|s,e) &amp;= p_{s&#39;}\text{ if }  0\leq s&#39; \leq 4, \\
   p(s&#39;|s,a) &amp;=  0 \text{ otherwise.}
\end{align}
\]</span></p>
<p>For solving the MDP we implement an MDP R6 class in R:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="mod-dp.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb29-2"><a href="mod-dp.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hash)</span>
<span id="cb29-3"><a href="mod-dp.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb29-4"><a href="mod-dp.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="mod-dp.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; R6 Class representing the MDP</span></span>
<span id="cb29-6"><a href="mod-dp.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb29-7"><a href="mod-dp.html#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Note since the MDP is a model with full information, we combine the agent and environment into a single class.</span></span>
<span id="cb29-8"><a href="mod-dp.html#cb29-8" aria-hidden="true" tabindex="-1"></a>MDPClass <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;MDPClass&quot;</span>,</span>
<span id="cb29-9"><a href="mod-dp.html#cb29-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb29-10"><a href="mod-dp.html#cb29-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-11"><a href="mod-dp.html#cb29-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @field model The Markov decision process (model). The model is represented </span></span>
<span id="cb29-12"><a href="mod-dp.html#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; using a hash list for the states. Each states contains a list with `actions`: a hash </span></span>
<span id="cb29-13"><a href="mod-dp.html#cb29-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; list with actions and `pi` a vector with policy pr (named vector with only </span></span>
<span id="cb29-14"><a href="mod-dp.html#cb29-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; positive values). The `actions` hash list contains actions with trans </span></span>
<span id="cb29-15"><a href="mod-dp.html#cb29-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; pr `pr` (named vector only with positive values) and expected reward `reward`.</span></span>
<span id="cb29-16"><a href="mod-dp.html#cb29-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> <span class="cn">NULL</span>,  </span>
<span id="cb29-17"><a href="mod-dp.html#cb29-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-18"><a href="mod-dp.html#cb29-18" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @field sV The state-values stored in a hash.</span></span>
<span id="cb29-19"><a href="mod-dp.html#cb29-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">v =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-20"><a href="mod-dp.html#cb29-20" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-21"><a href="mod-dp.html#cb29-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Create an object (when call new).</span></span>
<span id="cb29-22"><a href="mod-dp.html#cb29-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @return The new object.</span></span>
<span id="cb29-23"><a href="mod-dp.html#cb29-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">initialize =</span> <span class="cf">function</span>() {</span>
<span id="cb29-24"><a href="mod-dp.html#cb29-24" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">hash</span>()</span>
<span id="cb29-25"><a href="mod-dp.html#cb29-25" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>v <span class="ot">&lt;-</span> <span class="fu">hash</span>()</span>
<span id="cb29-26"><a href="mod-dp.html#cb29-26" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-27"><a href="mod-dp.html#cb29-27" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-28"><a href="mod-dp.html#cb29-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add the states (keys/strings in the hash)</span></span>
<span id="cb29-29"><a href="mod-dp.html#cb29-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s A vector of states (converted to strings).</span></span>
<span id="cb29-30"><a href="mod-dp.html#cb29-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">addStateSpace =</span> <span class="cf">function</span>(s) {</span>
<span id="cb29-31"><a href="mod-dp.html#cb29-31" aria-hidden="true" tabindex="-1"></a>         keys <span class="ot">&lt;-</span> <span class="fu">make.keys</span>(s)</span>
<span id="cb29-32"><a href="mod-dp.html#cb29-32" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[keys] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">pi =</span> <span class="cn">NA</span>)   <span class="co"># don&#39;t use pi = NULL since then won&#39;t be defined </span></span>
<span id="cb29-33"><a href="mod-dp.html#cb29-33" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span><span class="fu">setStateValue</span>()  <span class="co"># so v defined</span></span>
<span id="cb29-34"><a href="mod-dp.html#cb29-34" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-35"><a href="mod-dp.html#cb29-35" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-36"><a href="mod-dp.html#cb29-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-37"><a href="mod-dp.html#cb29-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add the actions to a state</span></span>
<span id="cb29-38"><a href="mod-dp.html#cb29-38" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param stateStr State key/string.</span></span>
<span id="cb29-39"><a href="mod-dp.html#cb29-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param a A vector of actions (converted to strings).</span></span>
<span id="cb29-40"><a href="mod-dp.html#cb29-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">addActionSpace =</span> <span class="cf">function</span>(stateStr, a) {</span>
<span id="cb29-41"><a href="mod-dp.html#cb29-41" aria-hidden="true" tabindex="-1"></a>         a <span class="ot">&lt;-</span> <span class="fu">make.keys</span>(a)</span>
<span id="cb29-42"><a href="mod-dp.html#cb29-42" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[stateStr]]<span class="sc">$</span>actions <span class="ot">&lt;-</span> <span class="fu">hash</span>()</span>
<span id="cb29-43"><a href="mod-dp.html#cb29-43" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[stateStr]]<span class="sc">$</span>actions[a] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb29-44"><a href="mod-dp.html#cb29-44" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-45"><a href="mod-dp.html#cb29-45" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-46"><a href="mod-dp.html#cb29-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-47"><a href="mod-dp.html#cb29-47" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add expected reward and trans pr to an action</span></span>
<span id="cb29-48"><a href="mod-dp.html#cb29-48" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param stateStr State key/string.</span></span>
<span id="cb29-49"><a href="mod-dp.html#cb29-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param actionStr Action key/string.</span></span>
<span id="cb29-50"><a href="mod-dp.html#cb29-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param r The expected reward.</span></span>
<span id="cb29-51"><a href="mod-dp.html#cb29-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param pr A named vector with positive trans pr. The name of an element must be the state key.</span></span>
<span id="cb29-52"><a href="mod-dp.html#cb29-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">addAction =</span> <span class="cf">function</span>(stateStr, actionStr, r, pr) {</span>
<span id="cb29-53"><a href="mod-dp.html#cb29-53" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (<span class="sc">!</span><span class="fu">has.key</span>(stateStr, self<span class="sc">$</span>model)) {</span>
<span id="cb29-54"><a href="mod-dp.html#cb29-54" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">addStateSpace</span>(stateStr)</span>
<span id="cb29-55"><a href="mod-dp.html#cb29-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># self$model[make.keys(stateStr)] &lt;- hash(pi = NA, actions = hash())</span></span>
<span id="cb29-56"><a href="mod-dp.html#cb29-56" aria-hidden="true" tabindex="-1"></a>         } </span>
<span id="cb29-57"><a href="mod-dp.html#cb29-57" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[stateStr]]<span class="sc">$</span>actions[[actionStr]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">r =</span> r, <span class="at">pr =</span> pr)</span>
<span id="cb29-58"><a href="mod-dp.html#cb29-58" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-59"><a href="mod-dp.html#cb29-59" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-60"><a href="mod-dp.html#cb29-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-61"><a href="mod-dp.html#cb29-61" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the state-value of states</span></span>
<span id="cb29-62"><a href="mod-dp.html#cb29-62" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param stateStr A vector of state keys.</span></span>
<span id="cb29-63"><a href="mod-dp.html#cb29-63" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param value The value.</span></span>
<span id="cb29-64"><a href="mod-dp.html#cb29-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">setStateValue =</span> <span class="cf">function</span>(<span class="at">stateStr =</span> <span class="fu">keys</span>(self<span class="sc">$</span>model), <span class="at">value =</span> <span class="dv">0</span>) {</span>
<span id="cb29-65"><a href="mod-dp.html#cb29-65" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>v[stateStr] <span class="ot">&lt;-</span> value</span>
<span id="cb29-66"><a href="mod-dp.html#cb29-66" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-67"><a href="mod-dp.html#cb29-67" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-68"><a href="mod-dp.html#cb29-68" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-69"><a href="mod-dp.html#cb29-69" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the policy to a random determistic policy.</span></span>
<span id="cb29-70"><a href="mod-dp.html#cb29-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">setRandomDeterministicPolicy =</span> <span class="cf">function</span>() {</span>
<span id="cb29-71"><a href="mod-dp.html#cb29-71" aria-hidden="true" tabindex="-1"></a>         stateStr <span class="ot">=</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb29-72"><a href="mod-dp.html#cb29-72" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> stateStr) {</span>
<span id="cb29-73"><a href="mod-dp.html#cb29-73" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb29-74"><a href="mod-dp.html#cb29-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi) <span class="ot">&lt;-</span> <span class="fu">sample</span>(self<span class="sc">$</span><span class="fu">getActionKeys</span>(s), <span class="dv">1</span>)</span>
<span id="cb29-75"><a href="mod-dp.html#cb29-75" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-76"><a href="mod-dp.html#cb29-76" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-77"><a href="mod-dp.html#cb29-77" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-78"><a href="mod-dp.html#cb29-78" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-79"><a href="mod-dp.html#cb29-79" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set a deterministic policy</span></span>
<span id="cb29-80"><a href="mod-dp.html#cb29-80" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param sa A named vector with action keys and names equal state keys-</span></span>
<span id="cb29-81"><a href="mod-dp.html#cb29-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">setDeterministicPolicy =</span> <span class="cf">function</span>(sa) {</span>
<span id="cb29-82"><a href="mod-dp.html#cb29-82" aria-hidden="true" tabindex="-1"></a>         states <span class="ot">&lt;-</span> <span class="fu">names</span>(sa)</span>
<span id="cb29-83"><a href="mod-dp.html#cb29-83" aria-hidden="true" tabindex="-1"></a>         pi <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb29-84"><a href="mod-dp.html#cb29-84" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sa)) {</span>
<span id="cb29-85"><a href="mod-dp.html#cb29-85" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(pi) <span class="ot">&lt;-</span> sa[i]</span>
<span id="cb29-86"><a href="mod-dp.html#cb29-86" aria-hidden="true" tabindex="-1"></a>            s <span class="ot">&lt;-</span> states[i]</span>
<span id="cb29-87"><a href="mod-dp.html#cb29-87" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi <span class="ot">&lt;-</span> pi</span>
<span id="cb29-88"><a href="mod-dp.html#cb29-88" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-89"><a href="mod-dp.html#cb29-89" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-90"><a href="mod-dp.html#cb29-90" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-91"><a href="mod-dp.html#cb29-91" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-92"><a href="mod-dp.html#cb29-92" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the state keys</span></span>
<span id="cb29-93"><a href="mod-dp.html#cb29-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">getStateKeys =</span> <span class="cf">function</span>() {</span>
<span id="cb29-94"><a href="mod-dp.html#cb29-94" aria-hidden="true" tabindex="-1"></a>         <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb29-95"><a href="mod-dp.html#cb29-95" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-96"><a href="mod-dp.html#cb29-96" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-97"><a href="mod-dp.html#cb29-97" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the action keys</span></span>
<span id="cb29-98"><a href="mod-dp.html#cb29-98" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s The state considered.</span></span>
<span id="cb29-99"><a href="mod-dp.html#cb29-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionKeys =</span> <span class="cf">function</span>(s) {</span>
<span id="cb29-100"><a href="mod-dp.html#cb29-100" aria-hidden="true" tabindex="-1"></a>         <span class="fu">keys</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions) </span>
<span id="cb29-101"><a href="mod-dp.html#cb29-101" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-102"><a href="mod-dp.html#cb29-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-103"><a href="mod-dp.html#cb29-103" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the expected reward and trans pr of actions in a state</span></span>
<span id="cb29-104"><a href="mod-dp.html#cb29-104" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s The state considered.</span></span>
<span id="cb29-105"><a href="mod-dp.html#cb29-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionInfo =</span> <span class="cf">function</span>(s) {</span>
<span id="cb29-106"><a href="mod-dp.html#cb29-106" aria-hidden="true" tabindex="-1"></a>         <span class="fu">as.list</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions) </span>
<span id="cb29-107"><a href="mod-dp.html#cb29-107" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-108"><a href="mod-dp.html#cb29-108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-109"><a href="mod-dp.html#cb29-109" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the current policy as a tibble</span></span>
<span id="cb29-110"><a href="mod-dp.html#cb29-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">getPolicy =</span> <span class="cf">function</span>() {</span>
<span id="cb29-111"><a href="mod-dp.html#cb29-111" aria-hidden="true" tabindex="-1"></a>         <span class="co"># if (all(sapply(self$model, FUN = function(s) {s$pi}) == 1)) { # deterministic policy</span></span>
<span id="cb29-112"><a href="mod-dp.html#cb29-112" aria-hidden="true" tabindex="-1"></a>         <span class="co">#    sapply(self$model, FUN = function(s) {names(s$pi)})</span></span>
<span id="cb29-113"><a href="mod-dp.html#cb29-113" aria-hidden="true" tabindex="-1"></a>         <span class="co"># } else {</span></span>
<span id="cb29-114"><a href="mod-dp.html#cb29-114" aria-hidden="true" tabindex="-1"></a>         <span class="fu">map_dfr</span>(self<span class="sc">$</span><span class="fu">getStateKeys</span>(), <span class="at">.f =</span> <span class="cf">function</span>(s) {</span>
<span id="cb29-115"><a href="mod-dp.html#cb29-115" aria-hidden="true" tabindex="-1"></a>               <span class="fu">list</span>(<span class="at">state =</span> s, <span class="at">action =</span> <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi), <span class="at">pr =</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi)</span>
<span id="cb29-116"><a href="mod-dp.html#cb29-116" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb29-117"><a href="mod-dp.html#cb29-117" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-118"><a href="mod-dp.html#cb29-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-119"><a href="mod-dp.html#cb29-119" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the state-values as a tibble</span></span>
<span id="cb29-120"><a href="mod-dp.html#cb29-120" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s A vector of state keys.</span></span>
<span id="cb29-121"><a href="mod-dp.html#cb29-121" aria-hidden="true" tabindex="-1"></a>      <span class="at">getStateValues =</span> <span class="cf">function</span>(<span class="at">s =</span> <span class="fu">keys</span>(self<span class="sc">$</span>v)) {</span>
<span id="cb29-122"><a href="mod-dp.html#cb29-122" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tibble</span>(<span class="at">state =</span> s, <span class="at">v =</span> <span class="fu">values</span>(self<span class="sc">$</span>v, <span class="at">keys =</span> s))</span>
<span id="cb29-123"><a href="mod-dp.html#cb29-123" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-124"><a href="mod-dp.html#cb29-124" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-125"><a href="mod-dp.html#cb29-125" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return a matrix with trans pr for a given action. </span></span>
<span id="cb29-126"><a href="mod-dp.html#cb29-126" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param a Action key.</span></span>
<span id="cb29-127"><a href="mod-dp.html#cb29-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">getTransPrActionMat =</span> <span class="cf">function</span>(a) {</span>
<span id="cb29-128"><a href="mod-dp.html#cb29-128" aria-hidden="true" tabindex="-1"></a>         states <span class="ot">&lt;-</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb29-129"><a href="mod-dp.html#cb29-129" aria-hidden="true" tabindex="-1"></a>         m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(states), <span class="at">ncol =</span> <span class="fu">length</span>(states))</span>
<span id="cb29-130"><a href="mod-dp.html#cb29-130" aria-hidden="true" tabindex="-1"></a>         <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> states</span>
<span id="cb29-131"><a href="mod-dp.html#cb29-131" aria-hidden="true" tabindex="-1"></a>         <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> states</span>
<span id="cb29-132"><a href="mod-dp.html#cb29-132" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb29-133"><a href="mod-dp.html#cb29-133" aria-hidden="true" tabindex="-1"></a>            m[s, <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>pr)] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>pr</span>
<span id="cb29-134"><a href="mod-dp.html#cb29-134" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-135"><a href="mod-dp.html#cb29-135" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(m)</span>
<span id="cb29-136"><a href="mod-dp.html#cb29-136" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-137"><a href="mod-dp.html#cb29-137" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-138"><a href="mod-dp.html#cb29-138" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Returns all rewards in a matrix</span></span>
<span id="cb29-139"><a href="mod-dp.html#cb29-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">getRewardMat =</span> <span class="cf">function</span>() {</span>
<span id="cb29-140"><a href="mod-dp.html#cb29-140" aria-hidden="true" tabindex="-1"></a>         states <span class="ot">&lt;-</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb29-141"><a href="mod-dp.html#cb29-141" aria-hidden="true" tabindex="-1"></a>         actions <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">sapply</span>(states, <span class="cf">function</span>(s) self<span class="sc">$</span><span class="fu">getActionKeys</span>(s))))</span>
<span id="cb29-142"><a href="mod-dp.html#cb29-142" aria-hidden="true" tabindex="-1"></a>         m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(states), <span class="at">ncol =</span> <span class="fu">length</span>(actions))</span>
<span id="cb29-143"><a href="mod-dp.html#cb29-143" aria-hidden="true" tabindex="-1"></a>         <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> actions</span>
<span id="cb29-144"><a href="mod-dp.html#cb29-144" aria-hidden="true" tabindex="-1"></a>         <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> states</span>
<span id="cb29-145"><a href="mod-dp.html#cb29-145" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb29-146"><a href="mod-dp.html#cb29-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (a <span class="cf">in</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)) {</span>
<span id="cb29-147"><a href="mod-dp.html#cb29-147" aria-hidden="true" tabindex="-1"></a>               m[s, a] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>r</span>
<span id="cb29-148"><a href="mod-dp.html#cb29-148" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-149"><a href="mod-dp.html#cb29-149" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-150"><a href="mod-dp.html#cb29-150" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(m)</span>
<span id="cb29-151"><a href="mod-dp.html#cb29-151" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-152"><a href="mod-dp.html#cb29-152" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-153"><a href="mod-dp.html#cb29-153" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Bellman calculations for a given state and action</span></span>
<span id="cb29-154"><a href="mod-dp.html#cb29-154" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb29-155"><a href="mod-dp.html#cb29-155" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s State key.</span></span>
<span id="cb29-156"><a href="mod-dp.html#cb29-156" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param a Action key.</span></span>
<span id="cb29-157"><a href="mod-dp.html#cb29-157" aria-hidden="true" tabindex="-1"></a>      <span class="at">bellmanCalc =</span> <span class="cf">function</span>(gamma, s, a) {</span>
<span id="cb29-158"><a href="mod-dp.html#cb29-158" aria-hidden="true" tabindex="-1"></a>         pr <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>pr</span>
<span id="cb29-159"><a href="mod-dp.html#cb29-159" aria-hidden="true" tabindex="-1"></a>         r <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>r</span>
<span id="cb29-160"><a href="mod-dp.html#cb29-160" aria-hidden="true" tabindex="-1"></a>         nS <span class="ot">&lt;-</span> <span class="fu">names</span>(pr)</span>
<span id="cb29-161"><a href="mod-dp.html#cb29-161" aria-hidden="true" tabindex="-1"></a>         vS <span class="ot">&lt;-</span> <span class="fu">values</span>(self<span class="sc">$</span>v, nS)</span>
<span id="cb29-162"><a href="mod-dp.html#cb29-162" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(r <span class="sc">+</span> gamma <span class="sc">*</span> <span class="fu">sum</span>(pr <span class="sc">*</span> vS))</span>
<span id="cb29-163"><a href="mod-dp.html#cb29-163" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-164"><a href="mod-dp.html#cb29-164" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-165"><a href="mod-dp.html#cb29-165" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Iterative policy evaluation of current policy (defined by pi)</span></span>
<span id="cb29-166"><a href="mod-dp.html#cb29-166" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb29-167"><a href="mod-dp.html#cb29-167" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param theta Threshold parameter.</span></span>
<span id="cb29-168"><a href="mod-dp.html#cb29-168" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxIte Maximum number of iterations.</span></span>
<span id="cb29-169"><a href="mod-dp.html#cb29-169" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param reset If true set all state-values to 0.</span></span>
<span id="cb29-170"><a href="mod-dp.html#cb29-170" aria-hidden="true" tabindex="-1"></a>      <span class="at">policyEval =</span> <span class="cf">function</span>(gamma, <span class="at">theta =</span> <span class="fl">0.00001</span>, <span class="at">maxIte =</span> <span class="dv">10000</span>, <span class="at">reset =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb29-171"><a href="mod-dp.html#cb29-171" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (reset) self<span class="sc">$</span><span class="fu">setStateValue</span>()  <span class="co"># set to 0</span></span>
<span id="cb29-172"><a href="mod-dp.html#cb29-172" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (ite <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxIte) { </span>
<span id="cb29-173"><a href="mod-dp.html#cb29-173" aria-hidden="true" tabindex="-1"></a>            delta <span class="ot">&lt;-</span> <span class="dv">0</span>   <span class="co"># Bellman error </span></span>
<span id="cb29-174"><a href="mod-dp.html#cb29-174" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb29-175"><a href="mod-dp.html#cb29-175" aria-hidden="true" tabindex="-1"></a>               v <span class="ot">&lt;-</span> self<span class="sc">$</span>v[[s]]  </span>
<span id="cb29-176"><a href="mod-dp.html#cb29-176" aria-hidden="true" tabindex="-1"></a>               <span class="co"># update</span></span>
<span id="cb29-177"><a href="mod-dp.html#cb29-177" aria-hidden="true" tabindex="-1"></a>               pi <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi</span>
<span id="cb29-178"><a href="mod-dp.html#cb29-178" aria-hidden="true" tabindex="-1"></a>               actions <span class="ot">&lt;-</span> <span class="fu">names</span>(pi)</span>
<span id="cb29-179"><a href="mod-dp.html#cb29-179" aria-hidden="true" tabindex="-1"></a>               val <span class="ot">=</span>  <span class="dv">0</span></span>
<span id="cb29-180"><a href="mod-dp.html#cb29-180" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> (a <span class="cf">in</span> actions) {</span>
<span id="cb29-181"><a href="mod-dp.html#cb29-181" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># pr &lt;- self$model[[s]]$actions[[a]]$pr</span></span>
<span id="cb29-182"><a href="mod-dp.html#cb29-182" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># r &lt;- self$model[[s]]$actions[[a]]$r</span></span>
<span id="cb29-183"><a href="mod-dp.html#cb29-183" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># nS &lt;- names(pr)</span></span>
<span id="cb29-184"><a href="mod-dp.html#cb29-184" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># vS &lt;- values(self$v, nS)</span></span>
<span id="cb29-185"><a href="mod-dp.html#cb29-185" aria-hidden="true" tabindex="-1"></a>                  val <span class="ot">&lt;-</span> val <span class="sc">+</span> pi[a] <span class="sc">*</span> self<span class="sc">$</span><span class="fu">bellmanCalc</span>(gamma, s, a)</span>
<span id="cb29-186"><a href="mod-dp.html#cb29-186" aria-hidden="true" tabindex="-1"></a>               }</span>
<span id="cb29-187"><a href="mod-dp.html#cb29-187" aria-hidden="true" tabindex="-1"></a>               self<span class="sc">$</span>v[[s]] <span class="ot">&lt;-</span> val</span>
<span id="cb29-188"><a href="mod-dp.html#cb29-188" aria-hidden="true" tabindex="-1"></a>               delta <span class="ot">&lt;-</span> <span class="fu">max</span>(delta, <span class="fu">abs</span>(v<span class="sc">-</span>val))</span>
<span id="cb29-189"><a href="mod-dp.html#cb29-189" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-190"><a href="mod-dp.html#cb29-190" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (delta <span class="sc">&lt;</span> theta) <span class="cf">break</span></span>
<span id="cb29-191"><a href="mod-dp.html#cb29-191" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-192"><a href="mod-dp.html#cb29-192" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (ite <span class="sc">==</span> maxIte) <span class="fu">warning</span>(<span class="st">&quot;Policy evaluation algorithm stopped at max iterations allowed:&quot;</span>, maxIte)</span>
<span id="cb29-193"><a href="mod-dp.html#cb29-193" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-194"><a href="mod-dp.html#cb29-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-195"><a href="mod-dp.html#cb29-195" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Policy iteration using iterative policy eval</span></span>
<span id="cb29-196"><a href="mod-dp.html#cb29-196" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb29-197"><a href="mod-dp.html#cb29-197" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param theta Threshold parameter.</span></span>
<span id="cb29-198"><a href="mod-dp.html#cb29-198" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxIteEval Maximum number of iterations when evaluate policy.</span></span>
<span id="cb29-199"><a href="mod-dp.html#cb29-199" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxItePolicy Maximum number of policy iterations.</span></span>
<span id="cb29-200"><a href="mod-dp.html#cb29-200" aria-hidden="true" tabindex="-1"></a>      <span class="at">policyIte =</span> <span class="cf">function</span>(gamma, <span class="at">theta =</span> <span class="fl">0.00001</span>, <span class="at">maxIteEval =</span> <span class="dv">10000</span>, <span class="at">maxItePolicy =</span> <span class="dv">100</span>) {</span>
<span id="cb29-201"><a href="mod-dp.html#cb29-201" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span><span class="fu">setRandomDeterministicPolicy</span>()</span>
<span id="cb29-202"><a href="mod-dp.html#cb29-202" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (ite <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxItePolicy) {</span>
<span id="cb29-203"><a href="mod-dp.html#cb29-203" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">policyEval</span>(gamma, theta, maxIteEval, <span class="at">reset =</span> <span class="cn">FALSE</span>)</span>
<span id="cb29-204"><a href="mod-dp.html#cb29-204" aria-hidden="true" tabindex="-1"></a>            <span class="co"># self$setStateValue()  # set to 0</span></span>
<span id="cb29-205"><a href="mod-dp.html#cb29-205" aria-hidden="true" tabindex="-1"></a>            stable <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb29-206"><a href="mod-dp.html#cb29-206" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb29-207"><a href="mod-dp.html#cb29-207" aria-hidden="true" tabindex="-1"></a>               piOld <span class="ot">&lt;-</span> <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi)</span>
<span id="cb29-208"><a href="mod-dp.html#cb29-208" aria-hidden="true" tabindex="-1"></a>               actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb29-209"><a href="mod-dp.html#cb29-209" aria-hidden="true" tabindex="-1"></a>               vMax <span class="ot">=</span>  <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb29-210"><a href="mod-dp.html#cb29-210" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> (a <span class="cf">in</span> actions) {</span>
<span id="cb29-211"><a href="mod-dp.html#cb29-211" aria-hidden="true" tabindex="-1"></a>                  val <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">bellmanCalc</span>(gamma, s, a)</span>
<span id="cb29-212"><a href="mod-dp.html#cb29-212" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> (val <span class="sc">&gt;</span> vMax) {</span>
<span id="cb29-213"><a href="mod-dp.html#cb29-213" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi) <span class="ot">&lt;-</span> a</span>
<span id="cb29-214"><a href="mod-dp.html#cb29-214" aria-hidden="true" tabindex="-1"></a>                     vMax <span class="ot">&lt;-</span> val</span>
<span id="cb29-215"><a href="mod-dp.html#cb29-215" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb29-216"><a href="mod-dp.html#cb29-216" aria-hidden="true" tabindex="-1"></a>               }</span>
<span id="cb29-217"><a href="mod-dp.html#cb29-217" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> (piOld <span class="sc">!=</span> <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi) ) stable <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb29-218"><a href="mod-dp.html#cb29-218" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-219"><a href="mod-dp.html#cb29-219" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (stable) <span class="cf">break</span></span>
<span id="cb29-220"><a href="mod-dp.html#cb29-220" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-221"><a href="mod-dp.html#cb29-221" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (ite <span class="sc">==</span> maxItePolicy) <span class="fu">warning</span>(<span class="st">&quot;Policy Iteration algorithm stopped at max iterations allowed:&quot;</span>, maxItePolicy)</span>
<span id="cb29-222"><a href="mod-dp.html#cb29-222" aria-hidden="true" tabindex="-1"></a>         <span class="fu">message</span>(<span class="fu">str_c</span>(<span class="st">&quot;Policy iteration algorihm finished in &quot;</span>, ite, <span class="st">&quot; iterations.&quot;</span>))</span>
<span id="cb29-223"><a href="mod-dp.html#cb29-223" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-224"><a href="mod-dp.html#cb29-224" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb29-225"><a href="mod-dp.html#cb29-225" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-226"><a href="mod-dp.html#cb29-226" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Value iteration</span></span>
<span id="cb29-227"><a href="mod-dp.html#cb29-227" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb29-228"><a href="mod-dp.html#cb29-228" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param theta Threshold parameter.</span></span>
<span id="cb29-229"><a href="mod-dp.html#cb29-229" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxIte Maximum number of iterations.</span></span>
<span id="cb29-230"><a href="mod-dp.html#cb29-230" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param reset If true set all state-values to 0.</span></span>
<span id="cb29-231"><a href="mod-dp.html#cb29-231" aria-hidden="true" tabindex="-1"></a>      <span class="at">valueIte =</span> <span class="cf">function</span>(gamma, <span class="at">theta =</span> <span class="fl">0.00001</span>, <span class="at">maxIte =</span> <span class="dv">10000</span>, <span class="at">reset =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb29-232"><a href="mod-dp.html#cb29-232" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span><span class="fu">setRandomDeterministicPolicy</span>()</span>
<span id="cb29-233"><a href="mod-dp.html#cb29-233" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (reset) self<span class="sc">$</span><span class="fu">setStateValue</span>()  <span class="co"># set to 0</span></span>
<span id="cb29-234"><a href="mod-dp.html#cb29-234" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (ite <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxIte) { </span>
<span id="cb29-235"><a href="mod-dp.html#cb29-235" aria-hidden="true" tabindex="-1"></a>            delta <span class="ot">&lt;-</span> <span class="dv">0</span>   <span class="co"># Bellman error </span></span>
<span id="cb29-236"><a href="mod-dp.html#cb29-236" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb29-237"><a href="mod-dp.html#cb29-237" aria-hidden="true" tabindex="-1"></a>               v <span class="ot">&lt;-</span> self<span class="sc">$</span>v[[s]]  </span>
<span id="cb29-238"><a href="mod-dp.html#cb29-238" aria-hidden="true" tabindex="-1"></a>               actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb29-239"><a href="mod-dp.html#cb29-239" aria-hidden="true" tabindex="-1"></a>               vMax <span class="ot">=</span>  <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb29-240"><a href="mod-dp.html#cb29-240" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> (a <span class="cf">in</span> actions) {</span>
<span id="cb29-241"><a href="mod-dp.html#cb29-241" aria-hidden="true" tabindex="-1"></a>                  val <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">bellmanCalc</span>(gamma, s, a)</span>
<span id="cb29-242"><a href="mod-dp.html#cb29-242" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> (val <span class="sc">&gt;</span> vMax) {</span>
<span id="cb29-243"><a href="mod-dp.html#cb29-243" aria-hidden="true" tabindex="-1"></a>                     vMax <span class="ot">&lt;-</span> val</span>
<span id="cb29-244"><a href="mod-dp.html#cb29-244" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi) <span class="ot">&lt;-</span> a</span>
<span id="cb29-245"><a href="mod-dp.html#cb29-245" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb29-246"><a href="mod-dp.html#cb29-246" aria-hidden="true" tabindex="-1"></a>               }</span>
<span id="cb29-247"><a href="mod-dp.html#cb29-247" aria-hidden="true" tabindex="-1"></a>               self<span class="sc">$</span>v[[s]] <span class="ot">&lt;-</span> vMax</span>
<span id="cb29-248"><a href="mod-dp.html#cb29-248" aria-hidden="true" tabindex="-1"></a>               delta <span class="ot">&lt;-</span> <span class="fu">max</span>(delta, <span class="fu">abs</span>(v<span class="sc">-</span>vMax))</span>
<span id="cb29-249"><a href="mod-dp.html#cb29-249" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-250"><a href="mod-dp.html#cb29-250" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (delta <span class="sc">&lt;</span> theta) <span class="cf">break</span></span>
<span id="cb29-251"><a href="mod-dp.html#cb29-251" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-252"><a href="mod-dp.html#cb29-252" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (ite <span class="sc">==</span> maxIte) <span class="fu">warning</span>(<span class="st">&quot;Value iteration algorithm stopped at max iterations allowed:&quot;</span>, maxIte)         </span>
<span id="cb29-253"><a href="mod-dp.html#cb29-253" aria-hidden="true" tabindex="-1"></a>         <span class="fu">message</span>(<span class="fu">str_c</span>(<span class="st">&quot;Value iteration algorihm finished in &quot;</span>, ite, <span class="st">&quot; iterations.&quot;</span>))</span>
<span id="cb29-254"><a href="mod-dp.html#cb29-254" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-255"><a href="mod-dp.html#cb29-255" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb29-256"><a href="mod-dp.html#cb29-256" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb29-257"><a href="mod-dp.html#cb29-257" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>You may have a look at the code and try to get an overview. Let us now try to solve the problem. First we need some functions for calculating the reward and transition probabilities:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="mod-dp.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Expected reward of an action</span></span>
<span id="cb30-2"><a href="mod-dp.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param s Waste amount (state).</span></span>
<span id="cb30-3"><a href="mod-dp.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param a Action (keep or empty).</span></span>
<span id="cb30-4"><a href="mod-dp.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The expected reward</span></span>
<span id="cb30-5"><a href="mod-dp.html#cb30-5" aria-hidden="true" tabindex="-1"></a>reward <span class="ot">&lt;-</span><span class="cf">function</span>(s, a) {</span>
<span id="cb30-6"><a href="mod-dp.html#cb30-6" aria-hidden="true" tabindex="-1"></a>   i <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb30-7"><a href="mod-dp.html#cb30-7" aria-hidden="true" tabindex="-1"></a>   p<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)</span>
<span id="cb30-8"><a href="mod-dp.html#cb30-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (a<span class="sc">==</span><span class="st">&quot;keep&quot;</span>) {</span>
<span id="cb30-9"><a href="mod-dp.html#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i<span class="sc">&lt;</span><span class="dv">2</span>) <span class="fu">return</span>(<span class="dv">0</span>)   <span class="co"># no excess waste</span></span>
<span id="cb30-10"><a href="mod-dp.html#cb30-10" aria-hidden="true" tabindex="-1"></a>      k <span class="ot">&lt;-</span> (<span class="dv">4</span><span class="sc">-</span>i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="dv">3</span></span>
<span id="cb30-11"><a href="mod-dp.html#cb30-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="sc">-</span><span class="dv">30</span><span class="sc">*</span><span class="fu">sum</span>( (i<span class="sc">+</span>k<span class="dv">-4</span>)<span class="sc">*</span>p[k<span class="sc">+</span><span class="dv">1</span>] ) )</span>
<span id="cb30-12"><a href="mod-dp.html#cb30-12" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb30-13"><a href="mod-dp.html#cb30-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (a<span class="sc">==</span><span class="st">&quot;empty&quot;</span>) {</span>
<span id="cb30-14"><a href="mod-dp.html#cb30-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>(<span class="dv">25</span> <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>i))</span>
<span id="cb30-15"><a href="mod-dp.html#cb30-15" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb30-16"><a href="mod-dp.html#cb30-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb30-17"><a href="mod-dp.html#cb30-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-18"><a href="mod-dp.html#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="mod-dp.html#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Find transition probabilities</span></span>
<span id="cb30-20"><a href="mod-dp.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param s Waste amount (state).</span></span>
<span id="cb30-21"><a href="mod-dp.html#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param a Action (keep or empty).</span></span>
<span id="cb30-22"><a href="mod-dp.html#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The trans pr and id </span></span>
<span id="cb30-23"><a href="mod-dp.html#cb30-23" aria-hidden="true" tabindex="-1"></a>transPr<span class="ot">&lt;-</span><span class="cf">function</span>(s, a) {</span>
<span id="cb30-24"><a href="mod-dp.html#cb30-24" aria-hidden="true" tabindex="-1"></a>   i <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb30-25"><a href="mod-dp.html#cb30-25" aria-hidden="true" tabindex="-1"></a>   p<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>)</span>
<span id="cb30-26"><a href="mod-dp.html#cb30-26" aria-hidden="true" tabindex="-1"></a>   pr<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb30-27"><a href="mod-dp.html#cb30-27" aria-hidden="true" tabindex="-1"></a>   id<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb30-28"><a href="mod-dp.html#cb30-28" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (a<span class="sc">==</span><span class="st">&quot;keep&quot;</span>) {</span>
<span id="cb30-29"><a href="mod-dp.html#cb30-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i<span class="sc">&lt;</span><span class="dv">4</span>) <span class="cf">for</span> (j <span class="cf">in</span> i<span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb30-30"><a href="mod-dp.html#cb30-30" aria-hidden="true" tabindex="-1"></a>         pr<span class="ot">&lt;-</span><span class="fu">c</span>(pr,p[j<span class="sc">-</span>i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb30-31"><a href="mod-dp.html#cb30-31" aria-hidden="true" tabindex="-1"></a>         id<span class="ot">&lt;-</span><span class="fu">c</span>(id,j)</span>
<span id="cb30-32"><a href="mod-dp.html#cb30-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb30-33"><a href="mod-dp.html#cb30-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb30-34"><a href="mod-dp.html#cb30-34" aria-hidden="true" tabindex="-1"></a>         pr<span class="ot">&lt;-</span><span class="fu">c</span>(pr,<span class="fu">sum</span>(p[(<span class="dv">4</span><span class="sc">-</span>i)<span class="sc">:</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>]))</span>
<span id="cb30-35"><a href="mod-dp.html#cb30-35" aria-hidden="true" tabindex="-1"></a>         id<span class="ot">&lt;-</span><span class="fu">c</span>(id,<span class="dv">4</span>)</span>
<span id="cb30-36"><a href="mod-dp.html#cb30-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb30-37"><a href="mod-dp.html#cb30-37" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb30-38"><a href="mod-dp.html#cb30-38" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (a<span class="sc">==</span><span class="st">&quot;empty&quot;</span>) {</span>
<span id="cb30-39"><a href="mod-dp.html#cb30-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb30-40"><a href="mod-dp.html#cb30-40" aria-hidden="true" tabindex="-1"></a>         pr<span class="ot">&lt;-</span><span class="fu">c</span>(pr,p[j<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb30-41"><a href="mod-dp.html#cb30-41" aria-hidden="true" tabindex="-1"></a>         id<span class="ot">&lt;-</span><span class="fu">c</span>(id,j)</span>
<span id="cb30-42"><a href="mod-dp.html#cb30-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb30-43"><a href="mod-dp.html#cb30-43" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb30-44"><a href="mod-dp.html#cb30-44" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(pr) <span class="ot">&lt;-</span> id</span>
<span id="cb30-45"><a href="mod-dp.html#cb30-45" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(pr)</span>
<span id="cb30-46"><a href="mod-dp.html#cb30-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For instance the expected reward in state 4 under action keep is:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="mod-dp.html#cb31-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb31-2"><a href="mod-dp.html#cb31-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&quot;keep&quot;</span></span>
<span id="cb31-3"><a href="mod-dp.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">reward</span>(s, a)</span>
<span id="cb31-4"><a href="mod-dp.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -15</span></span>
<span id="cb31-5"><a href="mod-dp.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">transPr</span>(s, a)</span>
<span id="cb31-6"><a href="mod-dp.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     3     4 </span></span>
<span id="cb31-7"><a href="mod-dp.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.125 0.875</span></span></code></pre></div>
<p>We are now ready to build the model:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="mod-dp.html#cb32-1" aria-hidden="true" tabindex="-1"></a>mdp <span class="ot">&lt;-</span> MDPClass<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb32-2"><a href="mod-dp.html#cb32-2" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addStateSpace</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>)   <span class="co"># add state keys</span></span>
<span id="cb32-3"><a href="mod-dp.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="fu">c</span>(<span class="st">&quot;empty&quot;</span>, <span class="st">&quot;keep&quot;</span>))  <span class="co"># add action keys</span></span>
<span id="cb32-4"><a href="mod-dp.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add trans pr and rewards</span></span>
<span id="cb32-5"><a href="mod-dp.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) {</span>
<span id="cb32-6"><a href="mod-dp.html#cb32-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (a <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(s)) {</span>
<span id="cb32-7"><a href="mod-dp.html#cb32-7" aria-hidden="true" tabindex="-1"></a>      mdp<span class="sc">$</span><span class="fu">addAction</span>(s, a, <span class="at">r =</span> <span class="fu">reward</span>(s,a), <span class="at">pr =</span> <span class="fu">transPr</span>(s,a))</span>
<span id="cb32-8"><a href="mod-dp.html#cb32-8" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb32-9"><a href="mod-dp.html#cb32-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We may check that we have built the MDP correct using:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="mod-dp.html#cb33-1" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getTransPrActionMat</span>(<span class="st">&quot;keep&quot;</span>)</span>
<span id="cb33-2"><a href="mod-dp.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       0     1     2     3     4</span></span>
<span id="cb33-3"><a href="mod-dp.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0 0.125 0.500 0.250 0.125 0.000</span></span>
<span id="cb33-4"><a href="mod-dp.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.000 0.125 0.500 0.250 0.125</span></span>
<span id="cb33-5"><a href="mod-dp.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.000 0.000 0.125 0.500 0.375</span></span>
<span id="cb33-6"><a href="mod-dp.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.000 0.000 0.000 0.125 0.875</span></span>
<span id="cb33-7"><a href="mod-dp.html#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.000 0.000 0.000 0.000 1.000</span></span>
<span id="cb33-8"><a href="mod-dp.html#cb33-8" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getTransPrActionMat</span>(<span class="st">&quot;empty&quot;</span>)</span>
<span id="cb33-9"><a href="mod-dp.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       0   1    2     3 4</span></span>
<span id="cb33-10"><a href="mod-dp.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0 0.125 0.5 0.25 0.125 0</span></span>
<span id="cb33-11"><a href="mod-dp.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.125 0.5 0.25 0.125 0</span></span>
<span id="cb33-12"><a href="mod-dp.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.125 0.5 0.25 0.125 0</span></span>
<span id="cb33-13"><a href="mod-dp.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.125 0.5 0.25 0.125 0</span></span>
<span id="cb33-14"><a href="mod-dp.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.125 0.5 0.25 0.125 0</span></span>
<span id="cb33-15"><a href="mod-dp.html#cb33-15" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getRewardMat</span>()</span>
<span id="cb33-16"><a href="mod-dp.html#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   empty   keep empty keep empty keep empty keep empty keep</span></span>
<span id="cb33-17"><a href="mod-dp.html#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0   -25   0.00    NA   NA    NA   NA    NA   NA    NA   NA</span></span>
<span id="cb33-18"><a href="mod-dp.html#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   -30   0.00    NA   NA    NA   NA    NA   NA    NA   NA</span></span>
<span id="cb33-19"><a href="mod-dp.html#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   -35  -3.75    NA   NA    NA   NA    NA   NA    NA   NA</span></span>
<span id="cb33-20"><a href="mod-dp.html#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   -40 -15.00    NA   NA    NA   NA    NA   NA    NA   NA</span></span>
<span id="cb33-21"><a href="mod-dp.html#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   -45 -41.25    NA   NA    NA   NA    NA   NA    NA   NA</span></span>
<span id="cb33-22"><a href="mod-dp.html#cb33-22" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;3&quot;</span>)</span>
<span id="cb33-23"><a href="mod-dp.html#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $keep</span></span>
<span id="cb33-24"><a href="mod-dp.html#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $keep$r</span></span>
<span id="cb33-25"><a href="mod-dp.html#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -15</span></span>
<span id="cb33-26"><a href="mod-dp.html#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-27"><a href="mod-dp.html#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $keep$pr</span></span>
<span id="cb33-28"><a href="mod-dp.html#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     3     4 </span></span>
<span id="cb33-29"><a href="mod-dp.html#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.125 0.875 </span></span>
<span id="cb33-30"><a href="mod-dp.html#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-31"><a href="mod-dp.html#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-32"><a href="mod-dp.html#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $empty</span></span>
<span id="cb33-33"><a href="mod-dp.html#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $empty$r</span></span>
<span id="cb33-34"><a href="mod-dp.html#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -40</span></span>
<span id="cb33-35"><a href="mod-dp.html#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-36"><a href="mod-dp.html#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $empty$pr</span></span>
<span id="cb33-37"><a href="mod-dp.html#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     0     1     2     3 </span></span>
<span id="cb33-38"><a href="mod-dp.html#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.125 0.500 0.250 0.125</span></span></code></pre></div>
<p>Let us try to evaluate a fixed policy given a discount rate of 0.5:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="mod-dp.html#cb34-1" aria-hidden="true" tabindex="-1"></a>sa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;keep&quot;</span>, <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;keep&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;keep&quot;</span>, <span class="st">&quot;3&quot;</span> <span class="ot">=</span> <span class="st">&quot;keep&quot;</span>, <span class="st">&quot;4&quot;</span> <span class="ot">=</span> <span class="st">&quot;empty&quot;</span>)</span>
<span id="cb34-2"><a href="mod-dp.html#cb34-2" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">setDeterministicPolicy</span>(sa)</span>
<span id="cb34-3"><a href="mod-dp.html#cb34-3" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getPolicy</span>()</span>
<span id="cb34-4"><a href="mod-dp.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb34-5"><a href="mod-dp.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state action    pr</span></span>
<span id="cb34-6"><a href="mod-dp.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb34-7"><a href="mod-dp.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     keep       1</span></span>
<span id="cb34-8"><a href="mod-dp.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     keep       1</span></span>
<span id="cb34-9"><a href="mod-dp.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     keep       1</span></span>
<span id="cb34-10"><a href="mod-dp.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     keep       1</span></span>
<span id="cb34-11"><a href="mod-dp.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     empty      1</span></span>
<span id="cb34-12"><a href="mod-dp.html#cb34-12" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">policyEval</span>(<span class="at">gamma =</span> <span class="fl">0.5</span>)</span>
<span id="cb34-13"><a href="mod-dp.html#cb34-13" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getStateValues</span>()</span>
<span id="cb34-14"><a href="mod-dp.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb34-15"><a href="mod-dp.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v</span></span>
<span id="cb34-16"><a href="mod-dp.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb34-17"><a href="mod-dp.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     -10.7</span></span>
<span id="cb34-18"><a href="mod-dp.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     -16.3</span></span>
<span id="cb34-19"><a href="mod-dp.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     -26.3</span></span>
<span id="cb34-20"><a href="mod-dp.html#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     -42.0</span></span>
<span id="cb34-21"><a href="mod-dp.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     -55.7</span></span></code></pre></div>
<p>Let us try to find the optimal policy using policy iteration:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="mod-dp.html#cb35-1" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">policyIte</span>(<span class="at">gamma =</span> <span class="fl">0.5</span>)</span>
<span id="cb35-2"><a href="mod-dp.html#cb35-2" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getPolicy</span>()</span>
<span id="cb35-3"><a href="mod-dp.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb35-4"><a href="mod-dp.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state action    pr</span></span>
<span id="cb35-5"><a href="mod-dp.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb35-6"><a href="mod-dp.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     keep       1</span></span>
<span id="cb35-7"><a href="mod-dp.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     keep       1</span></span>
<span id="cb35-8"><a href="mod-dp.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     keep       1</span></span>
<span id="cb35-9"><a href="mod-dp.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     keep       1</span></span>
<span id="cb35-10"><a href="mod-dp.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     empty      1</span></span>
<span id="cb35-11"><a href="mod-dp.html#cb35-11" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getStateValues</span>()</span>
<span id="cb35-12"><a href="mod-dp.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb35-13"><a href="mod-dp.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v</span></span>
<span id="cb35-14"><a href="mod-dp.html#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb35-15"><a href="mod-dp.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     -10.7</span></span>
<span id="cb35-16"><a href="mod-dp.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     -16.3</span></span>
<span id="cb35-17"><a href="mod-dp.html#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     -26.3</span></span>
<span id="cb35-18"><a href="mod-dp.html#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     -42.0</span></span>
<span id="cb35-19"><a href="mod-dp.html#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     -55.7</span></span></code></pre></div>
<p>If we do value iteration we should get the same results:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="mod-dp.html#cb36-1" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">valueIte</span>(<span class="fl">0.5</span>)</span>
<span id="cb36-2"><a href="mod-dp.html#cb36-2" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getPolicy</span>()</span>
<span id="cb36-3"><a href="mod-dp.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb36-4"><a href="mod-dp.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state action    pr</span></span>
<span id="cb36-5"><a href="mod-dp.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb36-6"><a href="mod-dp.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     keep       1</span></span>
<span id="cb36-7"><a href="mod-dp.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     keep       1</span></span>
<span id="cb36-8"><a href="mod-dp.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     keep       1</span></span>
<span id="cb36-9"><a href="mod-dp.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     keep       1</span></span>
<span id="cb36-10"><a href="mod-dp.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     empty      1</span></span>
<span id="cb36-11"><a href="mod-dp.html#cb36-11" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getStateValues</span>()</span>
<span id="cb36-12"><a href="mod-dp.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb36-13"><a href="mod-dp.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v</span></span>
<span id="cb36-14"><a href="mod-dp.html#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb36-15"><a href="mod-dp.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     -10.7</span></span>
<span id="cb36-16"><a href="mod-dp.html#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     -16.3</span></span>
<span id="cb36-17"><a href="mod-dp.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     -26.3</span></span>
<span id="cb36-18"><a href="mod-dp.html#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     -42.0</span></span>
<span id="cb36-19"><a href="mod-dp.html#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     -55.7</span></span></code></pre></div>
<p>Finally, let us try to solve the problem with a discount rate of 0.99:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="mod-dp.html#cb37-1" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">policyIte</span>(<span class="at">gamma =</span><span class="fl">0.99</span>)</span>
<span id="cb37-2"><a href="mod-dp.html#cb37-2" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getPolicy</span>()</span>
<span id="cb37-3"><a href="mod-dp.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb37-4"><a href="mod-dp.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state action    pr</span></span>
<span id="cb37-5"><a href="mod-dp.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb37-6"><a href="mod-dp.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     keep       1</span></span>
<span id="cb37-7"><a href="mod-dp.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     keep       1</span></span>
<span id="cb37-8"><a href="mod-dp.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     keep       1</span></span>
<span id="cb37-9"><a href="mod-dp.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     empty      1</span></span>
<span id="cb37-10"><a href="mod-dp.html#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     empty      1</span></span>
<span id="cb37-11"><a href="mod-dp.html#cb37-11" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getStateValues</span>()</span>
<span id="cb37-12"><a href="mod-dp.html#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb37-13"><a href="mod-dp.html#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state      v</span></span>
<span id="cb37-14"><a href="mod-dp.html#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb37-15"><a href="mod-dp.html#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0     -1750.</span></span>
<span id="cb37-16"><a href="mod-dp.html#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1     -1762.</span></span>
<span id="cb37-17"><a href="mod-dp.html#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2     -1776.</span></span>
<span id="cb37-18"><a href="mod-dp.html#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3     -1790.</span></span>
<span id="cb37-19"><a href="mod-dp.html#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4     -1795.</span></span></code></pre></div>
<p>Note we now empty also at 3 m<span class="math inline">\(^3\)</span>.</p>
</div>
<div id="summary-4" class="section level2 hasAnchor" number="5.9">
<h2><span class="header-section-number">5.9</span> Summary<a href="mod-dp.html#summary-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Read Chapter 4.8 in <span class="citation">Sutton and Barto (<a href="#ref-Sutton18" role="doc-biblioref">2018</a>)</span>.</p>
</div>
<div id="exercises" class="section level2 hasAnchor" number="5.10">
<h2><span class="header-section-number">5.10</span> Exercises<a href="mod-dp.html#exercises" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the <a href="help.html#help">help page</a>. Sometimes solutions can be seen by pressing the button besides a question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!</p>
<div id="ex-dp-gambler" class="section level3 hasAnchor" number="5.10.1">
<h3><span class="header-section-number">5.10.1</span> Exercise - Gambler’s problem<a href="mod-dp.html#ex-dp-gambler" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider the gambler’s problem in Exercise <a href="mod-mdp-1.html#ex-mdp-1-gambler">3.6.3</a>.</p>
<!-- Q1 -->
<div id="hZgH7tBv5tlm2ni2miPO" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="hZgH7tBv5tlm2ni2miPO-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="hZgH7tBv5tlm2ni2miPO-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb38"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb38-1"><a href="mod-dp.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; MDP model for the gamblers problem.</span></span>
<span id="cb38-2"><a href="mod-dp.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prH Probability of head.</span></span>
<span id="cb38-3"><a href="mod-dp.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The mdp object (R6 class).</span></span>
<span id="cb38-4"><a href="mod-dp.html#cb38-4" aria-hidden="true" tabindex="-1"></a>buildGamblerModel <span class="ot">&lt;-</span> <span class="cf">function</span>(prH) {</span>
<span id="cb38-5"><a href="mod-dp.html#cb38-5" aria-hidden="true" tabindex="-1"></a>   mdp <span class="ot">&lt;-</span> MDPClass<span class="sc">$</span><span class="fu">new</span>()      <span class="co"># initialize mdp object</span></span>
<span id="cb38-6"><a href="mod-dp.html#cb38-6" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">addStateSpace</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">101</span>)   <span class="co"># add states (states are keys in a hash and are always converted to strings), 101 represent finished</span></span>
<span id="cb38-7"><a href="mod-dp.html#cb38-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) {  <span class="co"># add actions for each state (only the key of the action)</span></span>
<span id="cb38-8"><a href="mod-dp.html#cb38-8" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb38-9"><a href="mod-dp.html#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> i <span class="sc">&lt;</span> <span class="dv">100</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(i, <span class="dv">100</span><span class="sc">-</span>i))</span>
<span id="cb38-10"><a href="mod-dp.html#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">0</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="st">&quot;Loose&quot;</span>)  </span>
<span id="cb38-11"><a href="mod-dp.html#cb38-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">100</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="st">&quot;Win&quot;</span>)  </span>
<span id="cb38-12"><a href="mod-dp.html#cb38-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">101</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="st">&quot;Dummy&quot;</span>)</span>
<span id="cb38-13"><a href="mod-dp.html#cb38-13" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb38-14"><a href="mod-dp.html#cb38-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add trans pr and expected reward to the actions</span></span>
<span id="cb38-15"><a href="mod-dp.html#cb38-15" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)) {</span>
<span id="cb38-16"><a href="mod-dp.html#cb38-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (a <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(s)) {</span>
<span id="cb38-17"><a href="mod-dp.html#cb38-17" aria-hidden="true" tabindex="-1"></a>         iS <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb38-18"><a href="mod-dp.html#cb38-18" aria-hidden="true" tabindex="-1"></a>         iA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(a)</span>
<span id="cb38-19"><a href="mod-dp.html#cb38-19" aria-hidden="true" tabindex="-1"></a>         transPr <span class="ot">&lt;-</span> <span class="fu">c</span>(prH, <span class="dv">1</span><span class="sc">-</span> prH)</span>
<span id="cb38-20"><a href="mod-dp.html#cb38-20" aria-hidden="true" tabindex="-1"></a>         <span class="fu">names</span>(transPr) <span class="ot">&lt;-</span> <span class="fu">c</span>(iS<span class="sc">+</span>iA, iS<span class="sc">-</span>iA)</span>
<span id="cb38-21"><a href="mod-dp.html#cb38-21" aria-hidden="true" tabindex="-1"></a>         mdp<span class="sc">$</span><span class="fu">addAction</span>(s, a, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">pr =</span> transPr)</span>
<span id="cb38-22"><a href="mod-dp.html#cb38-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-23"><a href="mod-dp.html#cb38-23" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb38-24"><a href="mod-dp.html#cb38-24" aria-hidden="true" tabindex="-1"></a>   <span class="co"># add special actions</span></span>
<span id="cb38-25"><a href="mod-dp.html#cb38-25" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="at">s =</span> <span class="st">&quot;0&quot;</span>, <span class="at">a =</span> <span class="st">&quot;Loose&quot;</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">pr =</span> <span class="fu">c</span>(<span class="st">&quot;101&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb38-26"><a href="mod-dp.html#cb38-26" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="at">s =</span> <span class="st">&quot;100&quot;</span>, <span class="at">a =</span> <span class="st">&quot;Win&quot;</span>, <span class="at">r =</span> <span class="dv">1</span>, <span class="at">pr =</span> <span class="fu">c</span>(<span class="st">&quot;101&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb38-27"><a href="mod-dp.html#cb38-27" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="at">s =</span> <span class="st">&quot;101&quot;</span>, <span class="at">a =</span> <span class="st">&quot;Dummy&quot;</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">pr =</span> <span class="fu">c</span>(<span class="st">&quot;101&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb38-28"><a href="mod-dp.html#cb38-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(mdp)</span>
<span id="cb38-29"><a href="mod-dp.html#cb38-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>
We make a function that return the mdp object
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hZgH7tBv5tlm2ni2miPO">
Solution
</button>
<ol style="list-style-type: decimal">
<li>Build the model in R.</li>
</ol>
<!-- Q2 -->
<div id="ORmP2lvJjSgOlmiPgT3m" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="ORmP2lvJjSgOlmiPgT3m-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="ORmP2lvJjSgOlmiPgT3m-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb39"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb39-1"><a href="mod-dp.html#cb39-1" aria-hidden="true" tabindex="-1"></a>solveGambler <span class="ot">&lt;-</span> <span class="cf">function</span>(prH) {</span>
<span id="cb39-2"><a href="mod-dp.html#cb39-2" aria-hidden="true" tabindex="-1"></a>   mdp <span class="ot">&lt;-</span> <span class="fu">buildGamblerModel</span>(prH)</span>
<span id="cb39-3"><a href="mod-dp.html#cb39-3" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">valueIte</span>(<span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">theta =</span> <span class="fl">0.0001</span>)</span>
<span id="cb39-4"><a href="mod-dp.html#cb39-4" aria-hidden="true" tabindex="-1"></a>   df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mdp<span class="sc">$</span><span class="fu">getStateValues</span>(), mdp<span class="sc">$</span><span class="fu">getPolicy</span>(), <span class="at">by =</span> <span class="st">&quot;state&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="mod-dp.html#cb39-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>pr)</span>
<span id="cb39-6"><a href="mod-dp.html#cb39-6" aria-hidden="true" tabindex="-1"></a>   df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb39-7"><a href="mod-dp.html#cb39-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">as.numeric</span>(state)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="mod-dp.html#cb39-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(state <span class="sc">&gt;</span> <span class="dv">0</span>, state <span class="sc">&lt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href="mod-dp.html#cb39-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">action =</span> <span class="fu">as.numeric</span>(action)) </span>
<span id="cb39-10"><a href="mod-dp.html#cb39-10" aria-hidden="true" tabindex="-1"></a>   ptPr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> v)) <span class="sc">+</span></span>
<span id="cb39-11"><a href="mod-dp.html#cb39-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb39-12"><a href="mod-dp.html#cb39-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;State-values for prH=&quot;</span>, prH))</span>
<span id="cb39-13"><a href="mod-dp.html#cb39-13" aria-hidden="true" tabindex="-1"></a>   ptPolicy <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> action)) <span class="sc">+</span></span>
<span id="cb39-14"><a href="mod-dp.html#cb39-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb39-15"><a href="mod-dp.html#cb39-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;Optimal policy for prH=&quot;</span>, prH))</span>
<span id="cb39-16"><a href="mod-dp.html#cb39-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ptPr =</span> ptPr, <span class="at">ptPolicy =</span> ptPolicy, <span class="at">policy =</span> df))   </span>
<span id="cb39-17"><a href="mod-dp.html#cb39-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-18"><a href="mod-dp.html#cb39-18" aria-hidden="true" tabindex="-1"></a>res04 <span class="ot">&lt;-</span> <span class="fu">solveGambler</span>(<span class="at">prH =</span> <span class="fl">0.4</span>)</span>
<span id="cb39-19"><a href="mod-dp.html#cb39-19" aria-hidden="true" tabindex="-1"></a>res04<span class="sc">$</span>ptPr</span>
<span id="cb39-20"><a href="mod-dp.html#cb39-20" aria-hidden="true" tabindex="-1"></a>res04<span class="sc">$</span>ptPolicy</span></code></pre></div>
<img src="05_dp_files/figure-html/gambler-solve-1.png" width="672" style="display: block; margin: auto;" /><img src="05_dp_files/figure-html/gambler-solve-2.png" width="672" style="display: block; margin: auto;" />
<p>
There is a lot of different optimal policies. In general since <span class="math inline">\(p_h\)</span> is below 0.5 we want to find a policy with as few flips as possible.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ORmP2lvJjSgOlmiPgT3m">
Solution
</button>
<ol start="2" style="list-style-type: decimal">
<li>Solve the problem using value iteration with <span class="math inline">\(p_h = 0.4\)</span>. Plot the policy with states 1-99 on the x-axis and action on the y-axis. Plot the state-values given states 1-99 on the x-axis. Your policy may not look like the policy in the book, why?</li>
</ol>
<!-- Q3 -->
<div id="9Bvu7fYhXAjr40W9cpTH" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="9Bvu7fYhXAjr40W9cpTH-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="9Bvu7fYhXAjr40W9cpTH-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb40"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb40-1"><a href="mod-dp.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve the problems</span></span>
<span id="cb40-2"><a href="mod-dp.html#cb40-2" aria-hidden="true" tabindex="-1"></a>res025 <span class="ot">&lt;-</span> <span class="fu">solveGambler</span>(<span class="at">prH =</span> <span class="fl">0.25</span>)</span>
<span id="cb40-3"><a href="mod-dp.html#cb40-3" aria-hidden="true" tabindex="-1"></a>res055 <span class="ot">&lt;-</span> <span class="fu">solveGambler</span>(<span class="at">prH =</span> <span class="fl">0.55</span>)</span>
<span id="cb40-4"><a href="mod-dp.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># State-values</span></span>
<span id="cb40-5"><a href="mod-dp.html#cb40-5" aria-hidden="true" tabindex="-1"></a>res025<span class="sc">$</span>policy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">67</span>))</span>
<span id="cb40-6"><a href="mod-dp.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb40-7"><a href="mod-dp.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state       v action</span></span>
<span id="cb40-8"><a href="mod-dp.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb40-9"><a href="mod-dp.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    10 0.00708     10</span></span>
<span id="cb40-10"><a href="mod-dp.html#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    67 0.309       17</span></span>
<span id="cb40-11"><a href="mod-dp.html#cb40-11" aria-hidden="true" tabindex="-1"></a>res055<span class="sc">$</span>policy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">67</span>))</span>
<span id="cb40-12"><a href="mod-dp.html#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb40-13"><a href="mod-dp.html#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v action</span></span>
<span id="cb40-14"><a href="mod-dp.html#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb40-15"><a href="mod-dp.html#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    10 0.855      1</span></span>
<span id="cb40-16"><a href="mod-dp.html#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    67 1.00       1</span></span>
<span id="cb40-17"><a href="mod-dp.html#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results</span></span>
<span id="cb40-18"><a href="mod-dp.html#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb40-19"><a href="mod-dp.html#cb40-19" aria-hidden="true" tabindex="-1"></a>(res025<span class="sc">$</span>ptPr <span class="sc">+</span> res055<span class="sc">$</span>ptPr) <span class="sc">/</span> (res025<span class="sc">$</span>ptPolicy <span class="sc">+</span> res055<span class="sc">$</span>ptPolicy)</span></code></pre></div>
<p><img src="05_dp_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9Bvu7fYhXAjr40W9cpTH">
Solution
</button>
<ol start="3" style="list-style-type: decimal">
<li>Solve the problem using value iteration with <span class="math inline">\(p_h = 0.22\)</span> and <span class="math inline">\(0.55\)</span> and plot the results. What is the probability of winning in state 10 and 67?</li>
</ol>
</div>
<div id="ex-dp-maintain" class="section level3 hasAnchor" number="5.10.2">
<h3><span class="header-section-number">5.10.2</span> Exercise - Maintenance problem<a href="mod-dp.html#ex-dp-maintain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At the beginning of each day a piece of equipment is inspected to reveal its actual working condition. The equipment will be found in one of the working conditions <span class="math inline">\(s = 1,\ldots, N\)</span> where the working condition <span class="math inline">\(s\)</span> is better than the working condition
<span class="math inline">\(s+1\)</span>.</p>
<p>The equipment deteriorates in time. If the present working condition is <span class="math inline">\(s\)</span> and no repair is done, then at the beginning of the next day the equipment has working condition <span class="math inline">\(s&#39;\)</span> with probability <span class="math inline">\(q_{ss&#39;}\)</span>. It is assumed that <span class="math inline">\(q_{ss&#39;}=0\)</span> for <span class="math inline">\(s&#39;&lt;s\)</span> and <span class="math inline">\(\sum_{s&#39;\geq s}q_{ss&#39;}=1\)</span>.</p>
<p>The working condition <span class="math inline">\(s=N\)</span> represents a malfunction that requires an enforced repair taking two days. For the intermediate states <span class="math inline">\(s\)</span> with <span class="math inline">\(1&lt;s&lt;N\)</span> there is a choice between preventively repairing the equipment and letting the equipment operate for the present day. A preventive repair takes only one day. A repaired system has the working condition <span class="math inline">\(s=1\)</span>.</p>
<p>The cost of an enforced repair upon failure is <span class="math inline">\(C_{f}\)</span> and the cost of a preemptive repair in working condition <span class="math inline">\(s\)</span> is <span class="math inline">\(C_{p,s}\)</span>. We wish to determine a maintenance rule which minimizes the repair cost.</p>
<p>The problem can be formulated as an MDP. Since an enforced repair takes two days and the state of the system has to be defined at the beginning of each day, we need an auxiliary state for the situation in which an enforced repair is in progress already for one day.</p>
<!-- Q1 -->
<div id="pMgIJbUDttirEyQVJ7oq" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="pMgIJbUDttirEyQVJ7oq-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="pMgIJbUDttirEyQVJ7oq-title">
Solution
</h4>
</div>
<div class="modal-body">
<p>
<span class="math display">\[\mathcal{S}=\{1,2,\ \ldots,\ N,\ N+1\}.\]</span> State <span class="math inline">\(s\)</span> with <span class="math inline">\(1\leq s\leq N\)</span> corresponds to the situation in which an inspection reveals working condition <span class="math inline">\(s\)</span>, while state <span class="math inline">\(N+1\)</span> corresponds to the situation in which an enforced repair is in progress already for one day.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#pMgIJbUDttirEyQVJ7oq">
Solution
</button>
<ol style="list-style-type: decimal">
<li>Define the state space <span class="math inline">\(\mathcal{S}\)</span>, i.e. the the set of possible states of the system.</li>
</ol>
<!-- Q2 -->
<div id="KaVaqnWuAY0cJ2MHhHwN" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="KaVaqnWuAY0cJ2MHhHwN-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="KaVaqnWuAY0cJ2MHhHwN-title">
Solution
</h4>
</div>
<div class="modal-body">
<p>
The set of possible actions in state <span class="math inline">\(s\)</span> is chosen as <span class="math display">\[\mathcal{A}(1)=\{0\},\ \mathcal{A}(s)=\{0,1\} \text{ for } 1&lt;s&lt;N, \mathcal{A}(N)=\mathcal{A}(N+1)=\{2\}.\]</span>
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KaVaqnWuAY0cJ2MHhHwN">
Solution
</button>
<ol start="2" style="list-style-type: decimal">
<li>Consider actions
<span class="math display">\[
a=\left\{\begin{array}{ll}
0 &amp; \text{if no repair.}\\
1 &amp; \text{if preventive repair.}\\
2 &amp; \text{if forced repair.}\\
\end{array}\right.
\]</span>
Define the action space <span class="math inline">\(\mathcal{A}(s)\)</span> for all states <span class="math inline">\(s\)</span>.</li>
</ol>
<!-- Q3 -->
<div id="clKVSJtgRsK6ZU0SgvJ3" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="clKVSJtgRsK6ZU0SgvJ3-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="clKVSJtgRsK6ZU0SgvJ3-title">
Solution
</h4>
</div>
<div class="modal-body">
<p>
The expected reward is <span class="math inline">\(r(N+1,2) = 0\)</span> and for <span class="math inline">\(0 &lt; s &lt; N\)</span> is <span class="math inline">\(r(s,0) = 0\)</span>, <span class="math inline">\(r(s,1) = -C_{ps}\)</span>. Finally, <span class="math inline">\(r(N,2) = -C_{f}\)</span> and <span class="math inline">\(r(N+1,2) = 0\)</span>.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#clKVSJtgRsK6ZU0SgvJ3">
Solution
</button>
<ol start="3" style="list-style-type: decimal">
<li>Assume that the number of possible working conditions equals <span class="math inline">\(N=5\)</span>. What is the expected reward <span class="math inline">\(r(s,a)\)</span>?</li>
</ol>
<!-- Q4 -->
<div id="V14mHiWLLamkRGydfnl1" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="V14mHiWLLamkRGydfnl1-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="V14mHiWLLamkRGydfnl1-title">
Solution
</h4>
</div>
<div class="modal-body">
<p>
The transition probabilities <span class="math inline">\(p(s&#39;|s,a)\)</span>: <span class="math display">\[p(s&#39;|s,0) = q_{ij}, \text{ for } 1 \leq s&lt;N,\]</span> <span class="math display">\[p(1|s,1) = 1 \text{ for } 1&lt;s&lt;N,\]</span> <span class="math display">\[p(N+1|N,2) = p(1|N+1,2) =1,\]</span> and zero otherwise.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#V14mHiWLLamkRGydfnl1">
Solution
</button>
<ol start="4" style="list-style-type: decimal">
<li>What is the transition probabilities?</li>
</ol>
<!-- Q5 -->
<ol start="5" style="list-style-type: decimal">
<li>Try make a drawing of the state-expanded hypergraph for stage <span class="math inline">\(t\)</span> and <span class="math inline">\(t+1\)</span>.</li>
</ol>
<!-- Q6 -->
<div id="4mydvupHWn0ZgbdNdcMN" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="4mydvupHWn0ZgbdNdcMN-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="4mydvupHWn0ZgbdNdcMN-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb41"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb41-1"><a href="mod-dp.html#cb41-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb41-2"><a href="mod-dp.html#cb41-2" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.90</span>, <span class="fl">0.10</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb41-3"><a href="mod-dp.html#cb41-3" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>, <span class="fl">0.80</span>, <span class="fl">0.10</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>,</span>
<span id="cb41-4"><a href="mod-dp.html#cb41-4" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.70</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>,</span>
<span id="cb41-5"><a href="mod-dp.html#cb41-5" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span>), <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">byrow=</span>T)</span>
<span id="cb41-6"><a href="mod-dp.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(Q) <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb41-7"><a href="mod-dp.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Q) <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb41-8"><a href="mod-dp.html#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="mod-dp.html#cb41-9" aria-hidden="true" tabindex="-1"></a>mdp <span class="ot">&lt;-</span> MDPClass<span class="sc">$</span><span class="fu">new</span>()      <span class="co"># initialize mdp object</span></span>
<span id="cb41-10"><a href="mod-dp.html#cb41-10" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addStateSpace</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)   <span class="co"># add states (states are keys in a hash and are always converted to strings), 101 represent finished</span></span>
<span id="cb41-11"><a href="mod-dp.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) {  <span class="co"># add actions for each state (only the key of the action)</span></span>
<span id="cb41-12"><a href="mod-dp.html#cb41-12" aria-hidden="true" tabindex="-1"></a>   i <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb41-13"><a href="mod-dp.html#cb41-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="st">&quot;nr&quot;</span>)  </span>
<span id="cb41-14"><a href="mod-dp.html#cb41-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> i <span class="sc">&lt;=</span> <span class="dv">4</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="fu">c</span>(<span class="st">&quot;nr&quot;</span>, <span class="st">&quot;pr&quot;</span>))</span>
<span id="cb41-15"><a href="mod-dp.html#cb41-15" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">5</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="st">&quot;fr&quot;</span>)  </span>
<span id="cb41-16"><a href="mod-dp.html#cb41-16" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">6</span>) mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="st">&quot;fr&quot;</span>)</span>
<span id="cb41-17"><a href="mod-dp.html#cb41-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-18"><a href="mod-dp.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># check some of the keys</span></span>
<span id="cb41-19"><a href="mod-dp.html#cb41-19" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;2&quot;</span>)</span>
<span id="cb41-20"><a href="mod-dp.html#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;nr&quot; &quot;pr&quot;</span></span>
<span id="cb41-21"><a href="mod-dp.html#cb41-21" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;1&quot;</span>)</span>
<span id="cb41-22"><a href="mod-dp.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;nr&quot;</span></span>
<span id="cb41-23"><a href="mod-dp.html#cb41-23" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;6&quot;</span>)</span>
<span id="cb41-24"><a href="mod-dp.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;fr&quot;</span></span>
<span id="cb41-25"><a href="mod-dp.html#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="mod-dp.html#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Add trans pr and expected reward to the actions</span></span>
<span id="cb41-27"><a href="mod-dp.html#cb41-27" aria-hidden="true" tabindex="-1"></a>cPR<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb41-28"><a href="mod-dp.html#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) {</span>
<span id="cb41-29"><a href="mod-dp.html#cb41-29" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (a <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(s)) {</span>
<span id="cb41-30"><a href="mod-dp.html#cb41-30" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb41-31"><a href="mod-dp.html#cb41-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">==</span> <span class="st">&quot;nr&quot;</span>) {</span>
<span id="cb41-32"><a href="mod-dp.html#cb41-32" aria-hidden="true" tabindex="-1"></a>         rew <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-33"><a href="mod-dp.html#cb41-33" aria-hidden="true" tabindex="-1"></a>         transPr <span class="ot">&lt;-</span> Q[i, Q[i,] <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb41-34"><a href="mod-dp.html#cb41-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb41-35"><a href="mod-dp.html#cb41-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">==</span> <span class="st">&quot;pr&quot;</span>) {</span>
<span id="cb41-36"><a href="mod-dp.html#cb41-36" aria-hidden="true" tabindex="-1"></a>         rew <span class="ot">&lt;-</span> <span class="sc">-</span>cPR[i]</span>
<span id="cb41-37"><a href="mod-dp.html#cb41-37" aria-hidden="true" tabindex="-1"></a>         transPr <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb41-38"><a href="mod-dp.html#cb41-38" aria-hidden="true" tabindex="-1"></a>         <span class="fu">names</span>(transPr) <span class="ot">&lt;-</span> <span class="st">&quot;1&quot;</span></span>
<span id="cb41-39"><a href="mod-dp.html#cb41-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb41-40"><a href="mod-dp.html#cb41-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">==</span> <span class="st">&quot;fr&quot;</span> <span class="sc">&amp;</span> i <span class="sc">==</span> <span class="dv">5</span>) {</span>
<span id="cb41-41"><a href="mod-dp.html#cb41-41" aria-hidden="true" tabindex="-1"></a>         rew <span class="ot">=</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb41-42"><a href="mod-dp.html#cb41-42" aria-hidden="true" tabindex="-1"></a>         transPr <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb41-43"><a href="mod-dp.html#cb41-43" aria-hidden="true" tabindex="-1"></a>         <span class="fu">names</span>(transPr) <span class="ot">&lt;-</span> <span class="st">&quot;6&quot;</span></span>
<span id="cb41-44"><a href="mod-dp.html#cb41-44" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb41-45"><a href="mod-dp.html#cb41-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">==</span> <span class="st">&quot;fr&quot;</span> <span class="sc">&amp;</span> i <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb41-46"><a href="mod-dp.html#cb41-46" aria-hidden="true" tabindex="-1"></a>         rew <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb41-47"><a href="mod-dp.html#cb41-47" aria-hidden="true" tabindex="-1"></a>         transPr <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb41-48"><a href="mod-dp.html#cb41-48" aria-hidden="true" tabindex="-1"></a>         <span class="fu">names</span>(transPr) <span class="ot">&lt;-</span> <span class="st">&quot;1&quot;</span></span>
<span id="cb41-49"><a href="mod-dp.html#cb41-49" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb41-50"><a href="mod-dp.html#cb41-50" aria-hidden="true" tabindex="-1"></a>      mdp<span class="sc">$</span><span class="fu">addAction</span>(s, a, <span class="at">r =</span> rew, <span class="at">pr =</span> transPr)</span>
<span id="cb41-51"><a href="mod-dp.html#cb41-51" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb41-52"><a href="mod-dp.html#cb41-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-53"><a href="mod-dp.html#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="co"># check some of the keys</span></span>
<span id="cb41-54"><a href="mod-dp.html#cb41-54" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;1&quot;</span>)</span>
<span id="cb41-55"><a href="mod-dp.html#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nr</span></span>
<span id="cb41-56"><a href="mod-dp.html#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nr$r</span></span>
<span id="cb41-57"><a href="mod-dp.html#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb41-58"><a href="mod-dp.html#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-59"><a href="mod-dp.html#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nr$pr</span></span>
<span id="cb41-60"><a href="mod-dp.html#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1   2 </span></span>
<span id="cb41-61"><a href="mod-dp.html#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.9 0.1</span></span>
<span id="cb41-62"><a href="mod-dp.html#cb41-62" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;2&quot;</span>)</span>
<span id="cb41-63"><a href="mod-dp.html#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nr</span></span>
<span id="cb41-64"><a href="mod-dp.html#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nr$r</span></span>
<span id="cb41-65"><a href="mod-dp.html#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb41-66"><a href="mod-dp.html#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-67"><a href="mod-dp.html#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nr$pr</span></span>
<span id="cb41-68"><a href="mod-dp.html#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    2    3    4    5 </span></span>
<span id="cb41-69"><a href="mod-dp.html#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.80 0.10 0.05 0.05 </span></span>
<span id="cb41-70"><a href="mod-dp.html#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-71"><a href="mod-dp.html#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-72"><a href="mod-dp.html#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pr</span></span>
<span id="cb41-73"><a href="mod-dp.html#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pr$r</span></span>
<span id="cb41-74"><a href="mod-dp.html#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -7</span></span>
<span id="cb41-75"><a href="mod-dp.html#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-76"><a href="mod-dp.html#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pr$pr</span></span>
<span id="cb41-77"><a href="mod-dp.html#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb41-78"><a href="mod-dp.html#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span>
<span id="cb41-79"><a href="mod-dp.html#cb41-79" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;5&quot;</span>)</span>
<span id="cb41-80"><a href="mod-dp.html#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $fr</span></span>
<span id="cb41-81"><a href="mod-dp.html#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $fr$r</span></span>
<span id="cb41-82"><a href="mod-dp.html#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -10</span></span>
<span id="cb41-83"><a href="mod-dp.html#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-84"><a href="mod-dp.html#cb41-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $fr$pr</span></span>
<span id="cb41-85"><a href="mod-dp.html#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 </span></span>
<span id="cb41-86"><a href="mod-dp.html#cb41-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span>
<span id="cb41-87"><a href="mod-dp.html#cb41-87" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;6&quot;</span>)</span>
<span id="cb41-88"><a href="mod-dp.html#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $fr</span></span>
<span id="cb41-89"><a href="mod-dp.html#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $fr$r</span></span>
<span id="cb41-90"><a href="mod-dp.html#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb41-91"><a href="mod-dp.html#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-92"><a href="mod-dp.html#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $fr$pr</span></span>
<span id="cb41-93"><a href="mod-dp.html#cb41-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb41-94"><a href="mod-dp.html#cb41-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span></code></pre></div>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#4mydvupHWn0ZgbdNdcMN">
Solution
</button>
<ol start="6" style="list-style-type: decimal">
<li><p>The repair costs are given by <span class="math inline">\(C_{f}=10,\ C_{p2}=7,\ C_{p3}=7\)</span> and <span class="math inline">\(C_{p4}=5\)</span> and the deterioration probabilities <span class="math inline">\(q_{ij}\)</span> are given by matrix Q:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="mod-dp.html#cb42-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb42-2"><a href="mod-dp.html#cb42-2" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.90</span>, <span class="fl">0.10</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb42-3"><a href="mod-dp.html#cb42-3" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>, <span class="fl">0.80</span>, <span class="fl">0.10</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>,</span>
<span id="cb42-4"><a href="mod-dp.html#cb42-4" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.70</span>, <span class="fl">0.10</span>, <span class="fl">0.20</span>,</span>
<span id="cb42-5"><a href="mod-dp.html#cb42-5" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span>), <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">byrow=</span>T)</span>
<span id="cb42-6"><a href="mod-dp.html#cb42-6" aria-hidden="true" tabindex="-1"></a>Q</span>
<span id="cb42-7"><a href="mod-dp.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb42-8"><a href="mod-dp.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  0.9  0.1  0.0 0.00 0.00</span></span>
<span id="cb42-9"><a href="mod-dp.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  0.0  0.8  0.1 0.05 0.05</span></span>
<span id="cb42-10"><a href="mod-dp.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]  0.0  0.0  0.7 0.10 0.20</span></span>
<span id="cb42-11"><a href="mod-dp.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]  0.0  0.0  0.0 0.50 0.50</span></span></code></pre></div>
<p>Build the MDP in R.</p></li>
</ol>
<!-- Q7 -->
<div id="rzEGYMlIhqo6mW5JOslC" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="rzEGYMlIhqo6mW5JOslC-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="rzEGYMlIhqo6mW5JOslC-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb43"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb43-1"><a href="mod-dp.html#cb43-1" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">valueIte</span>(<span class="at">gamma =</span> <span class="fl">0.6</span>)</span>
<span id="cb43-2"><a href="mod-dp.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mdp$policyIte(gamma = 0.6)</span></span>
<span id="cb43-3"><a href="mod-dp.html#cb43-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mdp<span class="sc">$</span><span class="fu">getStateValues</span>(), mdp<span class="sc">$</span><span class="fu">getPolicy</span>(), <span class="at">by =</span> <span class="st">&quot;state&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="mod-dp.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>pr)</span>
<span id="cb43-5"><a href="mod-dp.html#cb43-5" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb43-6"><a href="mod-dp.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb43-7"><a href="mod-dp.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state        v action</span></span>
<span id="cb43-8"><a href="mod-dp.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; </span></span>
<span id="cb43-9"><a href="mod-dp.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1      -0.146  nr    </span></span>
<span id="cb43-10"><a href="mod-dp.html#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2      -1.12   nr    </span></span>
<span id="cb43-11"><a href="mod-dp.html#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3      -2.53   nr    </span></span>
<span id="cb43-12"><a href="mod-dp.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4      -4.31   nr    </span></span>
<span id="cb43-13"><a href="mod-dp.html#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 5     -10.1    fr    </span></span>
<span id="cb43-14"><a href="mod-dp.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 6      -0.0876 fr</span></span></code></pre></div>
<p>
In state 3 the discounted cost is 2.53.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rzEGYMlIhqo6mW5JOslC">
Solution
</button>
<ol start="7" style="list-style-type: decimal">
<li>Find the optimal policy given a discount rate of <span class="math inline">\(\gamma = 0.6\)</span>. What is the average discounted cost of being in state 3?</li>
</ol>
<!-- Q8 -->
<div id="sQCCASxH0wjyHDz8A3iL" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="sQCCASxH0wjyHDz8A3iL-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="sQCCASxH0wjyHDz8A3iL-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb44"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb44-1"><a href="mod-dp.html#cb44-1" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">valueIte</span>(<span class="at">gamma =</span> <span class="fl">0.99</span>)</span>
<span id="cb44-2"><a href="mod-dp.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mdp$policyIte(gamma = 0.99)</span></span>
<span id="cb44-3"><a href="mod-dp.html#cb44-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mdp<span class="sc">$</span><span class="fu">getStateValues</span>(), mdp<span class="sc">$</span><span class="fu">getPolicy</span>(), <span class="at">by =</span> <span class="st">&quot;state&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="mod-dp.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>pr)</span>
<span id="cb44-5"><a href="mod-dp.html#cb44-5" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb44-6"><a href="mod-dp.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb44-7"><a href="mod-dp.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state        v action</span></span>
<span id="cb44-8"><a href="mod-dp.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; </span></span>
<span id="cb44-9"><a href="mod-dp.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1      -0.146  nr    </span></span>
<span id="cb44-10"><a href="mod-dp.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2      -1.12   nr    </span></span>
<span id="cb44-11"><a href="mod-dp.html#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3      -2.53   nr    </span></span>
<span id="cb44-12"><a href="mod-dp.html#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4      -4.31   nr    </span></span>
<span id="cb44-13"><a href="mod-dp.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 5     -10.1    fr    </span></span>
<span id="cb44-14"><a href="mod-dp.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 6      -0.0876 fr</span></span>
<span id="cb44-15"><a href="mod-dp.html#cb44-15" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb44-16"><a href="mod-dp.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb44-17"><a href="mod-dp.html#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v action</span></span>
<span id="cb44-18"><a href="mod-dp.html#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; </span></span>
<span id="cb44-19"><a href="mod-dp.html#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1     -41.3 nr    </span></span>
<span id="cb44-20"><a href="mod-dp.html#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2     -45.5 nr    </span></span>
<span id="cb44-21"><a href="mod-dp.html#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3     -47.4 nr    </span></span>
<span id="cb44-22"><a href="mod-dp.html#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4     -45.9 pr    </span></span>
<span id="cb44-23"><a href="mod-dp.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 5     -50.5 fr    </span></span>
<span id="cb44-24"><a href="mod-dp.html#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 6     -40.9 fr</span></span></code></pre></div>
<p>
A higher discont rate put more weight on future values, i.e. you have to look further ahead resulting in more iterations. This also results in a higher disconted cost, since costs in the future have higher weight. The optimal policy looks a bit different compared to the policy we found for <span class="math inline">\(\gamma = 0.6\)</span>. However, if the policy is the same for two different discount rates then you will have the same rewards/costs and hence the same cost of the policy. The discounted cost will not be the same since you use the discount rate to say how much you value the future.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sQCCASxH0wjyHDz8A3iL">
Solution
</button>
<ol start="8" style="list-style-type: decimal">
<li>Find the optimal policy using value iteration given a discount rate of <span class="math inline">\(\gamma = 0.99\)</span>. Why do the algorithm need more iterations compared to when <span class="math inline">\(\gamma = 0.6\)</span>? Why are the average discounted costs higher compared to when <span class="math inline">\(\gamma = 0.6\)</span>? Is it more costly to use this optimal policy?</li>
</ol>
</div>
<div id="ex-dp-rental" class="section level3 hasAnchor" number="5.10.3">
<h3><span class="header-section-number">5.10.3</span> Exercise - Car rental<a href="mod-dp.html#ex-dp-rental" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider the car rental problem in Exercise <a href="mod-mdp-2.html#ex-mdp-2-car">4.8.2</a>. Note the inventory dynamics (number of cars) at each parking lot is independent of the other given an action <span class="math inline">\(a\)</span>. Let us consider Location 1 and assume that we are in state <span class="math inline">\(x\)</span> and chose action <span class="math inline">\(a\)</span>.</p>
<p>The reward equals the reward of rentals minus the cost of movements. Note we have <span class="math inline">\(\bar{x} = x - a\)</span> and <span class="math inline">\(\bar{y} = x + a\)</span> after movement. Hence <span class="math display">\[r(s,a) = \mathbb{E}[10(\min(D_1, \bar{x}) + \min(D_2, \bar{y}) )-2\mid a \mid]\]</span>
where <span class="math display">\[\mathbb{E}[\min(D, z)] = \sum_{i=0}^{z-1} i\Pr(D = i) + \Pr(D \geq z)z.\]</span></p>
<p>Let us make a reward function in R:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="mod-dp.html#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="mod-dp.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean of min(D,z). Assume z &gt;= 0</span></span>
<span id="cb45-3"><a href="mod-dp.html#cb45-3" aria-hidden="true" tabindex="-1"></a>meanMinD <span class="ot">&lt;-</span> <span class="cf">function</span>(z, lambda) {</span>
<span id="cb45-4"><a href="mod-dp.html#cb45-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (z <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb45-5"><a href="mod-dp.html#cb45-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="dv">0</span><span class="sc">:</span>(z<span class="dv">-1</span>), lambda) <span class="sc">*</span> <span class="dv">0</span><span class="sc">:</span>(z<span class="dv">-1</span>)) <span class="sc">+</span> <span class="fu">ppois</span>(z<span class="dv">-1</span>, lambda, <span class="at">lower.tail =</span> F) <span class="sc">*</span> z</span>
<span id="cb45-6"><a href="mod-dp.html#cb45-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-7"><a href="mod-dp.html#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="mod-dp.html#cb45-8" aria-hidden="true" tabindex="-1"></a>reward <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, a) {</span>
<span id="cb45-9"><a href="mod-dp.html#cb45-9" aria-hidden="true" tabindex="-1"></a>   <span class="dv">10</span> <span class="sc">*</span> <span class="fu">meanMinD</span>(x<span class="sc">-</span>a, <span class="dv">3</span>) <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">meanMinD</span>(y<span class="sc">+</span>a, <span class="dv">4</span>) <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(a)</span>
<span id="cb45-10"><a href="mod-dp.html#cb45-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-11"><a href="mod-dp.html#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="mod-dp.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">reward</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb45-13"><a href="mod-dp.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 30</span></span>
<span id="cb45-14"><a href="mod-dp.html#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">reward</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb45-15"><a href="mod-dp.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 55.9</span></span></code></pre></div>
<p>Let us have a look at the state transition, the number of cars after rental requests <span class="math inline">\(\bar{x} - \min(D_1, \bar{x})\)</span>. Next, the number of returned cars are added: <span class="math inline">\(\bar{x} - \min(D_1, \bar{x}) + H_1\)</span>. Finally, note that if this number is above 20 (parking lot capacity), then we only have 20 cars, i.e. the inventory dynamics (number of cars at the end of the day) is <span class="math display">\[X = \min(20,  \bar{x} - \min(D_1, \bar{x}) +  H_1))).\]</span>
Similar for Location 2, if <span class="math inline">\(\bar{y}= y+a\)</span> we have <span class="math display">\[Y = \min(20, \bar{y} - \min(D_2, \bar{y}) + H_2)).\]</span></p>
<p>Since the dynamics is independent given action a, the transition probabilities can be split: <span class="math display">\[ p((x&#39;,y&#39;) | (x,y), a) = p(x&#39; | x, a) p(y&#39; | y, a).\]</span></p>
<p>Let us consider Location 1. If <span class="math inline">\(x&#39; &lt; 20\)</span> then
<span class="math display">\[
\begin{align} 
   p(x&#39; | x, a) &amp;= \Pr(x&#39; = x-a - \min(D_1, x-a) +  H_1)\\ 
                &amp;= \Pr(x&#39; = \bar{x} - \min(D_1, \bar{x}) +  H_1)\\ 
                &amp;= \Pr(H_1 - \min(D_1, \bar{x}) = x&#39; - \bar{x}) \\ 
                &amp;= \sum_{i=0}^{\bar{x}} \Pr(\min(D_1, \bar{x}) = i)\Pr(H_1 = x&#39; - \bar{x} + i) \\ 
                &amp;= \sum_{i=0}^{\bar{x}}\left( (\mathbf{1}_{(i&lt;\bar{x})} \Pr(D_1 = i) + \mathbf{1}_{(i=\bar{x})} \Pr(D_1 \geq \bar{x}))\Pr(H_1 = x&#39; - \bar{x} + i)\right) \\
                &amp;= p(x&#39; | \bar{x}).
\end{align}
\]</span></p>
<p>If <span class="math inline">\(x&#39; = 20\)</span> then
<span class="math display">\[
\begin{align} 
   p(x&#39; | x, a) &amp;= \Pr(20 \leq \bar{x} - \min(D_1, \bar{x}) +  H_1)\\ 
                &amp;= \Pr(H_1 - \min(D_1, \bar{x}) \geq 20 - \bar{x}) \\ 
                &amp;= \sum_{i=0}^{\bar{x}} \Pr(\min(D_1, \bar{x}) = i)\Pr(H_1 \geq 20 - \bar{x} + i) \\ 
                &amp;= \sum_{i=0}^{\bar{x}}\left( (\mathbf{1}_{(i&lt;\bar{x})} \Pr(D_1 =i) + \mathbf{1}_{(i=\bar{x})} \Pr(D_1 \geq \bar{x}))\Pr(H_1 \geq 20 - \bar{x} + i)\right)\\
                &amp;= p(x&#39; = 20 | \bar{x}).
\end{align}
\]</span></p>
<p>Similar for Location 2. That is we need to calculate and store <span class="math inline">\(p(x&#39;| \bar{x})\)</span> and <span class="math inline">\(p(y&#39;| \bar{y})\)</span> to find <span class="math display">\[ p((x&#39;,y&#39;) | (x,y), a) = p(x&#39; | \bar{x} = x-a) p(y&#39; | \bar{y} = y+a).\]</span> This is done in R using two matrices:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="mod-dp.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-2"><a href="mod-dp.html#cb46-2" aria-hidden="true" tabindex="-1"></a>lD <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb46-3"><a href="mod-dp.html#cb46-3" aria-hidden="true" tabindex="-1"></a>lH <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb46-4"><a href="mod-dp.html#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="mod-dp.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pr(min(D_i, k) = d)</span></span>
<span id="cb46-6"><a href="mod-dp.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># assume that d&lt;=k</span></span>
<span id="cb46-7"><a href="mod-dp.html#cb46-7" aria-hidden="true" tabindex="-1"></a>prMin <span class="ot">&lt;-</span> <span class="cf">function</span>(i, k, d) {</span>
<span id="cb46-8"><a href="mod-dp.html#cb46-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (k <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">1</span>)</span>
<span id="cb46-9"><a href="mod-dp.html#cb46-9" aria-hidden="true" tabindex="-1"></a>   v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">dpois</span>(<span class="dv">0</span><span class="sc">:</span>(k<span class="dv">-1</span>), lD[i]), <span class="fu">ppois</span>(k<span class="dv">-1</span>, lD[i], <span class="at">lower.tail =</span> F))</span>
<span id="cb46-10"><a href="mod-dp.html#cb46-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(v[d<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb46-11"><a href="mod-dp.html#cb46-11" aria-hidden="true" tabindex="-1"></a>   <span class="co"># if (d == k) return(1 - pD[i, d])     # 1-pr(D &lt;= d-1)</span></span>
<span id="cb46-12"><a href="mod-dp.html#cb46-12" aria-hidden="true" tabindex="-1"></a>   <span class="co"># if (d &lt; k) return(dD[i, d+1])</span></span>
<span id="cb46-13"><a href="mod-dp.html#cb46-13" aria-hidden="true" tabindex="-1"></a>   <span class="co"># return(NA)</span></span>
<span id="cb46-14"><a href="mod-dp.html#cb46-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-15"><a href="mod-dp.html#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="mod-dp.html#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Pr(xN | x, a)</span></span>
<span id="cb46-17"><a href="mod-dp.html#cb46-17" aria-hidden="true" tabindex="-1"></a>transPrX <span class="ot">&lt;-</span> <span class="cf">function</span>(xN, xBar) {</span>
<span id="cb46-18"><a href="mod-dp.html#cb46-18" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (xN <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb46-19"><a href="mod-dp.html#cb46-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">prMin</span>(<span class="dv">1</span>, xBar, <span class="dv">0</span><span class="sc">:</span>(xBar)) <span class="sc">*</span> <span class="fu">ppois</span>(xN <span class="sc">-</span> xBar <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(xBar) <span class="sc">-</span> <span class="dv">1</span>, lH[<span class="dv">1</span>], <span class="at">lower.tail =</span> F)))</span>
<span id="cb46-20"><a href="mod-dp.html#cb46-20" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb46-21"><a href="mod-dp.html#cb46-21" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (xN <span class="sc">&lt;</span> <span class="dv">20</span>) {</span>
<span id="cb46-22"><a href="mod-dp.html#cb46-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">prMin</span>(<span class="dv">1</span>, xBar, <span class="dv">0</span><span class="sc">:</span>(xBar)) <span class="sc">*</span> <span class="fu">dpois</span>(xN <span class="sc">-</span> xBar <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(xBar), lH[<span class="dv">1</span>])))</span>
<span id="cb46-23"><a href="mod-dp.html#cb46-23" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb46-24"><a href="mod-dp.html#cb46-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">error</span>(<span class="st">&quot;Error in calculations!&quot;</span>)</span>
<span id="cb46-25"><a href="mod-dp.html#cb46-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-26"><a href="mod-dp.html#cb46-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-27"><a href="mod-dp.html#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Pr(yN | y, a)</span></span>
<span id="cb46-28"><a href="mod-dp.html#cb46-28" aria-hidden="true" tabindex="-1"></a>transPrY <span class="ot">&lt;-</span> <span class="cf">function</span>(yN, yBar) {</span>
<span id="cb46-29"><a href="mod-dp.html#cb46-29" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (yN <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb46-30"><a href="mod-dp.html#cb46-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">prMin</span>(<span class="dv">2</span>, yBar, <span class="dv">0</span><span class="sc">:</span>(yBar)) <span class="sc">*</span> <span class="fu">ppois</span>(yN <span class="sc">-</span> yBar <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(yBar) <span class="sc">-</span> <span class="dv">1</span>, lH[<span class="dv">2</span>], <span class="at">lower.tail =</span> F)))</span>
<span id="cb46-31"><a href="mod-dp.html#cb46-31" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb46-32"><a href="mod-dp.html#cb46-32" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (yN <span class="sc">&lt;</span> <span class="dv">20</span>) {</span>
<span id="cb46-33"><a href="mod-dp.html#cb46-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">prMin</span>(<span class="dv">2</span>, yBar, <span class="dv">0</span><span class="sc">:</span>(yBar)) <span class="sc">*</span> <span class="fu">dpois</span>(yN <span class="sc">-</span> yBar <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(yBar), lH[<span class="dv">2</span>])))</span>
<span id="cb46-34"><a href="mod-dp.html#cb46-34" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb46-35"><a href="mod-dp.html#cb46-35" aria-hidden="true" tabindex="-1"></a>   <span class="fu">error</span>(<span class="st">&quot;Error in calculations!&quot;</span>)</span>
<span id="cb46-36"><a href="mod-dp.html#cb46-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-37"><a href="mod-dp.html#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="mod-dp.html#cb46-38" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">21</span>, <span class="at">ncol =</span> <span class="dv">21</span>)</span>
<span id="cb46-39"><a href="mod-dp.html#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb46-40"><a href="mod-dp.html#cb46-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb46-41"><a href="mod-dp.html#cb46-41" aria-hidden="true" tabindex="-1"></a>matTransPrX <span class="ot">&lt;-</span> mat     <span class="co"># matTransPrX[r,c] = Pr(xN = c-1 | xBar = r-1)</span></span>
<span id="cb46-42"><a href="mod-dp.html#cb46-42" aria-hidden="true" tabindex="-1"></a>matTransPrY <span class="ot">&lt;-</span> mat</span>
<span id="cb46-43"><a href="mod-dp.html#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>) {</span>
<span id="cb46-44"><a href="mod-dp.html#cb46-44" aria-hidden="true" tabindex="-1"></a>   xBar <span class="ot">&lt;-</span> r<span class="dv">-1</span></span>
<span id="cb46-45"><a href="mod-dp.html#cb46-45" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (c <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>) {</span>
<span id="cb46-46"><a href="mod-dp.html#cb46-46" aria-hidden="true" tabindex="-1"></a>      xN <span class="ot">&lt;-</span> c<span class="dv">-1</span></span>
<span id="cb46-47"><a href="mod-dp.html#cb46-47" aria-hidden="true" tabindex="-1"></a>      matTransPrX[r,c] <span class="ot">&lt;-</span> <span class="fu">transPrX</span>(xN, xBar)</span>
<span id="cb46-48"><a href="mod-dp.html#cb46-48" aria-hidden="true" tabindex="-1"></a>      matTransPrY[r,c] <span class="ot">&lt;-</span> <span class="fu">transPrY</span>(xN, xBar)</span>
<span id="cb46-49"><a href="mod-dp.html#cb46-49" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb46-50"><a href="mod-dp.html#cb46-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-51"><a href="mod-dp.html#cb46-51" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb46-52"><a href="mod-dp.html#cb46-52" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(matTransPrX)</span>
<span id="cb46-53"><a href="mod-dp.html#cb46-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 </span></span>
<span id="cb46-54"><a href="mod-dp.html#cb46-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</span></span>
<span id="cb46-55"><a href="mod-dp.html#cb46-55" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(matTransPrY)</span>
<span id="cb46-56"><a href="mod-dp.html#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 </span></span>
<span id="cb46-57"><a href="mod-dp.html#cb46-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</span></span></code></pre></div>
<!-- Q1 -->
<div id="LEGcHXmn0dmL68RV8hom" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="LEGcHXmn0dmL68RV8hom-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="LEGcHXmn0dmL68RV8hom-title">
Hint
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="mod-dp.html#cb47-1" aria-hidden="true" tabindex="-1"></a>mdp <span class="ot">&lt;-</span> MDPClass<span class="sc">$</span><span class="fu">new</span>()      <span class="co"># initialize mdp object</span></span>
<span id="cb47-2"><a href="mod-dp.html#cb47-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">y =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="mod-dp.html#cb47-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span> (<span class="at">state =</span> <span class="fu">str_c</span>(x,<span class="st">&quot;,&quot;</span>,y)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="mod-dp.html#cb47-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pull</span>(state)</span>
<span id="cb47-5"><a href="mod-dp.html#cb47-5" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addStateSpace</span>(states)   <span class="co"># add states (states are keys in a hash and are always converted to strings)</span></span>
<span id="cb47-6"><a href="mod-dp.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) {  <span class="co"># add actions for each state (only the key of the action)</span></span>
<span id="cb47-7"><a href="mod-dp.html#cb47-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">str_split</span>(s, <span class="st">&quot;,&quot;</span>, <span class="at">simplify =</span> T)</span>
<span id="cb47-8"><a href="mod-dp.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x[<span class="dv">2</span>])</span>
<span id="cb47-9"><a href="mod-dp.html#cb47-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x[<span class="dv">1</span>])</span>
<span id="cb47-10"><a href="mod-dp.html#cb47-10" aria-hidden="true" tabindex="-1"></a>    ___</span>
<span id="cb47-11"><a href="mod-dp.html#cb47-11" aria-hidden="true" tabindex="-1"></a>    mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, a)</span>
<span id="cb47-12"><a href="mod-dp.html#cb47-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-13"><a href="mod-dp.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># check some of the keys</span></span>
<span id="cb47-14"><a href="mod-dp.html#cb47-14" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;6,7&quot;</span>)</span>
<span id="cb47-15"><a href="mod-dp.html#cb47-15" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;0,3&quot;</span>)</span>
<span id="cb47-16"><a href="mod-dp.html#cb47-16" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;0,0&quot;</span>)</span>
<span id="cb47-17"><a href="mod-dp.html#cb47-17" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(<span class="st">&quot;20,20&quot;</span>)</span>
<span id="cb47-18"><a href="mod-dp.html#cb47-18" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()</span>
<span id="cb47-19"><a href="mod-dp.html#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="mod-dp.html#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add trans pr and expected reward to the actions. This may take some time!!</span></span>
<span id="cb47-21"><a href="mod-dp.html#cb47-21" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">y =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-22"><a href="mod-dp.html#cb47-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span> (<span class="at">state =</span> <span class="fu">str_c</span>(x,<span class="st">&quot;,&quot;</span>,y), <span class="at">pr =</span> <span class="dv">0</span>) </span>
<span id="cb47-23"><a href="mod-dp.html#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getStateKeys</span>()) {</span>
<span id="cb47-24"><a href="mod-dp.html#cb47-24" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (aS <span class="cf">in</span> mdp<span class="sc">$</span><span class="fu">getActionKeys</span>(s)) {</span>
<span id="cb47-25"><a href="mod-dp.html#cb47-25" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">str_split</span>(s, <span class="st">&quot;,&quot;</span>, <span class="at">simplify =</span> T)</span>
<span id="cb47-26"><a href="mod-dp.html#cb47-26" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x[<span class="dv">2</span>])</span>
<span id="cb47-27"><a href="mod-dp.html#cb47-27" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x[<span class="dv">1</span>])</span>
<span id="cb47-28"><a href="mod-dp.html#cb47-28" aria-hidden="true" tabindex="-1"></a>      a <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(aS) </span>
<span id="cb47-29"><a href="mod-dp.html#cb47-29" aria-hidden="true" tabindex="-1"></a>      xBar <span class="ot">&lt;-</span> x<span class="sc">-</span>a</span>
<span id="cb47-30"><a href="mod-dp.html#cb47-30" aria-hidden="true" tabindex="-1"></a>      yBar <span class="ot">&lt;-</span> y<span class="sc">+</span>a</span>
<span id="cb47-31"><a href="mod-dp.html#cb47-31" aria-hidden="true" tabindex="-1"></a>      ___</span>
<span id="cb47-32"><a href="mod-dp.html#cb47-32" aria-hidden="true" tabindex="-1"></a>      mdp<span class="sc">$</span><span class="fu">addAction</span>(s, aS, <span class="at">r =</span> <span class="fu">reward</span>(x, y, a), <span class="at">pr =</span> transPr)</span>
<span id="cb47-33"><a href="mod-dp.html#cb47-33" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb47-34"><a href="mod-dp.html#cb47-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-35"><a href="mod-dp.html#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="co"># check some of the keys</span></span>
<span id="cb47-36"><a href="mod-dp.html#cb47-36" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;20,20&quot;</span>)</span>
<span id="cb47-37"><a href="mod-dp.html#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;20,20&quot;</span>)<span class="sc">$</span><span class="st">&quot;0&quot;</span><span class="sc">$</span>pr)</span>
<span id="cb47-38"><a href="mod-dp.html#cb47-38" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;20,0&quot;</span>)</span>
<span id="cb47-39"><a href="mod-dp.html#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;20,20&quot;</span>)<span class="sc">$</span><span class="st">&quot;0&quot;</span><span class="sc">$</span>pr)</span></code></pre></div>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#LEGcHXmn0dmL68RV8hom">
Hint
</button>
<ol style="list-style-type: decimal">
<li>Build the model in R.</li>
</ol>
<!-- Q2 -->
<ol start="2" style="list-style-type: decimal">
<li>Solve the problem using policy iteration with a discount rate <span class="math inline">\(\gamma = 0.5\)</span> and threshold parameter <span class="math inline">\(\theta = 0.9\)</span>. What is the optimal action in state <span class="math inline">\((1,15)\)</span>? What is the expected total discounted reward of being in state <span class="math inline">\((10,3)\)</span>? How do theta affect the state-values? Make a plot of the optimal policy with <span class="math inline">\(x\)</span> on the y-axis and <span class="math inline">\(y\)</span> on the x-axis, plotting the action.</li>
</ol>
<!-- Q3 -->
<ol start="3" style="list-style-type: decimal">
<li>Solve the problem using value iteration. Check if the policy and state-values are the same as in Question 1. If not why could this be okay?</li>
</ol>
<!-- Q4 -->
<ol start="4" style="list-style-type: decimal">
<li>Solve the problem using policy iteration with a discount rate <span class="math inline">\(\gamma = 0.9\)</span> and threshold parameter <span class="math inline">\(\theta = 0.9\)</span>. Why are the state-values higher now?</li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Sutton18" class="csl-entry">
Sutton, R. S., and A. G. Barto. 2018. <em>Reinforcement Learning: An Introduction</em>. Second Edition. MIT Press. <a href="http://incompleteideas.net/book/the-book.html">http://incompleteideas.net/book/the-book.html</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mod-mdp-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mod-mc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/rl/edit/master/book/05_dp.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
