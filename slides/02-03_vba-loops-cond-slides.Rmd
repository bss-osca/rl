---
title: "Loops and conditional statements (decisions)"
author: "Lars Relund Nielsen"
output:
  xaringan::moon_reader:
    css: "./libs/slides.css"
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightLines: true
      highlightStyle: solarized-light
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r, child = "setup.Rmd", echo=FALSE}
```

```{r include=FALSE}
# use xaringan::inf_mr(cast_from = ".") to preview
```

layout: true

<div class="my-footer">
<span>
<a href="https://bss-osca.github.io/tfa/mod-vba-loops-cond" target="_blank">Book</a> | <a href="https://bss-osca.github.io/tfa/slides/02-03_vba-loops-cond-slides.html" target="_blank">Slides</a> | <a href="https://github.com/bss-osca/tfa/blob/master/slides/02-03_vba-loops-cond-slides.Rmd" target="_blank">Source</a> | <a href="https://github.com/bss-osca/tfa/blob/master/vba/vba-loops-cond-template.xlsm" target="_blank">Excel</a>
</span>
</div> 

---

## Loops

.midi[
Loops are used to repeat pieces of code. We will consider
- For loops (repeat a number of times):
      ```
      For i = 1 To 10 
          <code>
      Next
      ```
- While loops (repeat until a condition is met - two versions):

.pull-left[
      ```
      While {condition true}    
          <code>
      Wend
      ```
]
.pull-right[
      ```
      Do While {condition true}    
          <code>
      Loop
      ```
]
- Other loops exists but in general you can always use for or while loops instead.
- Use `Exit for` and `Exit Do` to break a `For` and a `Do While` loop before it ends (jump to the code after the for loop).

Let us try to make some loops using the module `A_Loops` in the [Excel file](https://github.com/bss-osca/tfa/blob/master/vba/vba-loops-cond-template.xlsm).
]

---

## Beware of endless loops

.pull-left[
If the stopping criteria is NOT reached when using a while loop, the computer will keep going ... 

- Always “save” before “run”
- Make sure the stopping criterion will be reached.
- On Windows you may try to stop the program using Ctrl + Break or Ctrl + Alt + Delete.
- On a mac you may try ⌘ + ., ⌃ +  Esc or  ⌘⌥ + Esc.
]

.pull-right[
```{r, echo = FALSE, out.width="80%"} 
knitr::include_graphics("./img/loop.png") 
```
]

---

## Nested loops

Loops may be nested inside each other. For instance if some action needs to be performed for each day and each employee or for each project and each work package of that project.
```
Sub NestedLoops()
    Dim i As Integer, j As Integer
    For i = 1 To 2      ' days
        For j = 1 To 3  ' employees 
            MsgBox ("(" & i & "," & j & ")")
        Next
    Next
End Sub
```

---

## Conditional statements (decisions)

Conditional statements are used to make decisions based on the conditions. If the condition is met then the code is executed. 

An if then statement:

  ```
  If k <= 10 Then
    <code>
  ElseIf k <= 13 Then
    <code>
  Else
    <code>
  End If
  ```

You can drop the `ElseIf` and `Else` code chunks. Other conditional statements exists but in general you can formulate them using an if then statement.

Let us try to make some statements using the module `B_IfThen` in the [Excel file](https://github.com/bss-osca/tfa/blob/master/vba/vba-loops-cond-template.xlsm).

---

## Examples

- Have a look at the module `C_SearchPerson` in the [Excel file](https://github.com/bss-osca/tfa/blob/master/vba/vba-loops-cond-template.xlsm) which gives examples on how to search for a person in sheet _Separate1_.
- Have a look at the module `D_DistanceMatrix` in the [Excel file](https://github.com/bss-osca/tfa/blob/master/vba/vba-loops-cond-template.xlsm) which gives examples on how calculate a distance matrix (sheet _DistanceMatrix_).

  
```{r copy to docs, include=FALSE}
file.copy(list.files(pattern = ".html"), "../docs/slides/", overwrite = T)
file.copy("./slides.css", "./libs/", overwrite = T)
file.copy("libs", "../docs/slides/", recursive = T)
file.copy("img", "../docs/slides/", recursive = T)
system2("Rscript", args = "-e 'rmarkdown::render(\"index.Rmd\", quiet = TRUE)'")
```