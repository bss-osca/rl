<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 7 Temporal difference methods for prediction | Reinforcement Learning for Business (RL)</title>
  <meta name="description" content="Course notes for ‘Reinforcement Learning for Business’" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 7 Temporal difference methods for prediction | Reinforcement Learning for Business (RL)" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bss-osca.github.io/rl//img/logo.png" />
  <meta property="og:description" content="Course notes for ‘Reinforcement Learning for Business’" />
  <meta name="github-repo" content="bss-osca/rl" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 7 Temporal difference methods for prediction | Reinforcement Learning for Business (RL)" />
  
  <meta name="twitter:description" content="Course notes for ‘Reinforcement Learning for Business’" />
  <meta name="twitter:image" content="https://bss-osca.github.io/rl//img/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2022-10-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="mod-mc.html"/>
<link rel="next" href="mod-td-control.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<html>
<head>

<script id="code-folding-options" type="application/json">
  {"initial-state": "hide"}
</script>
   
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});

// code folding
document.addEventListener("DOMContentLoaded", function() {
  const languages = ['r', 'python', 'bash', 'sql', 'cpp', 'stan', 'julia', 'foldable'];
  const options = JSON.parse(document.getElementById("code-folding-options").text);
  const show = options["initial-state"] !== "hide";
  Array.from(document.querySelectorAll("pre.sourceCode")).map(function(pre) {
    const classList = pre.classList;
    if (languages.some(x => classList.contains(x))) {
      const div = pre.parentElement;
      const state = show || classList.contains("fold-show") && !classList.contains("fold-hide") ? " open" : "";
      div.outerHTML = `<details${state}><summary></summary>${div.outerHTML}</details>`;
    }
  });
});
</script>

<script src="https://hypothes.is/embed.js" async></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About the course notes</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-outcomes"><i class="fa fa-check"></i>Learning outcomes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#purpose-of-the-course"><i class="fa fa-check"></i>Purpose of the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-goals-of-the-course"><i class="fa fa-check"></i>Learning goals of the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reinforcement-learning-textbook"><i class="fa fa-check"></i>Reinforcement learning textbook</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-organization"><i class="fa fa-check"></i>Course organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#programming-software"><i class="fa fa-check"></i>Programming software</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i>Acknowledgements and license</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sec-intro-ex"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sec-intro-ex-annotate"><i class="fa fa-check"></i>Exercise - How to annotate</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sec-intro-ex-templates"><i class="fa fa-check"></i>Exercise - Templates</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Introduction to RL</b></span></li>
<li class="chapter" data-level="1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html"><i class="fa fa-check"></i><b>1</b> An introduction to RL</a>
<ul>
<li class="chapter" data-level="1.1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#mod-rl-intro-lo"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#textbook-readings"><i class="fa fa-check"></i><b>1.2</b> Textbook readings</a></li>
<li class="chapter" data-level="1.3" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#what-is-reinforcement-learning"><i class="fa fa-check"></i><b>1.3</b> What is reinforcement learning</a></li>
<li class="chapter" data-level="1.4" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-and-business-analytics"><i class="fa fa-check"></i><b>1.4</b> RL and Business Analytics</a></li>
<li class="chapter" data-level="1.5" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-in-different-research-deciplines"><i class="fa fa-check"></i><b>1.5</b> RL in different research deciplines</a></li>
<li class="chapter" data-level="1.6" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-and-machine-learning"><i class="fa fa-check"></i><b>1.6</b> RL and machine learning</a></li>
<li class="chapter" data-level="1.7" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#the-rl-data-stream"><i class="fa fa-check"></i><b>1.7</b> The RL data-stream</a></li>
<li class="chapter" data-level="1.8" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#states-actions-rewards-and-policies"><i class="fa fa-check"></i><b>1.8</b> States, actions, rewards and policies</a></li>
<li class="chapter" data-level="1.9" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#exploitation-vs-exploration"><i class="fa fa-check"></i><b>1.9</b> Exploitation vs Exploration</a></li>
<li class="chapter" data-level="1.10" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-in-action-tic-tac-toe"><i class="fa fa-check"></i><b>1.10</b> RL in action (Tic-Tac-Toe)</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#players-and-learning-to-play"><i class="fa fa-check"></i><b>1.10.1</b> Players and learning to play</a></li>
<li class="chapter" data-level="1.10.2" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#gameplay"><i class="fa fa-check"></i><b>1.10.2</b> Gameplay</a></li>
<li class="chapter" data-level="1.10.3" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#rl-intro-tic-learn"><i class="fa fa-check"></i><b>1.10.3</b> Learning by a sequence of games</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#summary"><i class="fa fa-check"></i><b>1.11</b> Summary</a></li>
<li class="chapter" data-level="1.12" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#sec-rl-intro-ex"><i class="fa fa-check"></i><b>1.12</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.12.1" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-self"><i class="fa fa-check"></i><b>1.12.1</b> Exercise - Self-Play</a></li>
<li class="chapter" data-level="1.12.2" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-sym"><i class="fa fa-check"></i><b>1.12.2</b> Exercise - Symmetries</a></li>
<li class="chapter" data-level="1.12.3" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-greedy"><i class="fa fa-check"></i><b>1.12.3</b> Exercise - Greedy Play</a></li>
<li class="chapter" data-level="1.12.4" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-exploit"><i class="fa fa-check"></i><b>1.12.4</b> Exercise - Learning from Exploration</a></li>
<li class="chapter" data-level="1.12.5" data-path="mod-rl-intro.html"><a href="mod-rl-intro.html#ex-r-intro-other"><i class="fa fa-check"></i><b>1.12.5</b> Exercise - Other Improvements</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Tabular methods</b></span></li>
<li class="chapter" data-level="2" data-path="mod-bandit.html"><a href="mod-bandit.html"><i class="fa fa-check"></i><b>2</b> Multi-armed bandits</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mod-bandit.html"><a href="mod-bandit.html#learning-outcomes-1"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="mod-bandit.html"><a href="mod-bandit.html#textbook-readings-1"><i class="fa fa-check"></i><b>2.2</b> Textbook readings</a></li>
<li class="chapter" data-level="2.3" data-path="mod-bandit.html"><a href="mod-bandit.html#the-k-armed-bandit-problem"><i class="fa fa-check"></i><b>2.3</b> The k-armed bandit problem</a></li>
<li class="chapter" data-level="2.4" data-path="mod-bandit.html"><a href="mod-bandit.html#estimating-the-value-of-an-action"><i class="fa fa-check"></i><b>2.4</b> Estimating the value of an action</a></li>
<li class="chapter" data-level="2.5" data-path="mod-bandit.html"><a href="mod-bandit.html#sec-bandit-step-size"><i class="fa fa-check"></i><b>2.5</b> The role of the step-size</a></li>
<li class="chapter" data-level="2.6" data-path="mod-bandit.html"><a href="mod-bandit.html#optimistic-initial-values"><i class="fa fa-check"></i><b>2.6</b> Optimistic initial values</a></li>
<li class="chapter" data-level="2.7" data-path="mod-bandit.html"><a href="mod-bandit.html#upper-confidence-bound-action-selection"><i class="fa fa-check"></i><b>2.7</b> Upper-Confidence Bound Action Selection</a></li>
<li class="chapter" data-level="2.8" data-path="mod-bandit.html"><a href="mod-bandit.html#summary-1"><i class="fa fa-check"></i><b>2.8</b> Summary</a></li>
<li class="chapter" data-level="2.9" data-path="mod-bandit.html"><a href="mod-bandit.html#sec-bandit-ex"><i class="fa fa-check"></i><b>2.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="mod-bandit.html"><a href="mod-bandit.html#ex-bandit-adv"><i class="fa fa-check"></i><b>2.9.1</b> Exercise - Advertising</a></li>
<li class="chapter" data-level="2.9.2" data-path="mod-bandit.html"><a href="mod-bandit.html#ex-bandit-coin"><i class="fa fa-check"></i><b>2.9.2</b> Exercise - A coin game</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html"><i class="fa fa-check"></i><b>3</b> Markov decision processes (MDPs)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#learning-outcomes-2"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#textbook-readings-2"><i class="fa fa-check"></i><b>3.2</b> Textbook readings</a></li>
<li class="chapter" data-level="3.3" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#an-mdp-as-a-model-for-the-agent-environment"><i class="fa fa-check"></i><b>3.3</b> An MDP as a model for the agent-environment</a></li>
<li class="chapter" data-level="3.4" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#rewards-and-the-objective-function-goal"><i class="fa fa-check"></i><b>3.4</b> Rewards and the objective function (goal)</a></li>
<li class="chapter" data-level="3.5" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#summary-2"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
<li class="chapter" data-level="3.6" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#sec-mdp-1-ex"><i class="fa fa-check"></i><b>3.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-seq"><i class="fa fa-check"></i><b>3.6.1</b> Exercise - Sequential decision problems</a></li>
<li class="chapter" data-level="3.6.2" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-exp-return"><i class="fa fa-check"></i><b>3.6.2</b> Exercise - Expected return</a></li>
<li class="chapter" data-level="3.6.3" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-gambler"><i class="fa fa-check"></i><b>3.6.3</b> Exercise - Gambler’s problem</a></li>
<li class="chapter" data-level="3.6.4" data-path="mod-mdp-1.html"><a href="mod-mdp-1.html#ex-mdp-1-storage"><i class="fa fa-check"></i><b>3.6.4</b> Exercise - Factory storage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html"><i class="fa fa-check"></i><b>4</b> Policies and value functions for MDPs</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#learning-outcomes-3"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#textbook-readings-3"><i class="fa fa-check"></i><b>4.2</b> Textbook readings</a></li>
<li class="chapter" data-level="4.3" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#policies-and-value-functions"><i class="fa fa-check"></i><b>4.3</b> Policies and value functions</a></li>
<li class="chapter" data-level="4.4" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#sec-mdp-opt"><i class="fa fa-check"></i><b>4.4</b> Optimal policies and value functions</a></li>
<li class="chapter" data-level="4.5" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#optimality-vs-approximation"><i class="fa fa-check"></i><b>4.5</b> Optimality vs approximation</a></li>
<li class="chapter" data-level="4.6" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#semi-mdps-non-fixed-time-length"><i class="fa fa-check"></i><b>4.6</b> Semi-MDPs (non-fixed time length)</a></li>
<li class="chapter" data-level="4.7" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#summary-3"><i class="fa fa-check"></i><b>4.7</b> Summary</a></li>
<li class="chapter" data-level="4.8" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#sec-mdp-2-ex"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#ex-mdp-2-policy"><i class="fa fa-check"></i><b>4.8.1</b> Exercise - Optimal policy</a></li>
<li class="chapter" data-level="4.8.2" data-path="mod-mdp-2.html"><a href="mod-mdp-2.html#ex-mdp-2-car"><i class="fa fa-check"></i><b>4.8.2</b> Exercise - Car rental</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-dp.html"><a href="mod-dp.html"><i class="fa fa-check"></i><b>5</b> Dynamic programming</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mod-dp.html"><a href="mod-dp.html#learning-outcomes-4"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="mod-dp.html"><a href="mod-dp.html#textbook-readings-4"><i class="fa fa-check"></i><b>5.2</b> Textbook readings</a></li>
<li class="chapter" data-level="5.3" data-path="mod-dp.html"><a href="mod-dp.html#sec-dp-pe"><i class="fa fa-check"></i><b>5.3</b> Policy evaluation</a></li>
<li class="chapter" data-level="5.4" data-path="mod-dp.html"><a href="mod-dp.html#policy-improvement"><i class="fa fa-check"></i><b>5.4</b> Policy Improvement</a></li>
<li class="chapter" data-level="5.5" data-path="mod-dp.html"><a href="mod-dp.html#policy-iteration"><i class="fa fa-check"></i><b>5.5</b> Policy Iteration</a></li>
<li class="chapter" data-level="5.6" data-path="mod-dp.html"><a href="mod-dp.html#value-iteration"><i class="fa fa-check"></i><b>5.6</b> Value Iteration</a></li>
<li class="chapter" data-level="5.7" data-path="mod-dp.html"><a href="mod-dp.html#generalized-policy-iteration"><i class="fa fa-check"></i><b>5.7</b> Generalized policy iteration</a></li>
<li class="chapter" data-level="5.8" data-path="mod-dp.html"><a href="mod-dp.html#example---factory-storage"><i class="fa fa-check"></i><b>5.8</b> Example - Factory Storage</a></li>
<li class="chapter" data-level="5.9" data-path="mod-dp.html"><a href="mod-dp.html#summary-4"><i class="fa fa-check"></i><b>5.9</b> Summary</a></li>
<li class="chapter" data-level="5.10" data-path="mod-dp.html"><a href="mod-dp.html#exercises"><i class="fa fa-check"></i><b>5.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="mod-dp.html"><a href="mod-dp.html#ex-dp-gambler"><i class="fa fa-check"></i><b>5.10.1</b> Exercise - Gambler’s problem</a></li>
<li class="chapter" data-level="5.10.2" data-path="mod-dp.html"><a href="mod-dp.html#ex-dp-maintain"><i class="fa fa-check"></i><b>5.10.2</b> Exercise - Maintenance problem</a></li>
<li class="chapter" data-level="5.10.3" data-path="mod-dp.html"><a href="mod-dp.html#ex-dp-rental"><i class="fa fa-check"></i><b>5.10.3</b> Exercise - Car rental</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-mc.html"><a href="mod-mc.html"><i class="fa fa-check"></i><b>6</b> Monte Carlo methods for prediction and control</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mod-mc.html"><a href="mod-mc.html#learning-outcomes-5"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="mod-mc.html"><a href="mod-mc.html#textbook-readings-5"><i class="fa fa-check"></i><b>6.2</b> Textbook readings</a></li>
<li class="chapter" data-level="6.3" data-path="mod-mc.html"><a href="mod-mc.html#mc-prediction-evaluation"><i class="fa fa-check"></i><b>6.3</b> MC prediction (evaluation)</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="mod-mc.html"><a href="mod-mc.html#mc-prediction-of-action-values"><i class="fa fa-check"></i><b>6.3.1</b> MC prediction of action-values</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mod-mc.html"><a href="mod-mc.html#mc-control-improvement"><i class="fa fa-check"></i><b>6.4</b> MC control (improvement)</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="mod-mc.html"><a href="mod-mc.html#gpi-with-exploring-starts"><i class="fa fa-check"></i><b>6.4.1</b> GPI with exploring starts</a></li>
<li class="chapter" data-level="6.4.2" data-path="mod-mc.html"><a href="mod-mc.html#gpi-using-epsilon-soft-policies"><i class="fa fa-check"></i><b>6.4.2</b> GPI using <span class="math inline">\(\epsilon\)</span>-soft policies</a></li>
<li class="chapter" data-level="6.4.3" data-path="mod-mc.html"><a href="mod-mc.html#gpi-using-upper-confience-bound-action-selection"><i class="fa fa-check"></i><b>6.4.3</b> GPI using upper-confience bound action selection</a></li>
<li class="chapter" data-level="6.4.4" data-path="mod-mc.html"><a href="mod-mc.html#mc-seasonal"><i class="fa fa-check"></i><b>6.4.4</b> Example - Seasonal inventory and sales planning</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mod-mc.html"><a href="mod-mc.html#sec-mc-off-policy"><i class="fa fa-check"></i><b>6.5</b> Off-policy MC prediction</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="mod-mc.html"><a href="mod-mc.html#weighted-importance-sampling"><i class="fa fa-check"></i><b>6.5.1</b> Weighted importance sampling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="mod-mc.html"><a href="mod-mc.html#off-policy-control-improvement"><i class="fa fa-check"></i><b>6.6</b> Off-policy control (improvement)</a></li>
<li class="chapter" data-level="6.7" data-path="mod-mc.html"><a href="mod-mc.html#summary-5"><i class="fa fa-check"></i><b>6.7</b> Summary</a></li>
<li class="chapter" data-level="6.8" data-path="mod-mc.html"><a href="mod-mc.html#exercises-1"><i class="fa fa-check"></i><b>6.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="mod-mc.html"><a href="mod-mc.html#ex-mc-seasonal"><i class="fa fa-check"></i><b>6.8.1</b> Exercise - Seasonal inventory and sales planning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mod-td-pred.html"><a href="mod-td-pred.html"><i class="fa fa-check"></i><b>7</b> Temporal difference methods for prediction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mod-td-pred.html"><a href="mod-td-pred.html#learning-outcomes-6"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="7.2" data-path="mod-td-pred.html"><a href="mod-td-pred.html#textbook-readings-6"><i class="fa fa-check"></i><b>7.2</b> Textbook readings</a></li>
<li class="chapter" data-level="7.3" data-path="mod-td-pred.html"><a href="mod-td-pred.html#what-is-td-learning"><i class="fa fa-check"></i><b>7.3</b> What is TD learning?</a></li>
<li class="chapter" data-level="7.4" data-path="mod-td-pred.html"><a href="mod-td-pred.html#td-prediction"><i class="fa fa-check"></i><b>7.4</b> TD prediction</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mod-td-pred.html"><a href="mod-td-pred.html#td-prediction-for-action-values"><i class="fa fa-check"></i><b>7.4.1</b> TD prediction for action-values</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mod-td-pred.html"><a href="mod-td-pred.html#benefits-of-td-methods"><i class="fa fa-check"></i><b>7.5</b> Benefits of TD methods</a></li>
<li class="chapter" data-level="7.6" data-path="mod-td-pred.html"><a href="mod-td-pred.html#exercises-2"><i class="fa fa-check"></i><b>7.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="mod-td-pred.html"><a href="mod-td-pred.html#ex-td-pred-random"><i class="fa fa-check"></i><b>7.6.1</b> Exercise - A randow walk</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-td-control.html"><a href="mod-td-control.html"><i class="fa fa-check"></i><b>8</b> Temporal difference methods for control</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-td-control.html"><a href="mod-td-control.html#learning-outcomes-7"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="8.2" data-path="mod-td-control.html"><a href="mod-td-control.html#textbook-readings-7"><i class="fa fa-check"></i><b>8.2</b> Textbook readings</a></li>
<li class="chapter" data-level="8.3" data-path="mod-td-control.html"><a href="mod-td-control.html#sarsa---on-policy-gpi-using-td"><i class="fa fa-check"></i><b>8.3</b> SARSA - On-policy GPI using TD</a></li>
<li class="chapter" data-level="8.4" data-path="mod-td-control.html"><a href="mod-td-control.html#q-learning---off-policy-gpi-using-td"><i class="fa fa-check"></i><b>8.4</b> Q-learning - Off-policy GPI using TD</a></li>
<li class="chapter" data-level="8.5" data-path="mod-td-control.html"><a href="mod-td-control.html#expected-sarsa---gpi-using-td"><i class="fa fa-check"></i><b>8.5</b> Expected SARSA - GPI using TD</a></li>
<li class="chapter" data-level="8.6" data-path="mod-td-control.html"><a href="mod-td-control.html#summary-6"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
<li class="chapter" data-level="8.7" data-path="mod-td-control.html"><a href="mod-td-control.html#exercises-3"><i class="fa fa-check"></i><b>8.7</b> Exercises</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="mod-r-setup.html"><a href="mod-r-setup.html"><i class="fa fa-check"></i><b>A</b> Setting up R</a></li>
<li class="chapter" data-level="B" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>B</b> Working in groups</a></li>
<li class="chapter" data-level="C" data-path="coding-convention.html"><a href="coding-convention.html"><i class="fa fa-check"></i><b>C</b> Coding/naming convention</a>
<ul>
<li class="chapter" data-level="C.1" data-path="coding-convention.html"><a href="coding-convention.html#commenting-your-code"><i class="fa fa-check"></i><b>C.1</b> Commenting your code</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>D</b> Annotate the course notes</a></li>
<li class="chapter" data-level="E" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>E</b> Getting help</a></li>
<li class="chapter" data-level="F" data-path="mod-lg-course.html"><a href="mod-lg-course.html"><i class="fa fa-check"></i><b>F</b> Learning goals</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reinforcement Learning for Business (RL)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-td-pred" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Module 7</span> Temporal difference methods for prediction<a href="mod-td-pred.html#mod-td-pred" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>One of the most fundamental concepts in reinforcement learning is temporal difference (TD) learning. TD learning is a combination of Monte Carlo (MC) and dynamic programming (DP) ideas: Like MC, TD can predict using a model-free environment and learn from experience. Like DP, TD update estimates based on other learned estimates, without waiting for a final outcome (bootstrap). That is, TD can learn on-line and do not need to wait until the whole sample-path is found. TD is in general learn more efficiently than MC due to bootstrapping. In this module prediction using TD is considered.</p>
<div id="learning-outcomes-6" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Learning outcomes<a href="mod-td-pred.html#learning-outcomes-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By the end of this module, you are expected to:</p>
<ul>
<li>Describe what Temporal Difference (TD) learning is.</li>
<li>Formulate the incremental update formula for TD learning.</li>
<li>Define the temporal-difference error.</li>
<li>Interpret the role of a fixed step-size.</li>
<li>Identify key advantages of TD methods over DP and MC methods.</li>
<li>Explain the TD(0) prediction algorithm.</li>
<li>Understand the benefits of learning online with TD compared to MC methods.</li>
</ul>
<p>The learning outcomes relate to the <a href="mod-lg-course.html#mod-lg-course">overall learning goals</a> number 3, 4, 6, 9, and 12 of the course.</p>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="textbook-readings-6" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Textbook readings<a href="mod-td-pred.html#textbook-readings-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For this week, you will need to read Chapter 6-6.3 in <span class="citation">Sutton and Barto (<a href="#ref-Sutton18" role="doc-biblioref">2018</a>)</span>. Read it before continuing this module. A summary of the book notation can be seen <a href="https://bss-osca.github.io/rl/sutton-notation.pdf">here</a>.</p>
<div>
Slides for this module can be seen
<a href="https://bss-osca.github.io/rl/slides/07_td-pred-slides.html" target="_blank">here.</a>
You do not have to look at them before the lecture!
</div>
</div>
<div id="what-is-td-learning" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> What is TD learning?<a href="mod-td-pred.html#what-is-td-learning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Given a policy <span class="math inline">\(\pi\)</span>, we want to estimate the state-value function. Recall that the state value function is
<span class="math display">\[
v_\pi(s) = \mathbb{E}_\pi[G_t | S_t = s].
\]</span>
where the return is
<span class="math display">\[
G_t = R_{t+1} + \gamma R_{t+2} + \gamma^2 R_{t+3} + \cdots = \sum_{k=0}^{\infty} \gamma^k R_{t+k+1} = R_{t+1} + \gamma G_{t+1}
\]</span></p>
<p>Let <span class="math inline">\(V\)</span> denote the state-value estimate. Under MC prediction we used an incremental update formula:
<span class="math display">\[
  V(S_t) \leftarrow V(S_t) + \alpha_n\left[G_t - V(S_t)\right],
\]</span>
where <span class="math inline">\(n\)</span> denote the number of observations and <span class="math inline">\(\alpha_n\)</span> the step-size. Different values of <span class="math inline">\(\alpha_n\)</span> was discussed in Module <a href="mod-mc.html#mod-mc">6</a>. Here we assumed a stationary environment (state set, transition probabilities etc. is the same for each stage <span class="math inline">\(t\)</span>) e.g. for the sample average <span class="math inline">\(\alpha_n = 1/n\)</span>. If the environment is non-stationary (e.g. transition probabilities change over time) then a fixed step-size may be appropriate. Let us for the remaining of this module consider a non-stationary process with fixed step-size:
<span class="math display">\[
  V(S_t) \leftarrow V(S_t) + \alpha\left[G_t - V(S_t)\right],
\]</span></p>
<p>Note as pointed out in Section <a href="mod-bandit.html#sec-bandit-step-size">2.5</a>, a fixed step-size corresponds to a weighted average of the past observed returns and the initial estimate of <span class="math inline">\(S_t\)</span>:
<span class="math display">\[
\begin{align}
V_{n+1} &amp;= V_n +\alpha \left[G_n - V_n\right] \nonumber \\
&amp;= \alpha G_n + (1 - \alpha)V_n \nonumber \\
&amp;= \alpha G_n + (1 - \alpha)[\alpha G_{n-1} + (1 - \alpha)V_{n-1}] \nonumber \\
&amp;= \alpha G_n + (1 - \alpha)\alpha G_{n-1} + (1 - \alpha)^2 V_{n-1}  \nonumber \\
&amp; \vdots \nonumber \\
&amp;= (1-\alpha)^n V_1 + \sum_{i=1}^{n} \alpha (1 - \alpha)^{n-i} G_i \\
\end{align}
\]</span>
That is, a larger weight is used for recent observations compared to old observations.</p>
<p>For MC prediction we needed the sample path to get the realized return <span class="math inline">\(G_t\)</span>. However, since
<span class="math display">\[
\begin{align}
v_\pi(s) &amp;= \mathbb{E}_\pi[G_t | S_t = s] \\
         &amp;= \mathbb{E}_\pi[R_{t+1} + \gamma G_{t+1} | S_t = s] \\
         &amp;= \mathbb{E}_\pi[R_{t+1}| S_t = s] + \gamma \mathbb{E}_\pi[G_{t+1} | S_t = s] \\
         &amp;= \mathbb{E}_\pi[R_{t+1}| S_t = s] + \gamma v_\pi(S_{t+1}),
\end{align}
\]</span>
then, given a realized reward <span class="math inline">\(R_{t+1}\)</span>, an estimate for the return <span class="math inline">\(G_t\)</span> is <span class="math inline">\(R_{t+1} + \gamma V(S_{t+1})\)</span> and the incremental update becomes:
<span class="math display" id="eq:td0">\[
  V(S_t) \leftarrow V(S_t) + \alpha\left[R_{t+1} + \gamma V(S_{t+1}) - V(S_t)\right].
  \tag{7.1}
\]</span>
As a result, we do not have to generate a whole sample-path (as for MC) for updating the state-value estimate of <span class="math inline">\(s = S_t\)</span> to <span class="math inline">\(V(S_t)\)</span>. Instead we only have to wait until the next state is observed and update the estimate of <span class="math inline">\(S_t\)</span> given the estimate of the next state <span class="math inline">\(S_{t+1}\)</span>. As the estimate of <span class="math inline">\(S_{t+1}\)</span> improve the estimate of <span class="math inline">\(S_t\)</span> also improve. The incremental update in Eq. <a href="mod-td-pred.html#eq:td0">(7.1)</a> is called <em>TD(0)</em> or one-step TD because it use a one-step lookahead to update the estimate. Note updating the estimates using TD resembles the way we did for DP:
<span class="math display">\[
V(s = S_t) \leftarrow \sum_{a \in \mathcal{A}}\pi(a | s)\left( r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) V(s&#39;)\right) 
\]</span>
Here we updated the value by considering the expectation of all the next states. This was possible since we had a model. Now, by using TD, we do not need a model to estimate the state-value.</p>
<p>The term
<span class="math display">\[
\delta_t = R_{t+1} + \gamma V(S_{t+1}) - V(S_t),
\]</span>
is denoted the <em>temporal difference error</em> (<em>TD error</em>) since it is the difference between the current estimate <span class="math inline">\(V(S_t)\)</span> and the better estimate <span class="math inline">\(R_{t+1} + \gamma V(S_{t+1})\)</span>.</p>
</div>
<div id="td-prediction" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> TD prediction<a href="mod-td-pred.html#td-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can now formulate a TD(0) algorithm for predicting state-values of a policy (see Figure <a href="mod-td-pred.html#fig:td0-pred-alg">7.1</a>). No stopping criterion is given but could stop when small differences in state-values are observed.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:td0-pred-alg"></span>
<img src="img/td0-pred.png" alt="TD(0) policy prediction [@Sutton18]."  />
<p class="caption">
Figure 7.1: TD(0) policy prediction <span class="citation">(<a href="#ref-Sutton18" role="doc-biblioref">Sutton and Barto 2018</a>)</span>.
</p>
</div>
<p>The algorithm is given for a process with episodes; however, also works for continuing processes. In this case the inner loop runs over an infinite number of time-steps.</p>
<div id="td-prediction-for-action-values" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> TD prediction for action-values<a href="mod-td-pred.html#td-prediction-for-action-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Later we will use TD to for improving the policy (control). Since we do not have a model we need to estimate action-values instead and the optimal policy can be found using <span class="math inline">\(q_*\)</span> (see Eq. <a href="mod-mdp-2.html#eq:bell-opt-state-policy">(4.3)</a>). To find <span class="math inline">\(q_*\)</span>, we first need to predict action-values for a policy <span class="math inline">\(\pi\)</span> and the incremental update Eq. <a href="mod-td-pred.html#eq:td0">(7.1)</a> must be modified to use <span class="math inline">\(Q\)</span> values:
<span class="math display">\[
  Q(S_t, A_t) \leftarrow Q(S_t, A_t) + \alpha\left[R_{t+1} + \gamma Q(S_{t+1}, A_t) - Q(S_t, A_t)\right].
\]</span></p>
<p>Note given a policy <span class="math inline">\(\pi\)</span> you need to know <span class="math inline">\(S_t, A_t, R_{t+1}, S_{t+1}, A_{t+1}\)</span> or short SARSA before you can make an update. This acronym is used to name the SARSA algorithm for control in Module <a href="mod-td-control.html#mod-td-control">8</a>. Note to ensure exploration of all action-values we need e.g. an <span class="math inline">\(\epsilon\)</span>-soft behavioural policy.</p>
</div>
</div>
<div id="benefits-of-td-methods" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Benefits of TD methods<a href="mod-td-pred.html#benefits-of-td-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let us try to summarize the benefits of TD prediction</p>
<ul>
<li>TD methods do not require a model of the environment (compared to DP).</li>
<li>TD methods can be implemented online, which can speed convergence (compared to MC methods which must wait until the end of the sample-path).</li>
<li>TD methods learn from all actions, whereas MC methods require the sample-path to have a tail equal to the target policy.</li>
<li>TD methods do converge on the value function with a sufficiently small step-size parameter, or with a decreasing step-size.</li>
<li>TD methods generally converge faster than MC methods, although this has not been formally proven.</li>
<li>TD methods are extremely useful for continuing tasks that cannot be broken down into episodes as required by MC methods.</li>
<li>TD can be seen as a method for <em>prediction learning</em> where you try to predict what happens next given you current action, get new information and make a new prediction. That is, you do not need a training set (as in supervised learning) instead the reward signal is observed as time goes by.</li>
<li>TD methods are good for sequential decision problems (multi-step prediction).</li>
<li>TD methods are scalable in the sense that computations do not grow exponentially with the problem size.</li>
</ul>
<p>An example illustrating that TD methods converge faster than MC methods is given in Exercise <a href="mod-td-pred.html#ex-td-pred-random">7.6.1</a></p>
<!-- ## Summary  -->
<!-- Read Chapter 5.10 in @Sutton18. -->
</div>
<div id="exercises-2" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Exercises<a href="mod-td-pred.html#exercises-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the <a href="help.html#help">help page</a>. Sometimes solutions can be seen by pressing the button besides a question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!</p>
<div id="ex-td-pred-random" class="section level3 hasAnchor" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Exercise - A randow walk<a href="mod-td-pred.html#ex-td-pred-random" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a MDP with states 2-6 and two terminal states 1 and 7. Possible transitions are given in Figure <a href="mod-td-pred.html#fig:rw-trans">7.2</a>. All episodes start in the centre state, 4, then proceed either left or right by one state on each step. We assume the stochastic policy <span class="math inline">\(\pi\)</span> is used where each direction has equal probability. Episodes terminate either on the left (1) or the right (7). When an episode terminates on the right, reward of 1 occurs; all other rewards are zero. If the discount factor equals 1, the state-value of each state is the probability of terminating on the right if starting from that state.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:rw-trans"></span>
<img src="07_td-pred_files/figure-html/rw-trans-1.png" alt="Possible transitions between states and rewards." width="80%" />
<p class="caption">
Figure 7.2: Possible transitions between states and rewards.
</p>
</div>
<!-- Q1 -->
<div id="zhpGOqiB0yL3APFBMGZh" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="zhpGOqiB0yL3APFBMGZh-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="zhpGOqiB0yL3APFBMGZh-title">
Solution
</h4>
</div>
<div class="modal-body">
<p>
The state space is <span class="math inline">\(\mathcal{S} = \{ T1, A, \ldots, E, T2 \}\)</span> with <span class="math inline">\(\mathcal{A}(s) = \{ \text{left}, \text{right}\}\)</span> (transition to the neighbour states) except for terminating states which have no actions (see Figure <a href="mod-td-pred.html#fig:rw-trans">7.2</a>). Rewards are deterministic <span class="math inline">\(\mathcal{R} = \{0, 1\}\)</span> (see Figure <a href="mod-td-pred.html#fig:rw-trans">7.2</a>) which also holds for the transition probabilities. The state-value can be found using the Bellman equations <a href="mod-dp.html#eq:bm-pol-eval">(5.1)</a> <span class="math display">\[v_\pi(s) = \sum_{a \in \mathcal{A}}\pi(a | s)\left( r(s,a) + \gamma\sum_{s&#39; \in \mathcal{S}} p(s&#39; | s, a) v_\pi(s&#39;)\right),\]</span> which becomes <span class="math display">\[\begin{align}v_\pi(A) &amp;= 0.5v_\pi(T1) + 0.5v_\pi(B) = 0.5v_\pi(B) \\ v_\pi(B) &amp;= 0.5v_\pi(A) + 0.5v_\pi( C ) \\ v_\pi( C ) &amp;= 0.5v_\pi(B) + 0.5v_\pi(D) \\ v_\pi(D) &amp;= 0.5v_\pi( C ) + 0.5v_\pi(E) \\ v_\pi(E) &amp;= 0.5v_\pi(D) + 0.5(1 + v_\pi(T2)) = 0.5v_\pi(D) + 0.5\\ \end{align}\]</span> Solving the equations with a state-value equal to 0 (you may also use that by symmetry <span class="math inline">\(v_\pi(C ) = 0.5\)</span>) for the terminating states gives state-values <span class="math inline">\(\frac{1}{6}, \frac{2}{6}, \frac{3}{6}, \frac{4}{6}\)</span> and <span class="math inline">\(\frac{5}{6}\)</span> for A-E, respectively.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#zhpGOqiB0yL3APFBMGZh">
Solution
</button>
<ol style="list-style-type: decimal">
<li>Formulate the MDP model and calculate the state-value <span class="math inline">\(v_\pi\)</span> for each state using the Bellman equations <a href="mod-dp.html#eq:bm-pol-eval">(5.1)</a>. Hint: there is no need to code this. Just solve the Bellman equations for state A-E.</li>
</ol>
<!-- Q2 -->
<ol start="2" style="list-style-type: decimal">
<li>Consider the code below which build, set the policy and evaluate it. Try to understand what happens and check if the results are the same as found in Question 1.</li>
</ol>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="mod-td-pred.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Build the MDP</span></span>
<span id="cb71-2"><a href="mod-td-pred.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use numbers instead 1 = T1, 2-6 = A-E, 7 = T2</span></span>
<span id="cb71-3"><a href="mod-td-pred.html#cb71-3" aria-hidden="true" tabindex="-1"></a>mdp <span class="ot">&lt;-</span> MDPClass<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb71-4"><a href="mod-td-pred.html#cb71-4" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb71-5"><a href="mod-td-pred.html#cb71-5" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addStateSpace</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)   <span class="co"># add state keys</span></span>
<span id="cb71-6"><a href="mod-td-pred.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb71-7"><a href="mod-td-pred.html#cb71-7" aria-hidden="true" tabindex="-1"></a>      mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(s, <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;right&quot;</span>))</span>
<span id="cb71-8"><a href="mod-td-pred.html#cb71-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-9"><a href="mod-td-pred.html#cb71-9" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(<span class="st">&quot;1&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;dummy&quot;</span>))</span>
<span id="cb71-10"><a href="mod-td-pred.html#cb71-10" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addActionSpace</span>(<span class="st">&quot;7&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;dummy&quot;</span>))</span>
<span id="cb71-11"><a href="mod-td-pred.html#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add trans pr and rewards</span></span>
<span id="cb71-12"><a href="mod-td-pred.html#cb71-12" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-13"><a href="mod-td-pred.html#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb71-14"><a href="mod-td-pred.html#cb71-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(pr) <span class="ot">=</span> s<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb71-15"><a href="mod-td-pred.html#cb71-15" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="fu">as.character</span>(s), <span class="st">&quot;right&quot;</span>, <span class="at">r =</span> <span class="dv">0</span>, pr)</span>
<span id="cb71-16"><a href="mod-td-pred.html#cb71-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-17"><a href="mod-td-pred.html#cb71-17" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="st">&quot;6&quot;</span>, <span class="st">&quot;right&quot;</span>, <span class="at">r =</span> <span class="dv">1</span>, <span class="at">pr =</span> <span class="fu">c</span>(<span class="st">&quot;7&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb71-18"><a href="mod-td-pred.html#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb71-19"><a href="mod-td-pred.html#cb71-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(pr) <span class="ot">=</span> s<span class="dv">-1</span> </span>
<span id="cb71-20"><a href="mod-td-pred.html#cb71-20" aria-hidden="true" tabindex="-1"></a>   mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="fu">as.character</span>(s), <span class="st">&quot;left&quot;</span>, <span class="at">r =</span> <span class="dv">0</span>, pr)</span>
<span id="cb71-21"><a href="mod-td-pred.html#cb71-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-22"><a href="mod-td-pred.html#cb71-22" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;dummy&quot;</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">pr =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb71-23"><a href="mod-td-pred.html#cb71-23" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">addAction</span>(<span class="st">&quot;7&quot;</span>, <span class="st">&quot;dummy&quot;</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">pr =</span> <span class="fu">c</span>(<span class="st">&quot;7&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb71-24"><a href="mod-td-pred.html#cb71-24" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;1&quot;</span>)</span>
<span id="cb71-25"><a href="mod-td-pred.html#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dummy</span></span>
<span id="cb71-26"><a href="mod-td-pred.html#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dummy$r</span></span>
<span id="cb71-27"><a href="mod-td-pred.html#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb71-28"><a href="mod-td-pred.html#cb71-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-29"><a href="mod-td-pred.html#cb71-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dummy$pr</span></span>
<span id="cb71-30"><a href="mod-td-pred.html#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb71-31"><a href="mod-td-pred.html#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span>
<span id="cb71-32"><a href="mod-td-pred.html#cb71-32" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;2&quot;</span>)</span>
<span id="cb71-33"><a href="mod-td-pred.html#cb71-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $right</span></span>
<span id="cb71-34"><a href="mod-td-pred.html#cb71-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $right$r</span></span>
<span id="cb71-35"><a href="mod-td-pred.html#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb71-36"><a href="mod-td-pred.html#cb71-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-37"><a href="mod-td-pred.html#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $right$pr</span></span>
<span id="cb71-38"><a href="mod-td-pred.html#cb71-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 </span></span>
<span id="cb71-39"><a href="mod-td-pred.html#cb71-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb71-40"><a href="mod-td-pred.html#cb71-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-41"><a href="mod-td-pred.html#cb71-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-42"><a href="mod-td-pred.html#cb71-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $left</span></span>
<span id="cb71-43"><a href="mod-td-pred.html#cb71-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $left$r</span></span>
<span id="cb71-44"><a href="mod-td-pred.html#cb71-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb71-45"><a href="mod-td-pred.html#cb71-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-46"><a href="mod-td-pred.html#cb71-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $left$pr</span></span>
<span id="cb71-47"><a href="mod-td-pred.html#cb71-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb71-48"><a href="mod-td-pred.html#cb71-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span>
<span id="cb71-49"><a href="mod-td-pred.html#cb71-49" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;6&quot;</span>)</span>
<span id="cb71-50"><a href="mod-td-pred.html#cb71-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $right</span></span>
<span id="cb71-51"><a href="mod-td-pred.html#cb71-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $right$r</span></span>
<span id="cb71-52"><a href="mod-td-pred.html#cb71-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb71-53"><a href="mod-td-pred.html#cb71-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-54"><a href="mod-td-pred.html#cb71-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $right$pr</span></span>
<span id="cb71-55"><a href="mod-td-pred.html#cb71-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 </span></span>
<span id="cb71-56"><a href="mod-td-pred.html#cb71-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb71-57"><a href="mod-td-pred.html#cb71-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-58"><a href="mod-td-pred.html#cb71-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-59"><a href="mod-td-pred.html#cb71-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $left</span></span>
<span id="cb71-60"><a href="mod-td-pred.html#cb71-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $left$r</span></span>
<span id="cb71-61"><a href="mod-td-pred.html#cb71-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb71-62"><a href="mod-td-pred.html#cb71-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-63"><a href="mod-td-pred.html#cb71-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $left$pr</span></span>
<span id="cb71-64"><a href="mod-td-pred.html#cb71-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 </span></span>
<span id="cb71-65"><a href="mod-td-pred.html#cb71-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span>
<span id="cb71-66"><a href="mod-td-pred.html#cb71-66" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getActionInfo</span>(<span class="st">&quot;7&quot;</span>)</span>
<span id="cb71-67"><a href="mod-td-pred.html#cb71-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dummy</span></span>
<span id="cb71-68"><a href="mod-td-pred.html#cb71-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dummy$r</span></span>
<span id="cb71-69"><a href="mod-td-pred.html#cb71-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb71-70"><a href="mod-td-pred.html#cb71-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb71-71"><a href="mod-td-pred.html#cb71-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $dummy$pr</span></span>
<span id="cb71-72"><a href="mod-td-pred.html#cb71-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 </span></span>
<span id="cb71-73"><a href="mod-td-pred.html#cb71-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1</span></span>
<span id="cb71-74"><a href="mod-td-pred.html#cb71-74" aria-hidden="true" tabindex="-1"></a><span class="do">## Set the policy</span></span>
<span id="cb71-75"><a href="mod-td-pred.html#cb71-75" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span> <span class="ot">=</span> <span class="fl">0.5</span>, <span class="st">&quot;right&quot;</span> <span class="ot">=</span> <span class="fl">0.5</span>)</span>
<span id="cb71-76"><a href="mod-td-pred.html#cb71-76" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">setPolicy</span>(states, pi)</span>
<span id="cb71-77"><a href="mod-td-pred.html#cb71-77" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;dummy&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb71-78"><a href="mod-td-pred.html#cb71-78" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">setPolicy</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;7&quot;</span>), pi)</span>
<span id="cb71-79"><a href="mod-td-pred.html#cb71-79" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getPolicy</span>()</span>
<span id="cb71-80"><a href="mod-td-pred.html#cb71-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span id="cb71-81"><a href="mod-td-pred.html#cb71-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state action    pr</span></span>
<span id="cb71-82"><a href="mod-td-pred.html#cb71-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb71-83"><a href="mod-td-pred.html#cb71-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 1     dummy    1  </span></span>
<span id="cb71-84"><a href="mod-td-pred.html#cb71-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2     left     0.5</span></span>
<span id="cb71-85"><a href="mod-td-pred.html#cb71-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2     right    0.5</span></span>
<span id="cb71-86"><a href="mod-td-pred.html#cb71-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 3     left     0.5</span></span>
<span id="cb71-87"><a href="mod-td-pred.html#cb71-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 3     right    0.5</span></span>
<span id="cb71-88"><a href="mod-td-pred.html#cb71-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 4     left     0.5</span></span>
<span id="cb71-89"><a href="mod-td-pred.html#cb71-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 4     right    0.5</span></span>
<span id="cb71-90"><a href="mod-td-pred.html#cb71-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 5     left     0.5</span></span>
<span id="cb71-91"><a href="mod-td-pred.html#cb71-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 5     right    0.5</span></span>
<span id="cb71-92"><a href="mod-td-pred.html#cb71-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 6     left     0.5</span></span>
<span id="cb71-93"><a href="mod-td-pred.html#cb71-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 6     right    0.5</span></span>
<span id="cb71-94"><a href="mod-td-pred.html#cb71-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 7     dummy    1</span></span>
<span id="cb71-95"><a href="mod-td-pred.html#cb71-95" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluate the policy</span></span>
<span id="cb71-96"><a href="mod-td-pred.html#cb71-96" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">policyEval</span>(<span class="at">gamma =</span> <span class="dv">1</span>)</span>
<span id="cb71-97"><a href="mod-td-pred.html#cb71-97" aria-hidden="true" tabindex="-1"></a>mdp<span class="sc">$</span><span class="fu">getStateValues</span>()</span>
<span id="cb71-98"><a href="mod-td-pred.html#cb71-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7 × 2</span></span>
<span id="cb71-99"><a href="mod-td-pred.html#cb71-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v</span></span>
<span id="cb71-100"><a href="mod-td-pred.html#cb71-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb71-101"><a href="mod-td-pred.html#cb71-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1     0    </span></span>
<span id="cb71-102"><a href="mod-td-pred.html#cb71-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2     0.167</span></span>
<span id="cb71-103"><a href="mod-td-pred.html#cb71-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3     0.333</span></span>
<span id="cb71-104"><a href="mod-td-pred.html#cb71-104" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4     0.500</span></span>
<span id="cb71-105"><a href="mod-td-pred.html#cb71-105" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 5     0.667</span></span>
<span id="cb71-106"><a href="mod-td-pred.html#cb71-106" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 6     0.833</span></span>
<span id="cb71-107"><a href="mod-td-pred.html#cb71-107" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 7     0</span></span></code></pre></div>
<!-- Q3 -->
<div id="cKu3as3SliFQ1AH3LN1t" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="cKu3as3SliFQ1AH3LN1t-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="cKu3as3SliFQ1AH3LN1t-title">
Solution
</h4>
</div>
<div class="modal-body">
<p>
We use TD(0), i.e. update using <span class="math inline">\(V(S_t) \leftarrow V(S_t) + \alpha\left[R_{t+1} + \gamma V(S_{t+1}) - V(S_t)\right]\)</span>: <span class="math display">\[V(4) = 0.5 + 0.1(0 + 0.5 - 0.5) = 0.5,\]</span> <span class="math display">\[V(3) = 0.5 + 0.1(0 + 0.5 - 0.5) = 0.5,\]</span> <span class="math display">\[V(2) = 0.5 + 0.1(0 + 0 - 0.5) = 0.45.\]</span> That is, since all states apart from the terminal states (initialized to 0) were initialised to the same value and the reward for non-terminal transitions is 0, then updates do nothing except for states that lead directly to termination. Here a reduction of 0.05.
</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#cKu3as3SliFQ1AH3LN1t">
Solution
</button>
<ol start="3" style="list-style-type: decimal">
<li>Consider an episode with sequence <span class="math inline">\(4, 0, 3, 0, 2, 0, 1\)</span>. Let the initial state-value estimates be 0.5 and update the state-values using TD(0) with <span class="math inline">\(\alpha = 0.1\)</span>. It appears that only <span class="math inline">\(V(A)\)</span> change why was only the estimate for this one state changed? By exactly how much was it changed?</li>
</ol>
<!-- Q4 -->
<ol start="4" style="list-style-type: decimal">
<li><p>Generate 100 episodes and run the TD(0) prediction algorithm with <span class="math inline">\(\alpha = 0.1\)</span> (see Figure <a href="mod-td-pred.html#fig:td0-pred-alg">7.1</a>). Make a plot of the state-value estimate (y-axis) given state 2-6 (x-axis) for TD(0) running for 1, 10 and 100 episodes. You may use the code below as a starting point.</p>
<p>First we need an environment representing the problem</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="mod-td-pred.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb72-2"><a href="mod-td-pred.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hash)</span>
<span id="cb72-3"><a href="mod-td-pred.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb72-4"><a href="mod-td-pred.html#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="mod-td-pred.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; R6 Class representing the RL environment for the problem</span></span>
<span id="cb72-6"><a href="mod-td-pred.html#cb72-6" aria-hidden="true" tabindex="-1"></a>RLEnvRandom <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;RLEnvRandom&quot;</span>,</span>
<span id="cb72-7"><a href="mod-td-pred.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb72-8"><a href="mod-td-pred.html#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="mod-td-pred.html#cb72-9" aria-hidden="true" tabindex="-1"></a>   <span class="co">#&#39; @description Returns next state and reward given current state and action in a list (with names `r` and `sN`).</span></span>
<span id="cb72-10"><a href="mod-td-pred.html#cb72-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">#&#39; @param s Current state.</span></span>
<span id="cb72-11"><a href="mod-td-pred.html#cb72-11" aria-hidden="true" tabindex="-1"></a>   <span class="co">#&#39; @param a Current action.</span></span>
<span id="cb72-12"><a href="mod-td-pred.html#cb72-12" aria-hidden="true" tabindex="-1"></a>   <span class="at">getTimeStepData =</span> <span class="cf">function</span>(s,a) {</span>
<span id="cb72-13"><a href="mod-td-pred.html#cb72-13" aria-hidden="true" tabindex="-1"></a>      s <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(s)</span>
<span id="cb72-14"><a href="mod-td-pred.html#cb72-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">==</span> <span class="st">&quot;left&quot;</span> <span class="sc">&amp;</span> s <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">r =</span> <span class="dv">0</span>, <span class="at">sN =</span> <span class="fu">as.character</span>(s<span class="dv">-1</span>)))</span>
<span id="cb72-15"><a href="mod-td-pred.html#cb72-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">==</span> <span class="st">&quot;right&quot;</span> <span class="sc">&amp;</span> s <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">&lt;</span> <span class="dv">7</span>) {</span>
<span id="cb72-16"><a href="mod-td-pred.html#cb72-16" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (s <span class="sc">==</span> <span class="dv">6</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">r =</span> <span class="dv">1</span>, <span class="at">sN =</span> <span class="fu">as.character</span>(s<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb72-17"><a href="mod-td-pred.html#cb72-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">r =</span> <span class="dv">0</span>, <span class="at">sN =</span> <span class="fu">as.character</span>(s<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb72-18"><a href="mod-td-pred.html#cb72-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb72-19"><a href="mod-td-pred.html#cb72-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ((s <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> s <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">&amp;</span> a <span class="sc">==</span> <span class="st">&quot;dummy&quot;</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">r =</span> <span class="dv">0</span>, <span class="at">sN =</span> <span class="cn">NA_character_</span>))</span>
<span id="cb72-20"><a href="mod-td-pred.html#cb72-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;Error finding next state and reward!&quot;</span>)</span>
<span id="cb72-21"><a href="mod-td-pred.html#cb72-21" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb72-22"><a href="mod-td-pred.html#cb72-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-23"><a href="mod-td-pred.html#cb72-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-24"><a href="mod-td-pred.html#cb72-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-25"><a href="mod-td-pred.html#cb72-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-26"><a href="mod-td-pred.html#cb72-26" aria-hidden="true" tabindex="-1"></a>env <span class="ot">&lt;-</span> RLEnvRandom<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb72-27"><a href="mod-td-pred.html#cb72-27" aria-hidden="true" tabindex="-1"></a>env<span class="sc">$</span><span class="fu">getTimeStepData</span>(<span class="st">&quot;3&quot;</span>, <span class="st">&quot;right&quot;</span>)</span>
<span id="cb72-28"><a href="mod-td-pred.html#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $r</span></span>
<span id="cb72-29"><a href="mod-td-pred.html#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb72-30"><a href="mod-td-pred.html#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb72-31"><a href="mod-td-pred.html#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $sN</span></span>
<span id="cb72-32"><a href="mod-td-pred.html#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;4&quot;</span></span>
<span id="cb72-33"><a href="mod-td-pred.html#cb72-33" aria-hidden="true" tabindex="-1"></a>env<span class="sc">$</span><span class="fu">getTimeStepData</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;dummy&quot;</span>)</span>
<span id="cb72-34"><a href="mod-td-pred.html#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $r</span></span>
<span id="cb72-35"><a href="mod-td-pred.html#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb72-36"><a href="mod-td-pred.html#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb72-37"><a href="mod-td-pred.html#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $sN</span></span>
<span id="cb72-38"><a href="mod-td-pred.html#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb72-39"><a href="mod-td-pred.html#cb72-39" aria-hidden="true" tabindex="-1"></a>env<span class="sc">$</span><span class="fu">getTimeStepData</span>(<span class="st">&quot;6&quot;</span>, <span class="st">&quot;right&quot;</span>)</span>
<span id="cb72-40"><a href="mod-td-pred.html#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $r</span></span>
<span id="cb72-41"><a href="mod-td-pred.html#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb72-42"><a href="mod-td-pred.html#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb72-43"><a href="mod-td-pred.html#cb72-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $sN</span></span>
<span id="cb72-44"><a href="mod-td-pred.html#cb72-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;7&quot;</span></span></code></pre></div>
<p>Note we define a method <code>getTimeStepData</code> that takes a state and action and return the reward and next state. This method is used by the RL agent class in method <code>policyEvalTD0</code>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="mod-td-pred.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb73-2"><a href="mod-td-pred.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hash)</span>
<span id="cb73-3"><a href="mod-td-pred.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb73-4"><a href="mod-td-pred.html#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="mod-td-pred.html#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Generic RL agent for tabular data (R6 class)</span></span>
<span id="cb73-6"><a href="mod-td-pred.html#cb73-6" aria-hidden="true" tabindex="-1"></a>RLAgent <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;RLAgent&quot;</span>,</span>
<span id="cb73-7"><a href="mod-td-pred.html#cb73-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb73-8"><a href="mod-td-pred.html#cb73-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @field model The model is used to represent the information we have. The</span></span>
<span id="cb73-9"><a href="mod-td-pred.html#cb73-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; model is represented using a hash list for the states. Each states contains </span></span>
<span id="cb73-10"><a href="mod-td-pred.html#cb73-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    - A list with `actions` (a hash #&#39; list with actions).</span></span>
<span id="cb73-11"><a href="mod-td-pred.html#cb73-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    - `pi` (a named vector with policy pr (only positive values).</span></span>
<span id="cb73-12"><a href="mod-td-pred.html#cb73-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    - `piG` the greedy action (a string). </span></span>
<span id="cb73-13"><a href="mod-td-pred.html#cb73-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    - `n` a visit counter</span></span>
<span id="cb73-14"><a href="mod-td-pred.html#cb73-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; The `actions` hash list contains </span></span>
<span id="cb73-15"><a href="mod-td-pred.html#cb73-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    - The action-values `q`.</span></span>
<span id="cb73-16"><a href="mod-td-pred.html#cb73-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    - `n` a visit counter.</span></span>
<span id="cb73-17"><a href="mod-td-pred.html#cb73-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> <span class="cn">NULL</span>,  </span>
<span id="cb73-18"><a href="mod-td-pred.html#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="mod-td-pred.html#cb73-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Create an object (when call new).</span></span>
<span id="cb73-20"><a href="mod-td-pred.html#cb73-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">initialize =</span> <span class="cf">function</span>() {</span>
<span id="cb73-21"><a href="mod-td-pred.html#cb73-21" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="fu">hash</span>()</span>
<span id="cb73-22"><a href="mod-td-pred.html#cb73-22" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-23"><a href="mod-td-pred.html#cb73-23" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-24"><a href="mod-td-pred.html#cb73-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-25"><a href="mod-td-pred.html#cb73-25" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add state and action to the hash (only if not already added)</span></span>
<span id="cb73-26"><a href="mod-td-pred.html#cb73-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s State key/string.</span></span>
<span id="cb73-27"><a href="mod-td-pred.html#cb73-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param a Action key/string.</span></span>
<span id="cb73-28"><a href="mod-td-pred.html#cb73-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">addStateAction =</span> <span class="cf">function</span>(s, a) {</span>
<span id="cb73-29"><a href="mod-td-pred.html#cb73-29" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (<span class="sc">!</span><span class="fu">has.key</span>(s, self<span class="sc">$</span>model)) <span class="fu">addStates</span>(s)</span>
<span id="cb73-30"><a href="mod-td-pred.html#cb73-30" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (<span class="sc">!</span><span class="fu">has.key</span>(a, self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)) self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">q =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">0</span>)</span>
<span id="cb73-31"><a href="mod-td-pred.html#cb73-31" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-32"><a href="mod-td-pred.html#cb73-32" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-33"><a href="mod-td-pred.html#cb73-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-34"><a href="mod-td-pred.html#cb73-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add the states (keys) and define void policy and empty action hash. </span></span>
<span id="cb73-35"><a href="mod-td-pred.html#cb73-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states A vector of states (converted to strings).</span></span>
<span id="cb73-36"><a href="mod-td-pred.html#cb73-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">addStates =</span> <span class="cf">function</span>(states) {</span>
<span id="cb73-37"><a href="mod-td-pred.html#cb73-37" aria-hidden="true" tabindex="-1"></a>         keys <span class="ot">&lt;-</span> <span class="fu">make.keys</span>(states)</span>
<span id="cb73-38"><a href="mod-td-pred.html#cb73-38" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[keys] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">pi =</span> <span class="cn">NA</span>)   <span class="co"># don&#39;t use pi = NULL since then won&#39;t be defined </span></span>
<span id="cb73-39"><a href="mod-td-pred.html#cb73-39" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> keys) {</span>
<span id="cb73-40"><a href="mod-td-pred.html#cb73-40" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb73-41"><a href="mod-td-pred.html#cb73-41" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions <span class="ot">&lt;-</span> <span class="fu">hash</span>()</span>
<span id="cb73-42"><a href="mod-td-pred.html#cb73-42" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># counter visited</span></span>
<span id="cb73-43"><a href="mod-td-pred.html#cb73-43" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-44"><a href="mod-td-pred.html#cb73-44" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-45"><a href="mod-td-pred.html#cb73-45" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-46"><a href="mod-td-pred.html#cb73-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-47"><a href="mod-td-pred.html#cb73-47" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add the actions to a state</span></span>
<span id="cb73-48"><a href="mod-td-pred.html#cb73-48" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s State (key).</span></span>
<span id="cb73-49"><a href="mod-td-pred.html#cb73-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param actions A vector of actions (converted to strings).</span></span>
<span id="cb73-50"><a href="mod-td-pred.html#cb73-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">addActions =</span> <span class="cf">function</span>(s, actions) {</span>
<span id="cb73-51"><a href="mod-td-pred.html#cb73-51" aria-hidden="true" tabindex="-1"></a>         keys <span class="ot">&lt;-</span> <span class="fu">make.keys</span>(actions)</span>
<span id="cb73-52"><a href="mod-td-pred.html#cb73-52" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (a <span class="cf">in</span> keys) {</span>
<span id="cb73-53"><a href="mod-td-pred.html#cb73-53" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">addStateAction</span>(s, a)</span>
<span id="cb73-54"><a href="mod-td-pred.html#cb73-54" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-55"><a href="mod-td-pred.html#cb73-55" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-56"><a href="mod-td-pred.html#cb73-56" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-57"><a href="mod-td-pred.html#cb73-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-58"><a href="mod-td-pred.html#cb73-58" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Add states and actions to the hash with initial values. If already exists nothing happens. </span></span>
<span id="cb73-59"><a href="mod-td-pred.html#cb73-59" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param df A tibble with string columns `s` (states) and `a` (actions).</span></span>
<span id="cb73-60"><a href="mod-td-pred.html#cb73-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">addStatesAndActions =</span> <span class="cf">function</span>(df) {</span>
<span id="cb73-61"><a href="mod-td-pred.html#cb73-61" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb73-62"><a href="mod-td-pred.html#cb73-62" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">addStateAction</span>(df<span class="sc">$</span>s[i], df<span class="sc">$</span>a[i])</span>
<span id="cb73-63"><a href="mod-td-pred.html#cb73-63" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-64"><a href="mod-td-pred.html#cb73-64" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-65"><a href="mod-td-pred.html#cb73-65" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-66"><a href="mod-td-pred.html#cb73-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-67"><a href="mod-td-pred.html#cb73-67" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the action-values for all actions.</span></span>
<span id="cb73-68"><a href="mod-td-pred.html#cb73-68" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param value The value.</span></span>
<span id="cb73-69"><a href="mod-td-pred.html#cb73-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">setActionValue =</span> <span class="cf">function</span>(<span class="at">value =</span> <span class="dv">0</span>) {</span>
<span id="cb73-70"><a href="mod-td-pred.html#cb73-70" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb73-71"><a href="mod-td-pred.html#cb73-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (a <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)) {</span>
<span id="cb73-72"><a href="mod-td-pred.html#cb73-72" aria-hidden="true" tabindex="-1"></a>               self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q <span class="ot">=</span> value</span>
<span id="cb73-73"><a href="mod-td-pred.html#cb73-73" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-74"><a href="mod-td-pred.html#cb73-74" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-75"><a href="mod-td-pred.html#cb73-75" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-76"><a href="mod-td-pred.html#cb73-76" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-77"><a href="mod-td-pred.html#cb73-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-78"><a href="mod-td-pred.html#cb73-78" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the state-value of states</span></span>
<span id="cb73-79"><a href="mod-td-pred.html#cb73-79" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states A vector of states.</span></span>
<span id="cb73-80"><a href="mod-td-pred.html#cb73-80" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param value The value.</span></span>
<span id="cb73-81"><a href="mod-td-pred.html#cb73-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">setStateValue =</span> <span class="cf">function</span>(<span class="at">states =</span> <span class="fu">keys</span>(self<span class="sc">$</span>model), <span class="at">value =</span> <span class="dv">0</span>) {</span>
<span id="cb73-82"><a href="mod-td-pred.html#cb73-82" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb73-83"><a href="mod-td-pred.html#cb73-83" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v <span class="ot">&lt;-</span> value</span>
<span id="cb73-84"><a href="mod-td-pred.html#cb73-84" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-85"><a href="mod-td-pred.html#cb73-85" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-86"><a href="mod-td-pred.html#cb73-86" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-87"><a href="mod-td-pred.html#cb73-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-88"><a href="mod-td-pred.html#cb73-88" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the action visit counter values for all actions.</span></span>
<span id="cb73-89"><a href="mod-td-pred.html#cb73-89" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param ctrValue Counter value.</span></span>
<span id="cb73-90"><a href="mod-td-pred.html#cb73-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">setActionCtrValue =</span> <span class="cf">function</span>(<span class="at">ctrValue =</span> <span class="dv">0</span>) {</span>
<span id="cb73-91"><a href="mod-td-pred.html#cb73-91" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb73-92"><a href="mod-td-pred.html#cb73-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (a <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)) {</span>
<span id="cb73-93"><a href="mod-td-pred.html#cb73-93" aria-hidden="true" tabindex="-1"></a>               self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="ot">=</span> ctrValue</span>
<span id="cb73-94"><a href="mod-td-pred.html#cb73-94" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-95"><a href="mod-td-pred.html#cb73-95" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-96"><a href="mod-td-pred.html#cb73-96" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-97"><a href="mod-td-pred.html#cb73-97" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-98"><a href="mod-td-pred.html#cb73-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-99"><a href="mod-td-pred.html#cb73-99" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the action-values for a single action (including the counter values).</span></span>
<span id="cb73-100"><a href="mod-td-pred.html#cb73-100" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param value The value.</span></span>
<span id="cb73-101"><a href="mod-td-pred.html#cb73-101" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param ctrValue Counter value.</span></span>
<span id="cb73-102"><a href="mod-td-pred.html#cb73-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">setActionValueSingle =</span> <span class="cf">function</span>(<span class="at">value =</span> <span class="dv">0</span>, <span class="at">ctrValue =</span> <span class="dv">0</span>, s, a) {</span>
<span id="cb73-103"><a href="mod-td-pred.html#cb73-103" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q <span class="ot">=</span> value</span>
<span id="cb73-104"><a href="mod-td-pred.html#cb73-104" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="ot">=</span> ctrValue</span>
<span id="cb73-105"><a href="mod-td-pred.html#cb73-105" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-106"><a href="mod-td-pred.html#cb73-106" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-107"><a href="mod-td-pred.html#cb73-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-108"><a href="mod-td-pred.html#cb73-108" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the policy to a random epsilon-greedy policy.</span></span>
<span id="cb73-109"><a href="mod-td-pred.html#cb73-109" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param eps Epsilon used in epsilon-greedy policy.</span></span>
<span id="cb73-110"><a href="mod-td-pred.html#cb73-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">setRandomEpsGreedyPolicy =</span> <span class="cf">function</span>(eps) {</span>
<span id="cb73-111"><a href="mod-td-pred.html#cb73-111" aria-hidden="true" tabindex="-1"></a>         states <span class="ot">&lt;-</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb73-112"><a href="mod-td-pred.html#cb73-112" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb73-113"><a href="mod-td-pred.html#cb73-113" aria-hidden="true" tabindex="-1"></a>            actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb73-114"><a href="mod-td-pred.html#cb73-114" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi <span class="ot">&lt;-</span> <span class="fu">rep</span>(eps<span class="sc">/</span><span class="fu">length</span>(actions), <span class="fu">length</span>(actions))</span>
<span id="cb73-115"><a href="mod-td-pred.html#cb73-115" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi) <span class="ot">&lt;-</span> actions</span>
<span id="cb73-116"><a href="mod-td-pred.html#cb73-116" aria-hidden="true" tabindex="-1"></a>            piG <span class="ot">&lt;-</span> <span class="fu">sample</span>(self<span class="sc">$</span><span class="fu">getActionKeys</span>(s), <span class="dv">1</span>)</span>
<span id="cb73-117"><a href="mod-td-pred.html#cb73-117" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi[piG] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi[piG] <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> eps</span>
<span id="cb73-118"><a href="mod-td-pred.html#cb73-118" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-119"><a href="mod-td-pred.html#cb73-119" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-120"><a href="mod-td-pred.html#cb73-120" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-121"><a href="mod-td-pred.html#cb73-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-122"><a href="mod-td-pred.html#cb73-122" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the policy to the optimal epsilon-greedy policy </span></span>
<span id="cb73-123"><a href="mod-td-pred.html#cb73-123" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param eps Epsilon used in epsilon-greedy policy.</span></span>
<span id="cb73-124"><a href="mod-td-pred.html#cb73-124" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states States under consideration.</span></span>
<span id="cb73-125"><a href="mod-td-pred.html#cb73-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">setEpsGreedyPolicy =</span> <span class="cf">function</span>(eps, states) {</span>
<span id="cb73-126"><a href="mod-td-pred.html#cb73-126" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb73-127"><a href="mod-td-pred.html#cb73-127" aria-hidden="true" tabindex="-1"></a>            actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb73-128"><a href="mod-td-pred.html#cb73-128" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi <span class="ot">&lt;-</span> <span class="fu">rep</span>(eps<span class="sc">/</span><span class="fu">length</span>(actions), <span class="fu">length</span>(actions))</span>
<span id="cb73-129"><a href="mod-td-pred.html#cb73-129" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi) <span class="ot">&lt;-</span> actions</span>
<span id="cb73-130"><a href="mod-td-pred.html#cb73-130" aria-hidden="true" tabindex="-1"></a>            idx <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">which.is.max</span>(<span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;q&quot;</span>,]))  <span class="co"># choose among max values at random</span></span>
<span id="cb73-131"><a href="mod-td-pred.html#cb73-131" aria-hidden="true" tabindex="-1"></a>            <span class="co"># idx &lt;- which.max(unlist(values(self$model[[s]]$actions)[&quot;q&quot;,]))  # choose first max </span></span>
<span id="cb73-132"><a href="mod-td-pred.html#cb73-132" aria-hidden="true" tabindex="-1"></a>            <span class="co"># self$model[[s]]$piG &lt;- actions[idx]</span></span>
<span id="cb73-133"><a href="mod-td-pred.html#cb73-133" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi[idx] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi[idx] <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> eps</span>
<span id="cb73-134"><a href="mod-td-pred.html#cb73-134" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-135"><a href="mod-td-pred.html#cb73-135" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-136"><a href="mod-td-pred.html#cb73-136" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-137"><a href="mod-td-pred.html#cb73-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-138"><a href="mod-td-pred.html#cb73-138" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the greedy policy (stored in piG) based on action-values. </span></span>
<span id="cb73-139"><a href="mod-td-pred.html#cb73-139" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states States under consideration.</span></span>
<span id="cb73-140"><a href="mod-td-pred.html#cb73-140" aria-hidden="true" tabindex="-1"></a>      <span class="at">setGreedyPolicy =</span> <span class="cf">function</span>(<span class="at">states =</span> self<span class="sc">$</span><span class="fu">getStateKeys</span>()) {</span>
<span id="cb73-141"><a href="mod-td-pred.html#cb73-141" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb73-142"><a href="mod-td-pred.html#cb73-142" aria-hidden="true" tabindex="-1"></a>            actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb73-143"><a href="mod-td-pred.html#cb73-143" aria-hidden="true" tabindex="-1"></a>            idx <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">which.is.max</span>(<span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;q&quot;</span>,]))  <span class="co"># choose among max values at random</span></span>
<span id="cb73-144"><a href="mod-td-pred.html#cb73-144" aria-hidden="true" tabindex="-1"></a>            <span class="co"># idx &lt;- which.max(unlist(values(self$model[[s]]$actions)[&quot;q&quot;,]))  # choose first max </span></span>
<span id="cb73-145"><a href="mod-td-pred.html#cb73-145" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>piG <span class="ot">&lt;-</span> actions[idx]</span>
<span id="cb73-146"><a href="mod-td-pred.html#cb73-146" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-147"><a href="mod-td-pred.html#cb73-147" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-148"><a href="mod-td-pred.html#cb73-148" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-149"><a href="mod-td-pred.html#cb73-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-150"><a href="mod-td-pred.html#cb73-150" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the policy to the named vector pi for a set of states</span></span>
<span id="cb73-151"><a href="mod-td-pred.html#cb73-151" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states States under consideration.</span></span>
<span id="cb73-152"><a href="mod-td-pred.html#cb73-152" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param pi A named vector with policy pr (only psitive values).</span></span>
<span id="cb73-153"><a href="mod-td-pred.html#cb73-153" aria-hidden="true" tabindex="-1"></a>      <span class="at">setPolicy =</span> <span class="cf">function</span>(states, pi) {</span>
<span id="cb73-154"><a href="mod-td-pred.html#cb73-154" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb73-155"><a href="mod-td-pred.html#cb73-155" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi <span class="ot">&lt;-</span> pi</span>
<span id="cb73-156"><a href="mod-td-pred.html#cb73-156" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-157"><a href="mod-td-pred.html#cb73-157" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-158"><a href="mod-td-pred.html#cb73-158" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-159"><a href="mod-td-pred.html#cb73-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-160"><a href="mod-td-pred.html#cb73-160" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Set the state visit counter values for all states.</span></span>
<span id="cb73-161"><a href="mod-td-pred.html#cb73-161" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param ctrValue Counter value.</span></span>
<span id="cb73-162"><a href="mod-td-pred.html#cb73-162" aria-hidden="true" tabindex="-1"></a>      <span class="at">setStateCtrValue =</span> <span class="cf">function</span>(<span class="at">ctrValue =</span> <span class="dv">0</span>) {</span>
<span id="cb73-163"><a href="mod-td-pred.html#cb73-163" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb73-164"><a href="mod-td-pred.html#cb73-164" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="ot">=</span> ctrValue</span>
<span id="cb73-165"><a href="mod-td-pred.html#cb73-165" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-166"><a href="mod-td-pred.html#cb73-166" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-167"><a href="mod-td-pred.html#cb73-167" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-168"><a href="mod-td-pred.html#cb73-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-169"><a href="mod-td-pred.html#cb73-169" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the state keys</span></span>
<span id="cb73-170"><a href="mod-td-pred.html#cb73-170" aria-hidden="true" tabindex="-1"></a>      <span class="at">getStateKeys =</span> <span class="cf">function</span>() {</span>
<span id="cb73-171"><a href="mod-td-pred.html#cb73-171" aria-hidden="true" tabindex="-1"></a>         <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb73-172"><a href="mod-td-pred.html#cb73-172" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-173"><a href="mod-td-pred.html#cb73-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-174"><a href="mod-td-pred.html#cb73-174" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the state-value for a state and policy using the q/action-values </span></span>
<span id="cb73-175"><a href="mod-td-pred.html#cb73-175" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s A state.</span></span>
<span id="cb73-176"><a href="mod-td-pred.html#cb73-176" aria-hidden="true" tabindex="-1"></a>      <span class="at">getStateValueQ =</span> <span class="cf">function</span>(s) {</span>
<span id="cb73-177"><a href="mod-td-pred.html#cb73-177" aria-hidden="true" tabindex="-1"></a>         pi <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi</span>
<span id="cb73-178"><a href="mod-td-pred.html#cb73-178" aria-hidden="true" tabindex="-1"></a>         <span class="co"># print(pi)</span></span>
<span id="cb73-179"><a href="mod-td-pred.html#cb73-179" aria-hidden="true" tabindex="-1"></a>         val <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb73-180"><a href="mod-td-pred.html#cb73-180" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (a <span class="cf">in</span> <span class="fu">names</span>(pi)) {</span>
<span id="cb73-181"><a href="mod-td-pred.html#cb73-181" aria-hidden="true" tabindex="-1"></a>            val <span class="ot">&lt;-</span> val <span class="sc">+</span> pi[a] <span class="sc">*</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q</span>
<span id="cb73-182"><a href="mod-td-pred.html#cb73-182" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(self$model[[s]]$actions[[a]]$q)</span></span>
<span id="cb73-183"><a href="mod-td-pred.html#cb73-183" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-184"><a href="mod-td-pred.html#cb73-184" aria-hidden="true" tabindex="-1"></a>         <span class="co"># print(val)</span></span>
<span id="cb73-185"><a href="mod-td-pred.html#cb73-185" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(val)</span>
<span id="cb73-186"><a href="mod-td-pred.html#cb73-186" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-187"><a href="mod-td-pred.html#cb73-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-188"><a href="mod-td-pred.html#cb73-188" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the state-values as a tibble</span></span>
<span id="cb73-189"><a href="mod-td-pred.html#cb73-189" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s A vector of state keys.</span></span>
<span id="cb73-190"><a href="mod-td-pred.html#cb73-190" aria-hidden="true" tabindex="-1"></a>      <span class="at">getStateValues =</span> <span class="cf">function</span>(<span class="at">s =</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb73-191"><a href="mod-td-pred.html#cb73-191" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tibble</span>(<span class="at">state =</span> s) <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">v =</span> self<span class="sc">$</span>model[[state]]<span class="sc">$</span>v) </span>
<span id="cb73-192"><a href="mod-td-pred.html#cb73-192" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-193"><a href="mod-td-pred.html#cb73-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-194"><a href="mod-td-pred.html#cb73-194" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the action keys</span></span>
<span id="cb73-195"><a href="mod-td-pred.html#cb73-195" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s The state considered.</span></span>
<span id="cb73-196"><a href="mod-td-pred.html#cb73-196" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionKeys =</span> <span class="cf">function</span>(s) {</span>
<span id="cb73-197"><a href="mod-td-pred.html#cb73-197" aria-hidden="true" tabindex="-1"></a>         <span class="fu">keys</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions) </span>
<span id="cb73-198"><a href="mod-td-pred.html#cb73-198" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-199"><a href="mod-td-pred.html#cb73-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-200"><a href="mod-td-pred.html#cb73-200" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return information about actions stored in a state</span></span>
<span id="cb73-201"><a href="mod-td-pred.html#cb73-201" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s The state considered.</span></span>
<span id="cb73-202"><a href="mod-td-pred.html#cb73-202" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionInfo =</span> <span class="cf">function</span>(s) {</span>
<span id="cb73-203"><a href="mod-td-pred.html#cb73-203" aria-hidden="true" tabindex="-1"></a>         <span class="fu">as.list</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions) </span>
<span id="cb73-204"><a href="mod-td-pred.html#cb73-204" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-205"><a href="mod-td-pred.html#cb73-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-206"><a href="mod-td-pred.html#cb73-206" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the current policy as a tibble</span></span>
<span id="cb73-207"><a href="mod-td-pred.html#cb73-207" aria-hidden="true" tabindex="-1"></a>      <span class="at">getPolicy =</span> <span class="cf">function</span>(<span class="at">states =</span> self<span class="sc">$</span><span class="fu">getStateKeys</span>()) {</span>
<span id="cb73-208"><a href="mod-td-pred.html#cb73-208" aria-hidden="true" tabindex="-1"></a>         <span class="fu">map_dfr</span>(states, <span class="at">.f =</span> <span class="cf">function</span>(s) {</span>
<span id="cb73-209"><a href="mod-td-pred.html#cb73-209" aria-hidden="true" tabindex="-1"></a>               <span class="fu">list</span>(<span class="at">state =</span> s, <span class="at">action =</span> <span class="fu">names</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi), <span class="at">pr =</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi)</span>
<span id="cb73-210"><a href="mod-td-pred.html#cb73-210" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb73-211"><a href="mod-td-pred.html#cb73-211" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-212"><a href="mod-td-pred.html#cb73-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-213"><a href="mod-td-pred.html#cb73-213" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Returns all action-values in a matrix (cols: actions, rows: states)</span></span>
<span id="cb73-214"><a href="mod-td-pred.html#cb73-214" aria-hidden="true" tabindex="-1"></a>      <span class="at">getStateActionQMat =</span> <span class="cf">function</span>() {</span>
<span id="cb73-215"><a href="mod-td-pred.html#cb73-215" aria-hidden="true" tabindex="-1"></a>         states <span class="ot">&lt;-</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)</span>
<span id="cb73-216"><a href="mod-td-pred.html#cb73-216" aria-hidden="true" tabindex="-1"></a>         actions <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">sapply</span>(states, <span class="cf">function</span>(s) self<span class="sc">$</span><span class="fu">getActionKeys</span>(s))))</span>
<span id="cb73-217"><a href="mod-td-pred.html#cb73-217" aria-hidden="true" tabindex="-1"></a>         m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(states), <span class="at">ncol =</span> <span class="fu">length</span>(actions))</span>
<span id="cb73-218"><a href="mod-td-pred.html#cb73-218" aria-hidden="true" tabindex="-1"></a>         <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> actions</span>
<span id="cb73-219"><a href="mod-td-pred.html#cb73-219" aria-hidden="true" tabindex="-1"></a>         <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> states</span>
<span id="cb73-220"><a href="mod-td-pred.html#cb73-220" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (s <span class="cf">in</span> states) {</span>
<span id="cb73-221"><a href="mod-td-pred.html#cb73-221" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (a <span class="cf">in</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)) {</span>
<span id="cb73-222"><a href="mod-td-pred.html#cb73-222" aria-hidden="true" tabindex="-1"></a>               m[s, a] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q</span>
<span id="cb73-223"><a href="mod-td-pred.html#cb73-223" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-224"><a href="mod-td-pred.html#cb73-224" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-225"><a href="mod-td-pred.html#cb73-225" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(m)</span>
<span id="cb73-226"><a href="mod-td-pred.html#cb73-226" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-227"><a href="mod-td-pred.html#cb73-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-228"><a href="mod-td-pred.html#cb73-228" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return the action-values as a tibble</span></span>
<span id="cb73-229"><a href="mod-td-pred.html#cb73-229" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states A vector of state keys.</span></span>
<span id="cb73-230"><a href="mod-td-pred.html#cb73-230" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionValues =</span> <span class="cf">function</span>(<span class="at">states =</span> <span class="fu">keys</span>(self<span class="sc">$</span>model)) {</span>
<span id="cb73-231"><a href="mod-td-pred.html#cb73-231" aria-hidden="true" tabindex="-1"></a>         <span class="fu">map_dfr</span>(states, <span class="at">.f =</span> <span class="cf">function</span>(s) {</span>
<span id="cb73-232"><a href="mod-td-pred.html#cb73-232" aria-hidden="true" tabindex="-1"></a>               <span class="fu">list</span>(<span class="at">state =</span> s, <span class="at">action =</span> <span class="fu">keys</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions), <span class="at">q =</span> <span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;q&quot;</span>,]), <span class="at">n =</span> <span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;n&quot;</span>,]))</span>
<span id="cb73-233"><a href="mod-td-pred.html#cb73-233" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb73-234"><a href="mod-td-pred.html#cb73-234" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-235"><a href="mod-td-pred.html#cb73-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-236"><a href="mod-td-pred.html#cb73-236" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Select next action using upper-confidence bound. Also update the visit counters for both state and selected action.</span></span>
<span id="cb73-237"><a href="mod-td-pred.html#cb73-237" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @return Action.</span></span>
<span id="cb73-238"><a href="mod-td-pred.html#cb73-238" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionUCB =</span> <span class="cf">function</span>(s, <span class="at">coeff =</span> <span class="dv">1</span>) { </span>
<span id="cb73-239"><a href="mod-td-pred.html#cb73-239" aria-hidden="true" tabindex="-1"></a>         actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb73-240"><a href="mod-td-pred.html#cb73-240" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># visit s</span></span>
<span id="cb73-241"><a href="mod-td-pred.html#cb73-241" aria-hidden="true" tabindex="-1"></a>         qV <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;q&quot;</span>,])</span>
<span id="cb73-242"><a href="mod-td-pred.html#cb73-242" aria-hidden="true" tabindex="-1"></a>         nA <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;n&quot;</span>,])</span>
<span id="cb73-243"><a href="mod-td-pred.html#cb73-243" aria-hidden="true" tabindex="-1"></a>         nS <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n</span>
<span id="cb73-244"><a href="mod-td-pred.html#cb73-244" aria-hidden="true" tabindex="-1"></a>         val <span class="ot">&lt;-</span> qV <span class="sc">+</span> coeff <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">log</span>(nS <span class="sc">+</span> <span class="fl">0.0001</span>)<span class="sc">/</span>nA)</span>
<span id="cb73-245"><a href="mod-td-pred.html#cb73-245" aria-hidden="true" tabindex="-1"></a>         idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(val)</span>
<span id="cb73-246"><a href="mod-td-pred.html#cb73-246" aria-hidden="true" tabindex="-1"></a>         a <span class="ot">&lt;-</span> actions[idx]</span>
<span id="cb73-247"><a href="mod-td-pred.html#cb73-247" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># note there is a risk here if use every-visit for an episode then will update more than once implying slower convergence. </span></span>
<span id="cb73-248"><a href="mod-td-pred.html#cb73-248" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(a)</span>
<span id="cb73-249"><a href="mod-td-pred.html#cb73-249" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-250"><a href="mod-td-pred.html#cb73-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-251"><a href="mod-td-pred.html#cb73-251" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Select next action using epsilon-greedy policy based on action-values. Also update the visit counters for both state and selected action.</span></span>
<span id="cb73-252"><a href="mod-td-pred.html#cb73-252" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @return Action.</span></span>
<span id="cb73-253"><a href="mod-td-pred.html#cb73-253" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionEG =</span> <span class="cf">function</span>(s, eps) {</span>
<span id="cb73-254"><a href="mod-td-pred.html#cb73-254" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># visit s</span></span>
<span id="cb73-255"><a href="mod-td-pred.html#cb73-255" aria-hidden="true" tabindex="-1"></a>         q <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">values</span>(self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions)[<span class="st">&quot;q&quot;</span>,])</span>
<span id="cb73-256"><a href="mod-td-pred.html#cb73-256" aria-hidden="true" tabindex="-1"></a>         actions <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionKeys</span>(s)</span>
<span id="cb73-257"><a href="mod-td-pred.html#cb73-257" aria-hidden="true" tabindex="-1"></a>         pi <span class="ot">&lt;-</span> <span class="fu">rep</span>(eps<span class="sc">/</span><span class="fu">length</span>(q), <span class="fu">length</span>(q))</span>
<span id="cb73-258"><a href="mod-td-pred.html#cb73-258" aria-hidden="true" tabindex="-1"></a>         idx <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">which.is.max</span>(q)  <span class="co"># choose among max values at random</span></span>
<span id="cb73-259"><a href="mod-td-pred.html#cb73-259" aria-hidden="true" tabindex="-1"></a>         <span class="co"># idx &lt;- which.max(unlist(values(self$model[[s]]$actions)[&quot;q&quot;,]))  # choose first max </span></span>
<span id="cb73-260"><a href="mod-td-pred.html#cb73-260" aria-hidden="true" tabindex="-1"></a>         pi[idx] <span class="ot">&lt;-</span> pi[idx] <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> eps</span>
<span id="cb73-261"><a href="mod-td-pred.html#cb73-261" aria-hidden="true" tabindex="-1"></a>         a <span class="ot">&lt;-</span> actions[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(actions), <span class="dv">1</span>, <span class="at">prob =</span> pi)]</span>
<span id="cb73-262"><a href="mod-td-pred.html#cb73-262" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># note there is a risk here if use every-visit for an episode then will update more than once implying slower convergence. </span></span>
<span id="cb73-263"><a href="mod-td-pred.html#cb73-263" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(a)</span>
<span id="cb73-264"><a href="mod-td-pred.html#cb73-264" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-265"><a href="mod-td-pred.html#cb73-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-266"><a href="mod-td-pred.html#cb73-266" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Return and action sampled from the current policy pi. Also update the visit counters for both state and selected action.</span></span>
<span id="cb73-267"><a href="mod-td-pred.html#cb73-267" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param s The state considered.</span></span>
<span id="cb73-268"><a href="mod-td-pred.html#cb73-268" aria-hidden="true" tabindex="-1"></a>      <span class="at">getActionPi =</span> <span class="cf">function</span>(s) {</span>
<span id="cb73-269"><a href="mod-td-pred.html#cb73-269" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># visit s</span></span>
<span id="cb73-270"><a href="mod-td-pred.html#cb73-270" aria-hidden="true" tabindex="-1"></a>         pi <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>pi</span>
<span id="cb73-271"><a href="mod-td-pred.html#cb73-271" aria-hidden="true" tabindex="-1"></a>         actions <span class="ot">&lt;-</span> <span class="fu">names</span>(pi)</span>
<span id="cb73-272"><a href="mod-td-pred.html#cb73-272" aria-hidden="true" tabindex="-1"></a>         a <span class="ot">&lt;-</span> <span class="fu">sample</span>(actions, <span class="dv">1</span>, <span class="at">prob =</span> pi)</span>
<span id="cb73-273"><a href="mod-td-pred.html#cb73-273" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># note there is a risk here if use every-visit for an episode then will update more than once implying slower convergence. </span></span>
<span id="cb73-274"><a href="mod-td-pred.html#cb73-274" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(a)</span>
<span id="cb73-275"><a href="mod-td-pred.html#cb73-275" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-276"><a href="mod-td-pred.html#cb73-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-277"><a href="mod-td-pred.html#cb73-277" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb73-278"><a href="mod-td-pred.html#cb73-278" aria-hidden="true" tabindex="-1"></a><span class="co">#       getActionPi = function(s) {</span></span>
<span id="cb73-279"><a href="mod-td-pred.html#cb73-279" aria-hidden="true" tabindex="-1"></a><span class="co">#          pi &lt;- self$model[[s]]$pi</span></span>
<span id="cb73-280"><a href="mod-td-pred.html#cb73-280" aria-hidden="true" tabindex="-1"></a><span class="co">#          return(sample(names(pi), 1, prob = pi))</span></span>
<span id="cb73-281"><a href="mod-td-pred.html#cb73-281" aria-hidden="true" tabindex="-1"></a><span class="co">#       },</span></span>
<span id="cb73-282"><a href="mod-td-pred.html#cb73-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-283"><a href="mod-td-pred.html#cb73-283" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Policy evaluation using TD(0)</span></span>
<span id="cb73-284"><a href="mod-td-pred.html#cb73-284" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param env The environment which must have a method `getTimeStepData(s,a)` that return a list with elements `r` (reward) and `sN` (next state). </span></span>
<span id="cb73-285"><a href="mod-td-pred.html#cb73-285" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb73-286"><a href="mod-td-pred.html#cb73-286" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param alpha Step-size (use a fixed step-size).</span></span>
<span id="cb73-287"><a href="mod-td-pred.html#cb73-287" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxE Maximum number of episodes generated.  </span></span>
<span id="cb73-288"><a href="mod-td-pred.html#cb73-288" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxEL Maximum episode length.</span></span>
<span id="cb73-289"><a href="mod-td-pred.html#cb73-289" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param reset If true initialize all state-values to 0.</span></span>
<span id="cb73-290"><a href="mod-td-pred.html#cb73-290" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states Possible start states of each episode (one picked at random).</span></span>
<span id="cb73-291"><a href="mod-td-pred.html#cb73-291" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param ... Further arguments passed to `getEpisode` e.g the coefficient used for upper-confidence bound action selection. </span></span>
<span id="cb73-292"><a href="mod-td-pred.html#cb73-292" aria-hidden="true" tabindex="-1"></a>      <span class="at">policyEvalTD0 =</span> <span class="cf">function</span>(env, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">maxE =</span> <span class="dv">1000</span>, <span class="at">maxEL =</span> <span class="dv">10000</span>, <span class="at">reset =</span> <span class="cn">TRUE</span>, <span class="at">states =</span> self<span class="sc">$</span><span class="fu">getStateKeys</span>()) {</span>
<span id="cb73-293"><a href="mod-td-pred.html#cb73-293" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (reset) self<span class="sc">$</span><span class="fu">setStateValue</span>(self<span class="sc">$</span><span class="fu">getStateKeys</span>())      <span class="co"># set to 0</span></span>
<span id="cb73-294"><a href="mod-td-pred.html#cb73-294" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (ite <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxE) {</span>
<span id="cb73-295"><a href="mod-td-pred.html#cb73-295" aria-hidden="true" tabindex="-1"></a>            s <span class="ot">&lt;-</span> <span class="fu">sample</span>(states, <span class="dv">1</span>)  <span class="co"># pick start state among states</span></span>
<span id="cb73-296"><a href="mod-td-pred.html#cb73-296" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxEL) {  <span class="co"># for episode with ss as start (max length 100000)</span></span>
<span id="cb73-297"><a href="mod-td-pred.html#cb73-297" aria-hidden="true" tabindex="-1"></a>               a <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getActionPi</span>(s)</span>
<span id="cb73-298"><a href="mod-td-pred.html#cb73-298" aria-hidden="true" tabindex="-1"></a>               dat <span class="ot">&lt;-</span> env<span class="sc">$</span><span class="fu">getTimeStepData</span>(s,a)  <span class="co"># get next state and reward</span></span>
<span id="cb73-299"><a href="mod-td-pred.html#cb73-299" aria-hidden="true" tabindex="-1"></a>               r <span class="ot">&lt;-</span> dat<span class="sc">$</span>r</span>
<span id="cb73-300"><a href="mod-td-pred.html#cb73-300" aria-hidden="true" tabindex="-1"></a>               sN <span class="ot">&lt;-</span> dat<span class="sc">$</span>sN</span>
<span id="cb73-301"><a href="mod-td-pred.html#cb73-301" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> (<span class="fu">is.na</span>(sN) <span class="sc">|</span> <span class="fu">is.na</span>(a)) <span class="cf">break</span>  <span class="co"># start generating new episode</span></span>
<span id="cb73-302"><a href="mod-td-pred.html#cb73-302" aria-hidden="true" tabindex="-1"></a>               oldV <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v</span>
<span id="cb73-303"><a href="mod-td-pred.html#cb73-303" aria-hidden="true" tabindex="-1"></a>               self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v <span class="ot">&lt;-</span> oldV <span class="sc">+</span> alpha <span class="sc">*</span> (r <span class="sc">+</span> gamma <span class="sc">*</span> self<span class="sc">$</span>model[[sN]]<span class="sc">$</span>v <span class="sc">-</span> oldV)</span>
<span id="cb73-304"><a href="mod-td-pred.html#cb73-304" aria-hidden="true" tabindex="-1"></a>               s <span class="ot">&lt;-</span> sN</span>
<span id="cb73-305"><a href="mod-td-pred.html#cb73-305" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-306"><a href="mod-td-pred.html#cb73-306" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-307"><a href="mod-td-pred.html#cb73-307" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-308"><a href="mod-td-pred.html#cb73-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-309"><a href="mod-td-pred.html#cb73-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-310"><a href="mod-td-pred.html#cb73-310" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Policy evaluation using every-visit Monte Carlo sampling.  </span></span>
<span id="cb73-311"><a href="mod-td-pred.html#cb73-311" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param env The environment which must have a method `getEpisode(agent, s, coeff)` that return an episode as a tibble with </span></span>
<span id="cb73-312"><a href="mod-td-pred.html#cb73-312" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    cols s, a, r (last col the terminal reward). This method also must update the visit counters if needed! This is also </span></span>
<span id="cb73-313"><a href="mod-td-pred.html#cb73-313" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    the method that decides which action selection method is used. </span></span>
<span id="cb73-314"><a href="mod-td-pred.html#cb73-314" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb73-315"><a href="mod-td-pred.html#cb73-315" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param theta Threshold parameter.</span></span>
<span id="cb73-316"><a href="mod-td-pred.html#cb73-316" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param minIte Minimum number of iterations for each start state (all `states` are used a start state in one iteration).</span></span>
<span id="cb73-317"><a href="mod-td-pred.html#cb73-317" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxIte Maximum number of iterations for each start state (all `states` are used a start state in one iteration).</span></span>
<span id="cb73-318"><a href="mod-td-pred.html#cb73-318" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param reset If true initialize all state-values to 0.</span></span>
<span id="cb73-319"><a href="mod-td-pred.html#cb73-319" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states Start states in the episodes, which all are visited using a for loop.</span></span>
<span id="cb73-320"><a href="mod-td-pred.html#cb73-320" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param verbose If true then print info for each episode.</span></span>
<span id="cb73-321"><a href="mod-td-pred.html#cb73-321" aria-hidden="true" tabindex="-1"></a>      <span class="at">policyEvalMC =</span> <span class="cf">function</span>(env, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">theta =</span> <span class="fl">0.1</span>, <span class="at">minIte =</span> <span class="dv">100</span>, <span class="at">maxIte =</span> <span class="dv">1000</span>, <span class="at">reset =</span> <span class="cn">TRUE</span>, <span class="at">states =</span> self<span class="sc">$</span><span class="fu">getStateKeys</span>(), <span class="at">verbose =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb73-322"><a href="mod-td-pred.html#cb73-322" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (reset) {</span>
<span id="cb73-323"><a href="mod-td-pred.html#cb73-323" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">setStateValue</span>()      <span class="co"># set to 0</span></span>
<span id="cb73-324"><a href="mod-td-pred.html#cb73-324" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">setActionCtrValue</span>()   <span class="co"># reset counter</span></span>
<span id="cb73-325"><a href="mod-td-pred.html#cb73-325" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">setStateCtrValue</span>()    <span class="co"># reset counter</span></span>
<span id="cb73-326"><a href="mod-td-pred.html#cb73-326" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-327"><a href="mod-td-pred.html#cb73-327" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (ite <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxIte) {</span>
<span id="cb73-328"><a href="mod-td-pred.html#cb73-328" aria-hidden="true" tabindex="-1"></a>            delta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb73-329"><a href="mod-td-pred.html#cb73-329" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (ss <span class="cf">in</span> states) {  <span class="co"># for episode with s as start</span></span>
<span id="cb73-330"><a href="mod-td-pred.html#cb73-330" aria-hidden="true" tabindex="-1"></a>               df <span class="ot">&lt;-</span> env<span class="sc">$</span><span class="fu">getEpisodePi</span>(self, ss)  <span class="co"># an episode stored in a tibble with cols s, a, r (last col the terminal reward)</span></span>
<span id="cb73-331"><a href="mod-td-pred.html#cb73-331" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb73-332"><a href="mod-td-pred.html#cb73-332" aria-hidden="true" tabindex="-1"></a>               df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nS =</span> <span class="cn">NA</span>, <span class="at">g =</span> <span class="cn">NA</span>, <span class="at">oldV =</span> <span class="cn">NA</span>, <span class="at">v =</span> <span class="cn">NA</span>)</span>
<span id="cb73-333"><a href="mod-td-pred.html#cb73-333" aria-hidden="true" tabindex="-1"></a>               gain <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb73-334"><a href="mod-td-pred.html#cb73-334" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">nrow</span>(df)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb73-335"><a href="mod-td-pred.html#cb73-335" aria-hidden="true" tabindex="-1"></a>                  s <span class="ot">&lt;-</span> df<span class="sc">$</span>s[i]</span>
<span id="cb73-336"><a href="mod-td-pred.html#cb73-336" aria-hidden="true" tabindex="-1"></a>                  a <span class="ot">&lt;-</span> df<span class="sc">$</span>a[i]</span>
<span id="cb73-337"><a href="mod-td-pred.html#cb73-337" aria-hidden="true" tabindex="-1"></a>                  gain <span class="ot">&lt;-</span> df<span class="sc">$</span>r[i] <span class="sc">+</span> gamma <span class="sc">*</span> gain</span>
<span id="cb73-338"><a href="mod-td-pred.html#cb73-338" aria-hidden="true" tabindex="-1"></a>                  ctr <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n</span>
<span id="cb73-339"><a href="mod-td-pred.html#cb73-339" aria-hidden="true" tabindex="-1"></a>                  oldV <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v</span>
<span id="cb73-340"><a href="mod-td-pred.html#cb73-340" aria-hidden="true" tabindex="-1"></a>                  stepSize <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>ctr)</span>
<span id="cb73-341"><a href="mod-td-pred.html#cb73-341" aria-hidden="true" tabindex="-1"></a>                  self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v <span class="ot">&lt;-</span> oldV <span class="sc">+</span> stepSize <span class="sc">*</span> (gain <span class="sc">-</span> oldV)</span>
<span id="cb73-342"><a href="mod-td-pred.html#cb73-342" aria-hidden="true" tabindex="-1"></a>                  newV <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>v</span>
<span id="cb73-343"><a href="mod-td-pred.html#cb73-343" aria-hidden="true" tabindex="-1"></a>                  delta <span class="ot">&lt;-</span> <span class="fu">max</span>(delta, <span class="fu">abs</span>(oldV <span class="sc">-</span> newV))</span>
<span id="cb73-344"><a href="mod-td-pred.html#cb73-344" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> (verbose) df<span class="sc">$</span>g[i] <span class="ot">&lt;-</span> gain; df<span class="sc">$</span>nS[i] <span class="ot">&lt;-</span> ctr; df<span class="sc">$</span>oldV[i] <span class="ot">&lt;-</span> oldV; df<span class="sc">$</span>v[i] <span class="ot">&lt;-</span> newV</span>
<span id="cb73-345"><a href="mod-td-pred.html#cb73-345" aria-hidden="true" tabindex="-1"></a>               }</span>
<span id="cb73-346"><a href="mod-td-pred.html#cb73-346" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> (verbose) <span class="fu">print</span>(df)</span>
<span id="cb73-347"><a href="mod-td-pred.html#cb73-347" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-348"><a href="mod-td-pred.html#cb73-348" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (delta <span class="sc">&lt;</span> theta <span class="sc">&amp;</span> ite <span class="sc">&gt;=</span> minIte) <span class="cf">break</span></span>
<span id="cb73-349"><a href="mod-td-pred.html#cb73-349" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-350"><a href="mod-td-pred.html#cb73-350" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (ite <span class="sc">==</span> maxIte) <span class="fu">warning</span>(<span class="st">&quot;Polcy eval algorithm stopped at max iterations allowed: &quot;</span>, maxIte)</span>
<span id="cb73-351"><a href="mod-td-pred.html#cb73-351" aria-hidden="true" tabindex="-1"></a>         <span class="fu">message</span>(<span class="fu">str_c</span>(<span class="st">&quot;Policy eval algorihm finished in &quot;</span>, ite, <span class="st">&quot; iterations.&quot;</span>))</span>
<span id="cb73-352"><a href="mod-td-pred.html#cb73-352" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-353"><a href="mod-td-pred.html#cb73-353" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb73-354"><a href="mod-td-pred.html#cb73-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-355"><a href="mod-td-pred.html#cb73-355" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @description Generalized policy iteration using on policy every-visit Monte Carlo sampling.  </span></span>
<span id="cb73-356"><a href="mod-td-pred.html#cb73-356" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param env The environment which must have a method `getEpisode(agent, s, coeff)` that return an episode as a tibble with </span></span>
<span id="cb73-357"><a href="mod-td-pred.html#cb73-357" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    cols s, a, r (last col the terminal reward). This method also must update the visit counters if needed! This is also </span></span>
<span id="cb73-358"><a href="mod-td-pred.html#cb73-358" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39;    the method that decides which action selection method is used. </span></span>
<span id="cb73-359"><a href="mod-td-pred.html#cb73-359" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param gamma Discount rate.</span></span>
<span id="cb73-360"><a href="mod-td-pred.html#cb73-360" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param theta Threshold parameter.</span></span>
<span id="cb73-361"><a href="mod-td-pred.html#cb73-361" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param minIte Minimum number of iterations for each start state (all `states` are used a start state in one iteration).</span></span>
<span id="cb73-362"><a href="mod-td-pred.html#cb73-362" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param maxIte Maximum number of iterations for each start state (all `states` are used a start state in one iteration).</span></span>
<span id="cb73-363"><a href="mod-td-pred.html#cb73-363" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param reset If true initialize all action-values to 0.</span></span>
<span id="cb73-364"><a href="mod-td-pred.html#cb73-364" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param states Start states in the episodes, which all are visited using a for loop.</span></span>
<span id="cb73-365"><a href="mod-td-pred.html#cb73-365" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param eps Epsilon used for the epsilon-greedy policy.</span></span>
<span id="cb73-366"><a href="mod-td-pred.html#cb73-366" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; @param verbose If true then print info for each episode.</span></span>
<span id="cb73-367"><a href="mod-td-pred.html#cb73-367" aria-hidden="true" tabindex="-1"></a>      <span class="at">gpiOnPolicyMC =</span> <span class="cf">function</span>(env, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">theta =</span> <span class="fl">0.1</span>, <span class="at">minIte =</span> <span class="dv">100</span>, <span class="at">maxIte =</span> <span class="dv">1000</span>, <span class="at">reset =</span> <span class="cn">TRUE</span>, <span class="at">states =</span> self<span class="sc">$</span><span class="fu">getStateKeys</span>(), <span class="at">eps =</span> <span class="fl">0.1</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb73-368"><a href="mod-td-pred.html#cb73-368" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (reset) {</span>
<span id="cb73-369"><a href="mod-td-pred.html#cb73-369" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">setActionValue</span>()      <span class="co"># set to 0</span></span>
<span id="cb73-370"><a href="mod-td-pred.html#cb73-370" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">setActionCtrValue</span>()   <span class="co"># reset counter</span></span>
<span id="cb73-371"><a href="mod-td-pred.html#cb73-371" aria-hidden="true" tabindex="-1"></a>            self<span class="sc">$</span><span class="fu">setStateCtrValue</span>()    <span class="co"># reset counter</span></span>
<span id="cb73-372"><a href="mod-td-pred.html#cb73-372" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-373"><a href="mod-td-pred.html#cb73-373" aria-hidden="true" tabindex="-1"></a>         <span class="co"># self$setRandomEpsGreedyPolicy(epsilon)</span></span>
<span id="cb73-374"><a href="mod-td-pred.html#cb73-374" aria-hidden="true" tabindex="-1"></a>         self<span class="sc">$</span><span class="fu">setEpsGreedyPolicy</span>(eps, self<span class="sc">$</span><span class="fu">getStateKeys</span>())</span>
<span id="cb73-375"><a href="mod-td-pred.html#cb73-375" aria-hidden="true" tabindex="-1"></a>         <span class="co"># self$setGreedyPolicy()</span></span>
<span id="cb73-376"><a href="mod-td-pred.html#cb73-376" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (ite <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxIte) {</span>
<span id="cb73-377"><a href="mod-td-pred.html#cb73-377" aria-hidden="true" tabindex="-1"></a>            delta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb73-378"><a href="mod-td-pred.html#cb73-378" aria-hidden="true" tabindex="-1"></a>            <span class="co"># stable &lt;- TRUE</span></span>
<span id="cb73-379"><a href="mod-td-pred.html#cb73-379" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (ss <span class="cf">in</span> states) {  <span class="co"># for episode with s as start</span></span>
<span id="cb73-380"><a href="mod-td-pred.html#cb73-380" aria-hidden="true" tabindex="-1"></a>               df <span class="ot">&lt;-</span> env<span class="sc">$</span><span class="fu">getEpisode</span>(self, ss, eps)  <span class="co"># an episode stored in a tibble with cols s, a, r (last col the terminal reward)</span></span>
<span id="cb73-381"><a href="mod-td-pred.html#cb73-381" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb73-382"><a href="mod-td-pred.html#cb73-382" aria-hidden="true" tabindex="-1"></a>               df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nA =</span> <span class="cn">NA</span>, <span class="at">nS =</span> <span class="cn">NA</span>, <span class="at">oldQ =</span> <span class="cn">NA</span>, <span class="at">q =</span> <span class="cn">NA</span>, <span class="at">g =</span> <span class="cn">NA</span>, <span class="at">oldV =</span> <span class="cn">NA</span>, <span class="at">v =</span> <span class="cn">NA</span>)</span>
<span id="cb73-383"><a href="mod-td-pred.html#cb73-383" aria-hidden="true" tabindex="-1"></a>               gain <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb73-384"><a href="mod-td-pred.html#cb73-384" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">nrow</span>(df)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb73-385"><a href="mod-td-pred.html#cb73-385" aria-hidden="true" tabindex="-1"></a>                  s <span class="ot">&lt;-</span> df<span class="sc">$</span>s[i]</span>
<span id="cb73-386"><a href="mod-td-pred.html#cb73-386" aria-hidden="true" tabindex="-1"></a>                  a <span class="ot">&lt;-</span> df<span class="sc">$</span>a[i]</span>
<span id="cb73-387"><a href="mod-td-pred.html#cb73-387" aria-hidden="true" tabindex="-1"></a>                  gain <span class="ot">&lt;-</span> df<span class="sc">$</span>r[i] <span class="sc">+</span> gamma <span class="sc">*</span> gain</span>
<span id="cb73-388"><a href="mod-td-pred.html#cb73-388" aria-hidden="true" tabindex="-1"></a>                  ctr <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>n</span>
<span id="cb73-389"><a href="mod-td-pred.html#cb73-389" aria-hidden="true" tabindex="-1"></a>                  oldQ <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q</span>
<span id="cb73-390"><a href="mod-td-pred.html#cb73-390" aria-hidden="true" tabindex="-1"></a>                  oldV <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getStateValueQ</span>(s)</span>
<span id="cb73-391"><a href="mod-td-pred.html#cb73-391" aria-hidden="true" tabindex="-1"></a>                  stepSize <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>ctr)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb73-392"><a href="mod-td-pred.html#cb73-392" aria-hidden="true" tabindex="-1"></a>                  self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q <span class="ot">&lt;-</span> oldQ <span class="sc">+</span> stepSize <span class="sc">*</span> (gain <span class="sc">-</span> oldQ)</span>
<span id="cb73-393"><a href="mod-td-pred.html#cb73-393" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># self$model[[s]]$actions[[a]]$q &lt;- oldQ + 0.1 * (gain - oldQ)</span></span>
<span id="cb73-394"><a href="mod-td-pred.html#cb73-394" aria-hidden="true" tabindex="-1"></a>                  self<span class="sc">$</span><span class="fu">setEpsGreedyPolicy</span>(eps, s)</span>
<span id="cb73-395"><a href="mod-td-pred.html#cb73-395" aria-hidden="true" tabindex="-1"></a>                  newV <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">getStateValueQ</span>(s)</span>
<span id="cb73-396"><a href="mod-td-pred.html#cb73-396" aria-hidden="true" tabindex="-1"></a>                  delta <span class="ot">&lt;-</span> <span class="fu">max</span>(delta, <span class="fu">abs</span>(oldV <span class="sc">-</span> newV))</span>
<span id="cb73-397"><a href="mod-td-pred.html#cb73-397" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> (verbose) df<span class="sc">$</span>oldQ[i] <span class="ot">&lt;-</span> oldQ; df<span class="sc">$</span>q[i] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>actions[[a]]<span class="sc">$</span>q; df<span class="sc">$</span>g[i] <span class="ot">&lt;-</span> gain; df<span class="sc">$</span>nA[i] <span class="ot">&lt;-</span> ctr; df<span class="sc">$</span>nS[i] <span class="ot">&lt;-</span> self<span class="sc">$</span>model[[s]]<span class="sc">$</span>n; df<span class="sc">$</span>oldV[i] <span class="ot">&lt;-</span> oldV; df<span class="sc">$</span>v[i] <span class="ot">&lt;-</span> newV</span>
<span id="cb73-398"><a href="mod-td-pred.html#cb73-398" aria-hidden="true" tabindex="-1"></a>               }</span>
<span id="cb73-399"><a href="mod-td-pred.html#cb73-399" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> (verbose) <span class="fu">print</span>(df)</span>
<span id="cb73-400"><a href="mod-td-pred.html#cb73-400" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-401"><a href="mod-td-pred.html#cb73-401" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (delta <span class="sc">&lt;</span> theta <span class="sc">&amp;</span> ite <span class="sc">&gt;=</span> minIte) <span class="cf">break</span></span>
<span id="cb73-402"><a href="mod-td-pred.html#cb73-402" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb73-403"><a href="mod-td-pred.html#cb73-403" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (ite <span class="sc">==</span> maxIte) <span class="fu">warning</span>(<span class="st">&quot;GPI algorithm stopped at max iterations allowed: &quot;</span>, maxIte)</span>
<span id="cb73-404"><a href="mod-td-pred.html#cb73-404" aria-hidden="true" tabindex="-1"></a>         <span class="fu">message</span>(<span class="fu">str_c</span>(<span class="st">&quot;GPI algorihm finished in &quot;</span>, ite, <span class="st">&quot; iterations.&quot;</span>))</span>
<span id="cb73-405"><a href="mod-td-pred.html#cb73-405" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb73-406"><a href="mod-td-pred.html#cb73-406" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb73-407"><a href="mod-td-pred.html#cb73-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-408"><a href="mod-td-pred.html#cb73-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-409"><a href="mod-td-pred.html#cb73-409" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb73-410"><a href="mod-td-pred.html#cb73-410" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can now define the RL agent and set the policy which must be done before calling TD(0):</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="mod-td-pred.html#cb74-1" aria-hidden="true" tabindex="-1"></a>agent <span class="ot">&lt;-</span> RLAgent<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb74-2"><a href="mod-td-pred.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Set the policy</span></span>
<span id="cb74-3"><a href="mod-td-pred.html#cb74-3" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb74-4"><a href="mod-td-pred.html#cb74-4" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span> <span class="ot">=</span> <span class="fl">0.5</span>, <span class="st">&quot;right&quot;</span> <span class="ot">=</span> <span class="fl">0.5</span>)</span>
<span id="cb74-5"><a href="mod-td-pred.html#cb74-5" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setPolicy</span>(states, pi)</span>
<span id="cb74-6"><a href="mod-td-pred.html#cb74-6" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;dummy&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb74-7"><a href="mod-td-pred.html#cb74-7" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setPolicy</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;7&quot;</span>), pi)</span>
<span id="cb74-8"><a href="mod-td-pred.html#cb74-8" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">getPolicy</span>()</span>
<span id="cb74-9"><a href="mod-td-pred.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span id="cb74-10"><a href="mod-td-pred.html#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state action    pr</span></span>
<span id="cb74-11"><a href="mod-td-pred.html#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span id="cb74-12"><a href="mod-td-pred.html#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 1     dummy    1  </span></span>
<span id="cb74-13"><a href="mod-td-pred.html#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2     left     0.5</span></span>
<span id="cb74-14"><a href="mod-td-pred.html#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2     right    0.5</span></span>
<span id="cb74-15"><a href="mod-td-pred.html#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 3     left     0.5</span></span>
<span id="cb74-16"><a href="mod-td-pred.html#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 3     right    0.5</span></span>
<span id="cb74-17"><a href="mod-td-pred.html#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 4     left     0.5</span></span>
<span id="cb74-18"><a href="mod-td-pred.html#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 4     right    0.5</span></span>
<span id="cb74-19"><a href="mod-td-pred.html#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 5     left     0.5</span></span>
<span id="cb74-20"><a href="mod-td-pred.html#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 5     right    0.5</span></span>
<span id="cb74-21"><a href="mod-td-pred.html#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 6     left     0.5</span></span>
<span id="cb74-22"><a href="mod-td-pred.html#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 6     right    0.5</span></span>
<span id="cb74-23"><a href="mod-td-pred.html#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 7     dummy    1</span></span></code></pre></div>
<p>Note a policy must be defined for each possible state that may be generated in an episode. We can now run TD(0):</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="mod-td-pred.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">875</span>)</span>
<span id="cb75-2"><a href="mod-td-pred.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="do">## One episode</span></span>
<span id="cb75-3"><a href="mod-td-pred.html#cb75-3" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setStateValue</span>(states, <span class="fl">0.5</span>)</span>
<span id="cb75-4"><a href="mod-td-pred.html#cb75-4" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setStateValue</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;7&quot;</span>), <span class="dv">0</span>)</span>
<span id="cb75-5"><a href="mod-td-pred.html#cb75-5" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">getStateValues</span>()</span>
<span id="cb75-6"><a href="mod-td-pred.html#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7 × 2</span></span>
<span id="cb75-7"><a href="mod-td-pred.html#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Rowwise: </span></span>
<span id="cb75-8"><a href="mod-td-pred.html#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state     v</span></span>
<span id="cb75-9"><a href="mod-td-pred.html#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb75-10"><a href="mod-td-pred.html#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1       0  </span></span>
<span id="cb75-11"><a href="mod-td-pred.html#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2       0.5</span></span>
<span id="cb75-12"><a href="mod-td-pred.html#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3       0.5</span></span>
<span id="cb75-13"><a href="mod-td-pred.html#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4       0.5</span></span>
<span id="cb75-14"><a href="mod-td-pred.html#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 5       0.5</span></span>
<span id="cb75-15"><a href="mod-td-pred.html#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 6       0.5</span></span>
<span id="cb75-16"><a href="mod-td-pred.html#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 7       0</span></span>
<span id="cb75-17"><a href="mod-td-pred.html#cb75-17" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">policyEvalTD0</span>(env, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">states =</span> <span class="st">&quot;4&quot;</span>, <span class="at">maxE =</span> <span class="dv">1</span>, <span class="at">reset =</span> F)</span>
<span id="cb75-18"><a href="mod-td-pred.html#cb75-18" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> agent<span class="sc">$</span><span class="fu">getStateValues</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">episodes =</span> <span class="dv">1</span>)</span></code></pre></div></li>
</ol>
<div id="QTmw0Hn8j3VKBzsobTS2" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="QTmw0Hn8j3VKBzsobTS2-title">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<h4 class="modal-title" id="QTmw0Hn8j3VKBzsobTS2-title">
Solution
</h4>
</div>
<div class="modal-body">
<div class="sourceCode" id="cb76"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb76-1"><a href="mod-td-pred.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 episodes</span></span>
<span id="cb76-2"><a href="mod-td-pred.html#cb76-2" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setStateValue</span>(states, <span class="fl">0.5</span>)</span>
<span id="cb76-3"><a href="mod-td-pred.html#cb76-3" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setStateValue</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;7&quot;</span>), <span class="dv">0</span>)</span>
<span id="cb76-4"><a href="mod-td-pred.html#cb76-4" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">policyEvalTD0</span>(env, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">states =</span> <span class="st">&quot;4&quot;</span>, <span class="at">maxE =</span> <span class="dv">10</span>, <span class="at">reset =</span> F)</span>
<span id="cb76-5"><a href="mod-td-pred.html#cb76-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res, agent<span class="sc">$</span><span class="fu">getStateValues</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">episodes =</span> <span class="dv">10</span>))</span>
<span id="cb76-6"><a href="mod-td-pred.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 100 episodes</span></span>
<span id="cb76-7"><a href="mod-td-pred.html#cb76-7" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setStateValue</span>(states, <span class="fl">0.5</span>)</span>
<span id="cb76-8"><a href="mod-td-pred.html#cb76-8" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">setStateValue</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;7&quot;</span>), <span class="dv">0</span>)</span>
<span id="cb76-9"><a href="mod-td-pred.html#cb76-9" aria-hidden="true" tabindex="-1"></a>agent<span class="sc">$</span><span class="fu">policyEvalTD0</span>(env, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">states =</span> <span class="st">&quot;4&quot;</span>, <span class="at">maxE =</span> <span class="dv">100</span>, <span class="at">reset =</span> F)</span>
<span id="cb76-10"><a href="mod-td-pred.html#cb76-10" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res, agent<span class="sc">$</span><span class="fu">getStateValues</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">episodes =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-11"><a href="mod-td-pred.html#cb76-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">as.numeric</span>(state), <span class="at">episodes =</span> <span class="fu">as.character</span>(episodes)) </span>
<span id="cb76-12"><a href="mod-td-pred.html#cb76-12" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res,mdp<span class="sc">$</span><span class="fu">getStateValues</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">as.numeric</span>(state), <span class="at">episodes =</span> <span class="st">&quot;mdp&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-13"><a href="mod-td-pred.html#cb76-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(state <span class="sc">&gt;</span> <span class="dv">1</span>, state <span class="sc">&lt;</span> <span class="dv">7</span>)</span>
<span id="cb76-14"><a href="mod-td-pred.html#cb76-14" aria-hidden="true" tabindex="-1"></a>res <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> v, <span class="at">col =</span> episodes)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="07_td-pred_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">
Close
</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QTmw0Hn8j3VKBzsobTS2">
Solution
</button>
<p>Note we first have to set the state-values to the default specified. Next, we run TD(0) prediction with one episode <code>maxE = 1</code> and starting state 4. You now have to run similar code for 10 and 100 episodes, store the result and plot a line for each result.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Sutton18" class="csl-entry">
Sutton, R. S., and A. G. Barto. 2018. <em>Reinforcement Learning: An Introduction</em>. Second Edition. MIT Press. <a href="http://incompleteideas.net/book/the-book.html">http://incompleteideas.net/book/the-book.html</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mod-mc.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mod-td-control.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/rl/edit/master/book/07_td-pred.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
